!function(){function a(a){console.log("statusChangeCallback"),console.log(a),"connected"===a.status?console.log("connected"):"not_authorized"===a.status?console.log("not authorized"):console.log("not login")}function b(a){for(var b=atob(a.split(",")[1]),c=new ArrayBuffer(b.length),d=new Uint8Array(c),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([c],{type:"image/png"})}function c(a,b,c){this.api=a,this.apiParams=b,this.after=null,this.dataList=[],this.thereIsMore=!0,this.cbFetchComplete=c,this.lastFetchIndex=0}var d,e=window.FBHelper={},f=["public_profile"];e.uid=null,e.uname=null,e.init=function(b,c,e){"string"==typeof b&&(b={appId:b,cookie:!0,xfbml:!0,version:"v2.4"}),d=b.appId,window.fbAsyncInit=function(){FB.init(b),e&&FB.getLoginStatus(function(b){a(b)}),c&&c.apply()},function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/zh_TW/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk")},e.login=function(a,b,c){a||(a=f),FB.login(function(a){a.authResponse?(e.uid=a.authResponse.userID,"connected"==a.status?null!=b&&b.apply(null,[a]):null!=c&&c.apply(null,[{action:"login",response:a,type:a.status,message:"not connected"}])):null!=c&&c.apply(null,[{action:"login",response:a,type:a.status,message:"user cancel login"}])},{scope:a})},e.getPublicProfile=function(a){FB.api("/me",function(b){e.uname=b.name,a.apply(null,[b])})},e.checkLoginStatus=function(a,b){function c(c){for(var d={},e=a.length,f=0,g=0;g<a.length;g++)d[a[g]]=!1;FB.api("/me/permissions",function(a){if(a&&a.data&&a.data.length){var g,h;for(g=0;g<a.data.length;g++)h=a.data[g],void 0!==d[h.permission]&&(d[h.permission]=!0,f++);f<e?b.call(null,{message:"lack permission",permissionDic:d},null):b.call(null,null,c)}else b.call(null,{message:"check permission fail"},null)})}FB.getLoginStatus(function(d){"connected"===d.status?a?c(d.authResponse):b.call(null,null,d.authResponse):b.call(null,{message:"no connect"},null)})},e.postImageToFacebook=function(a,c,d){var e,f=a.toDataURL("image/png");try{e=b(f)}catch(a){console.log(a)}var g=new FormData;g.append("access_token",c),g.append("source",e);try{$.ajax({url:"https://graph.facebook.com/me/photos?access_token="+c,type:"POST",data:g,processData:!1,contentType:!1,cache:!1,success:function(a){d.call(null,null,a)},error:function(a,b,c){d.call(null,"error "+c+" Status "+a.status)},complete:function(){}})}catch(a){d.call(null,a)}},window.FBData=c,c.prototype.fetch=function(){var a=this;return a.thereIsMore||(console.log("warning: trying to fetch data where there is no more."),a.cbFetchComplete.call(a,a.dataList)),a.lastFetchIndex=a.dataList.length,FB.api(a.api,"GET",a.apiParams,function(b){b.error?console.error(b.error):(a.dataList=a.dataList.concat(b.data),a.apiParams.after=Boolean(b.paging&&b.paging.next)?b.paging.cursors.after:null,a.apiParams.after?a.thereIsMore=!0:(delete a.apiParams.after,a.thereIsMore=!1),a.cbFetchComplete.call(a,a.dataList))}),this}}(),function(){"use strict";function a(b,c,d,e,f,g,h,i,j,k,l){function m(){var a,f=$(b).val(),g=$(c).val(),i=""!=f&&f==v;i&&g>w&&$(c).prop("selectedIndex",0);var j=i?w:12;for(a=1;a<=12;a++)$($(c).find("option")[a]).css("display",a<=j?"block":"none");if($(d).find("option").remove(),$(d).append('<option value="" selected>'+h+"</option>\n"),""!=f&&""!=g){var l=new Date(f,g,-1),m=l.getDate()+1;for(i&&g==w&&(m=x),a=1;a<=m;a++)$(d).append('<option value="'+a+'">'+a+k+"</option>\n");$(d).prop("selectedIndex",0),e&&e.apply(null,[newDayIndex])}}function n(a,e,f){$(b).prop("selectedIndex",parseInt(a)-1900+1),$(c).prop("selectedIndex",parseInt(e)),m(),$(d).prop("selectedIndex",parseInt(f))}function o(){n(1899,0,0)}function p(){$(b).attr("disabled","disabled"),$(c).attr("disabled","disabled"),$(d).attr("disabled","disabled")}function q(){$(b).removeAttr("disabled"),$(c).removeAttr("disabled"),$(d).removeAttr("disabled")}function r(){return{year:$(b).val(),month:$(c).val(),day:$(d).val()}}function s(a){null==a&&(a="/");var e=r(b,c,d);return""==e.year||""==e.month||""==e.day?null:e.year+a+e.month+a+e.day}var t=a.prototype=this;t.update=m,t.getDateValue=r,t.getDateString=s,t.to=n,t.lock=p,t.unlock=q,t.reset=o,$(b).find("option").remove(),$(c).find("option").remove(),$(d).find("option").remove(),null==f&&(f="年"),null==g&&(g="月"),null==h&&(h="日"),i=null==i?"":" "+i,j=null==j?"":" "+j,k=null==k?"":" "+k,$(b).append('<option value="" selected>'+f+"</option>\n"),$(c).append('<option value="" selected>'+g+"</option>\n");var u;l||(l=new Date);var v=l.getFullYear(),w=l.getMonth()+1,x=l.getDate();for(u=1900;u<=l.getFullYear();u++)$(b).append('<option value="'+u+'">'+u+i+"</option>\n");for(u=1;u<=12;u++)$(c).append('<option value="'+u+'">'+u+j+"</option>\n");$(b).change(m),$(c).change(m),$(b).prop("selectedIndex",0),$(c).prop("selectedIndex",0),$(d).prop("selectedIndex",0),m()}window.FormHelper={};var b,c,d;b=["台北市","基隆市","新北市","宜蘭縣","新竹市","新竹縣","桃園縣","苗栗縣","台中市","彰化縣","南投縣","嘉義市","嘉義縣","雲林縣","台南市","高雄市","澎湖縣","屏東縣","台東縣","花蓮縣","金門縣","連江縣","南海諸島"],c=new Array(23),d=new Array(23),c[0]=["中正區","大同區","中山區","松山區","大安區","萬華區","信義區","士林區","北投區","內湖區","南港區","文山區"],c[1]=["仁愛區","信義區","中正區","中山區","安樂區","暖暖區","七堵區"],c[2]=["萬里區","金山區","板橋區","汐止區","深坑區","石碇區","瑞芳區","平溪區","雙溪區","貢寮區","新店區","坪林區","烏來區","永和區","中和區","土城區","三峽區","樹林區","鶯歌區","三重區","新莊區","泰山區","林口區","蘆洲區","五股區","八里區","淡水區","三芝區","石門區"],c[3]=["宜蘭市","頭城鎮","礁溪鄉","壯圍鄉","員山鄉","羅東鎮","三星鄉","大同鄉","五結鄉","冬山鄉","蘇澳鎮","南澳鄉"],c[4]=new Array("新竹市"),c[5]=["竹北市","湖口鄉","新豐鄉","新埔鄉","關西鎮","芎林鄉","寶山鄉","竹東鎮","五峰鄉","橫山鄉","尖石鄉","北埔鄉","峨嵋鄉"],c[6]=["中壢市","平鎮市","龍潭鄉","楊梅鎮","新屋鄉","觀音鄉","桃園市","龜山鄉","八德市","大溪鎮","復興鄉","大園鄉","蘆竹鄉"],c[7]=["竹南鎮","頭份鎮","三灣鄉","南庄鄉","獅潭鄉","後龍鎮","通霄鎮","苑裡鎮","苗栗市","造橋鄉","頭屋鄉","公館鄉","大湖鄉","泰安鄉","銅鑼鄉","三義鄉","西湖鄉","卓蘭鄉"],c[8]=["中區","東區","南區","西區","北區","北屯區","西屯區","南屯區","太平區","大里區","霧峰區","烏日區","豐原區","后里區","石岡區","東勢區","和平區","新社區","潭子區","大雅區","神岡區","大肚區","沙鹿區","龍井區","梧棲區","清水區","大甲區","外埔區","大安區"],c[9]=["彰化市","芬園鄉","花壇鄉","秀水鄉","鹿港鎮","福興鄉","線西鄉","和美鎮","伸港鄉","員林鎮","社頭鄉","永靖鄉","埔心鄉","溪湖鎮","大村鄉","埔鹽鄉","田中鎮","北斗鎮","田尾鄉","埤頭鄉","溪州鄉","竹塘鄉","二林鎮","大城鄉","芳苑鄉","二水鄉"],c[10]=["南投市","中寮鄉","草屯鎮","國姓鄉","埔里鎮","仁愛鄉","名間鄉","集集鄉","水里鄉","魚池鄉","信義鄉","竹山鎮","鹿谷鄉"],c[11]=new Array("嘉義市"),c[12]=["番路鄉","梅山鄉","竹崎鄉","阿里山鄉","中埔鄉","大埔鄉","水上鄉","鹿草鄉","太保市","朴子市","東石鄉","六腳鄉","新港鄉","民雄鄉","大林鎮","溪口鄉","義竹鄉","布袋鎮"],c[13]=["斗南市","大埤鄉","虎尾鎮","土庫鎮","褒忠鄉","東勢鄉","台西鄉","崙背鄉","麥寮鄉","斗六市","林內鄉","古坑鄉","莿桐鄉","西螺鎮","二崙鄉","北港鎮","水林鄉","口湖鄉","四湖鄉","元長鄉"],c[14]=["中區","東區","南區","西區","北區","安平區","安南區","永康區","歸仁區","新化區","左鎮區","玉井區","楠西區","南化區","仁德區","關廟區","龍崎區","官田區","麻豆區","佳里區","西港區","七股區","將軍區","學甲區","北門區","新營區","後壁區","白河區","東山區","六甲區","下營區","柳營區","鹽水區","善化區","大內區","山上區","新市區","安定區"],c[15]=["新興區","前金區","苓雅區","鹽埕區","鼓山區","旗津區","前鎮區","三民區","楠梓區","小港區","左營區","仁武區","大社區","岡山區","路竹區","阿蓮區","田寮區","燕巢區","橋頭區","梓官區","彌陀區","永安區","湖內區","鳳山區","大寮區","林園區","鳥松區","大樹區","旗山區","美濃區","六龜區","內門區","杉林區","甲仙區","桃源區","那瑪夏區","茂林區","茄萣區"],c[16]=["馬公市","西嶼鄉","望安鄉","七美鄉","白沙鄉","湖西鄉"],c[17]=["屏東市","三地門鄉","霧台鄉","瑪家鄉","九如鄉","里港鄉","高樹鄉","鹽埔鄉","長治鄉","麟洛鄉","竹田鄉","內埔鄉","萬丹鄉","潮州鎮","泰武鄉","來義鄉","萬巒鄉","嵌頂鄉","新埤鄉","南州鄉","林邊鄉","東港鎮","琉球鄉","佳冬鄉","新園鄉","枋寮鄉","枋山鄉","春日鄉","獅子鄉","車城鄉","牡丹鄉","恆春鎮","滿州鄉"],c[18]=["台東市","綠島鄉","蘭嶼鄉","延平鄉","卑南鄉","鹿野鄉","關山鎮","海端鄉","池上鄉","東河鄉","成功鎮","長濱鄉","太麻里鄉","金峰鄉","大武鄉","達仁鄉"],c[19]=["花蓮市","新城鄉","秀林鄉","吉安鄉","壽豐鄉","鳳林鎮","光復鄉","豐濱鄉","瑞穗鄉","萬榮鄉","玉里鎮","卓溪鄉","富里鄉"],c[20]=["金沙鎮","金湖鎮","金寧鄉","金城鎮","烈嶼鄉","烏坵鄉"],c[21]=["南竿鄉","北竿鄉","莒光鄉","東引"],c[22]=["東沙","西沙"],d=new Array(24),d[0]=["100","103","104","105","106","108","110","111","112","114","115","116"],d[1]=["200","201","202","203","204","205","206"],d[2]=["207","208","220","221","222","223","224","226","227","228","231","232","233","234","235","236","237","238","239","241","242","243","244","247","248","249","251","252","253"],d[3]=["260","261","262","263","264","265","266","267","268","269","270","272"],d[4]=new Array("300"),d[5]=["302","303","304","305","306","307","308","310","311","312","313","314","315"],d[6]=["320","324","325","326","327","328","330","333","334","335","336","337","338"],d[7]=["350","351","352","353","354","356","357","358","360","361","362","363","364","365","366","367","368","369"],d[8]=["400","401","402","403","404","406","407","408","411","412","413","414","420","421","422","423","424","426","427","428","429","432","433","434","435","436","437","438","439"],d[9]=["500","502","503","504","505","506","507","508","509","510","511","5112","513","514","515","516","520","521","522","523","524","525","526","527","528","530"],d[10]=["540","541","542","544","545","546","551","552","553","555","556","557","558"],d[11]=new Array("600"),d[12]=["602","603","604","605","606","607","608","611","612","613","614","615","616","621","622","623","624","625"],d[13]=["630","631","632","633","634","635","636","637","638","640","643","646","647","648","649","651","652","653","654","655"],d[14]=["700","701","702","703","704","708","709","710","711","712","713","714","715","716","717","718","719","720","721","722","723","724","725","726","727","730","731","732","733","734","735","736","737","741","742","743","744","745"],d[15]=["800","801","802","803","804","805","806","807","811","812","813","814","815","820","821","822","823","824","825","826","827","828","829","830","831","832","833","840","842","843","844","845","846","847","848","849","851","852"],d[16]=["880","881","882","883","884","885"],d[17]=["900","901","902","903","904","905","906","907","908","909","911","912","913","920","921","922","923","924","925","926","927","928","929","931","932","940","941","942","943","944","945","946","947"],d[18]=["950","951","952","953","954","955","956","957","958","959","961","962","963","964","965","966"],d[19]=["970","971","972","973","974","975","976","977","978","979","981","982","983"],d[20]=["890","891","892","893","894","896"],d[21]=["209","210","211","212"],d[22]=["817","819","290"],FormHelper.completeCounty=function(a,c,d,e,f){a.find("option").remove(),a.append('<option value="" selected>縣市</option>\n');for(var g=0;g<b.length;g++)d==b[g]?a.append('<option value="'+b[g]+'" selected>'+b[g]+"</option>\n"):a.append('<option value="'+b[g]+'">'+b[g]+"</option>\n");FormHelper.completeZone(a,c,e,f),a.on("change",function(){FormHelper.completeZone(a,c,e,f)})},FormHelper.completeZone=function(a,b,e,f){if(b.find("option").remove(),b.append('<option value="" selected>地區</option>\n'),""!=a.val())for(var g=a.get(0).selectedIndex-1,h=c[g],i=d[g],j=0;j<h.length;j++){var k=1==f?" "+i[j]:"",l=h[j]+k;e==h[j]?b.append('<option value="'+l+'" selected>'+l+"</option>\n"):b.append('<option value="'+l+'">'+l+"</option>\n")}},FormHelper.getAddressValue=function(a,e){var f=a.get(0).selectedIndex-1,g=e.get(0).selectedIndex-1,h=c[f],i=d[f],j=void 0==b[f]?null:b[f],k=void 0==h?null:h[g],l=void 0==i?null:i[g];return{county:j,zone:k,zipCode:l}},window.DateCombo=a}(),function(){"use strict";function a(a){var b=parseInt(a);return isNaN(b)&&(b=0),b}var b=window.Helper={};b.getSize_cover=function(a,b,c,d){var e,f,g=a/b,h=c/d;h>g?(f=b,e=f*h):(e=a,f=e/h);var i=e/c,j=a/i,k=b/i,l={x:.5*(c-j),y:.5*(d-k),width:j,height:k};return{width:e,height:f,ratio:i,contentCenterBound:l}},b.getSize_contain=function(a,b,c,d){var e,f,g=a/b,h=c/d;return h>g?(e=a,f=e/h):(f=b,e=f*h),{width:e,height:f,ratio:e/c}},Helper.extract=function(a,b,c,d){null==d&&(d=0),null==b&&(b=document);var e=$(b).find(a).get(d);return e||console.error("can't find dom, selector: "+a+", source: "+b),Helper.getInitValue(e),null!=c&&c.appendChild(e),e},Helper.$extract=function(a,b,c,d){null==d&&(d=0),null==b&&(b=document);var e=$(b).find(a).get(d);return e||console.error("can't find dom, selector: "+a+", source: "+b),Helper.getInitValue(e),null!=c&&c.appendChild(e),$(e)},Helper.pxToPercent=function(b,c,d,e,f){function g(b,c,d){null==d&&(d=100);var e=Helper.styleDic[b];e||(e=b);var g=a(i.css(e)),h=g/c*d+"%";f?f[b]=h:0!=g&&i.css(e,h)}e||(e={w:!0,h:!1,l:!0,t:!1,r:!0,b:!1});var h,i=$(b);for(h in e){var j=1==e[h]?c:d;g(h,j)}},Helper.clearStyles=function(a){$(a).removeAttr("style")},Helper.getInitValue=function(b,c,d,e,f,g){b.init||(b.init={}),b.geom||(b.geom={}),f&&Helper.clearStyles(b);var h,i;if(g?(h=b.init[g]={},i=b.geom[g]={}):(h=b.init,i=b.geom),c||(b.currentStyle?(i.w=h.w=a(b.currentStyle.width),i.h=h.h=a(b.currentStyle.height),i.ml=h.ml=a(b.currentStyle.marginLeft),i.mt=h.mt=a(b.currentStyle.marginTop),i.mr=h.mr=a(b.currentStyle.marginRight),i.mb=h.mb=a(b.currentStyle.marginBottom),i.t=h.t=a(b.currentStyle.top),i.l=h.l=a(b.currentStyle.left),i.r=h.r=a(b.currentStyle.right),i.b=h.b=a(b.currentStyle.bottom)):(i.w=h.w=$(b).width(),i.h=h.h=$(b).height(),i.ml=h.ml=a($(b).css("margin-left")),i.mt=h.mt=a($(b).css("margin-top")),i.mr=h.mr=a($(b).css("margin-right")),i.mb=h.mb=a($(b).css("margin-bottom")),i.t=h.t=a($(b).css("top")),i.l=h.l=a($(b).css("left")),i.r=h.r=a($(b).css("right")),i.b=h.b=a($(b).css("bottom")))),i.scale=h.scale=1,d)for(var j=0;j<d.length;j++){var k=d[j];h[k]=i[k]=a($(b).css(k))}if(e){var l,m,n;l=e.width,m=e.height,n=e.styleDic,Helper.pxToPercent(b,l,m,n,h)}},Helper.styleDic={l:"left",r:"right",t:"top",b:"bottom",ml:"margin-left",mr:"margin-right",mt:"margin-top",mb:"margin-bottom",w:"width",h:"height"},Helper.applyTransform=function(a,b,c,d,e,f){var g,h;f?(g=a.init[f],h=a.geom[f]):(g=a.init,h=a.geom);var i,j,k,l,m=null!=b?g.scale*b:g.scale,n=$(a);if(c)for(j=c.length,i=0;i<j;i++)k=c[i],l=Helper.styleDic[k],l||(l=k),h[k]=g[k]*m,n.css(l,h[k]+"px");if(d)for(j=d.length,i=0;i<j;i++)k=d[i],l=Helper.styleDic[k],h[k]=g[k]*m,n.css(l,h[k]+"%");if(e)for(j=e.length,i=0;i<j;i++)k=e[i],l=Helper.styleDic[k],l||(l=k),n.css(l,g[k])},Helper.transformDom=function(a,b,c,d,e){var f=null!=b?a.init.scale*b:a.init.scale;0!=e&&(e===!0?(a.geom.w=a.init.w*f,a.geom.h=a.init.h*f,$(a).css("width",a.geom.w).css("height",a.geom.h)):(c.l&&(a.geom.l=a.init.l*f,$(a).css("left",a.geom.l)),c.t&&(a.geom.t=a.init.t*f,$(a).css("top",a.geom.t)))),0!=c&&(c===!0?(a.geom.t=a.init.t*f,a.geom.l=a.init.l*f,$(a).css("top",a.geom.t).css("left",a.geom.l)):(c.l&&(a.geom.l=a.init.l*f,$(a).css("left",a.geom.l)),c.t&&(a.geom.t=a.init.t*f,$(a).css("top",a.geom.t)),c.r&&(a.geom.r=a.init.r*f,$(a).css("right",a.geom.r)),c.b&&(a.geom.b=a.init.b*f,$(a).css("bottom",a.geom.b)))),0!=d&&(d===!0?(a.geom.mt=a.init.mt*f,a.geom.ml=a.init.ml*f,$(a).css("margin-top",a.geom.mt).css("margin-left",a.geom.ml)):(c.ml&&(a.geom.ml=a.init.ml*f,$(a).css("margin-left",a.geom.ml)),c.mt&&(a.geom.mt=a.init.mt*f,$(a).css("margin-top",a.geom.mt)),c.mr&&(a.geom.mr=a.init.mr*f,$(a).css("margin-right",a.geom.mr)),c.mb&&(a.geom.mb=a.init.mb*f,$(a).css("margin-bottom",a.geom.mb))))},Helper.downScaleImage=function(a,b,c,d,e,f){var g=document.createElement("canvas");g.width=a.width,g.height=a.height;var h=g.getContext("2d");return h.drawImage(a,0,0),Helper.downScaleCanvas(g,b,c,d,e,f)},Helper.downScaleCanvas=function(a,b,c,d,e,f){if(c||(c=0),d||(d=0),!(b<1&&b>0))throw"scale must be a positive number <1 ";var g=b*b,h=a.width,i=a.height,j=Math.floor(h*b),k=Math.floor(i*b),l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=!1,B=!1,C=a.getContext("2d").getImageData(0,0,h,i).data,D=new Float32Array(3*j*k),E=0,F=0,G=0;for(m=0;m<i;m++)for(p=m*b,t=0|p,q=3*t*j,B=t!=(0|p+b),B&&(y=t+1-p,z=p+b-t-1),l=0;l<h;l++,n+=4)o=l*b,s=0|o,r=q+3*s,A=s!=(0|o+b),A&&(w=s+1-o,x=o+b-s-1),E=C[n],F=C[n+1],G=C[n+2],A||B?A&&!B?(u=w*b,D[r]+=E*u,D[r+1]+=F*u,D[r+2]+=G*u,v=x*b,D[r+3]+=E*v,D[r+4]+=F*v,D[r+5]+=G*v):B&&!A?(u=y*b,D[r]+=E*u,D[r+1]+=F*u,D[r+2]+=G*u,v=z*b,D[r+3*j]+=E*v,D[r+3*j+1]+=F*v,D[r+3*j+2]+=G*v):(u=w*y,D[r]+=E*u,D[r+1]+=F*u,D[r+2]+=G*u,v=x*y,D[r+3]+=E*v,D[r+4]+=F*v,D[r+5]+=G*v,v=w*z,D[r+3*j]+=E*v,D[r+3*j+1]+=F*v,D[r+3*j+2]+=G*v,v=x*z,D[r+3*j+3]+=E*v,D[r+3*j+4]+=F*v,D[r+3*j+5]+=G*v):(D[r]+=E*g,D[r+1]+=F*g,D[r+2]+=G*g);var H=document.createElement("canvas");H.width=e?e:j,H.height=f?f:k;var I=H.getContext("2d"),J=I.getImageData(0,0,j,k),K=J.data,L=0;for(n=0,r=0;L<j*k;n+=3,r+=4,L++)K[r]=Math.ceil(D[n]),K[r+1]=Math.ceil(D[n+1]),K[r+2]=Math.ceil(D[n+2]),K[r+3]=255;return I.putImageData(J,c,d),H}}(),function(){function a(a){return h&&(a=h.call(null,a)),a}function b(a){a||(a=r),t&&k.getHash()!=a?k.setHash(a):k.toContent(a)}function c(){m=!1,null!=p&&(p.apply(),p=null),f&&f.apply()}var d,e,f,g,h,i,j,k=window.SceneHandler={},l={},m=!1,n=null,o=null,p=null,q=null,r="/Index",s=!1,t=!0,u={},v={},w=null;k.currentScene=null,k.processHashNames=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];_contentClasses.push(window[d]),b.push("/"+d)}return b},k.getLastHash=function(){return o},k.init=function(b,c){c=c||{},d=c.version||"0",e=c.cbBeforeChange,f=c.cbAfterChange,h=c.hashChangeTester,g=c.cbContentChange,q=c.cbContentLoaded,j=c.loadingClass,r=c.defaultHash||"/Index",t=void 0===c.listeningHashChange||c.listeningHashChange;var i,n,o;if(c.blockHashs)for(i=0;i<c.blockHashs.length;i++)v[c.blockHashs[i]]=!0;var s,u,w;for(i=0;i<b.length;i++){if(n=b[i],s=n.split("/"),u=s[1],w=null,2==s.length);else{if(3!=s.length){console.error("illegal hash: "+n);continue}w="/"+s[2]}window[u]?(o={hash:n,index:i,stageClass:window[u],contentHash:w},l[n]=o):console.error("class for: "+u+" is not exist")}t&&k.onHashChange(function(b){""==b&&(b=r),b=a(b),b&&l[b]&&!v[b]&&(m?p=function(){k.toContent(b)}:k.toContent(b))})},k.setLock=function(a){s=a},k.onHashChange=function(a){function b(){s||(i?i=!1:a.apply(null,[k.getHash()]))}if("onhashchange"in window)window.onhashchange=function(){b()};else{var c=window.location.hash;window.setInterval(function(){window.location.hash!=c&&(c=window.location.hash,b())},100)}},k.toLastHash=function(){window.history?history.back():k.toHash(o)},k.toLastNonPopupHash=function(){k.toHash(w)},k.getHash=function(){return window.location.hash.replace("#","")},k.setHash=function(a,b){b&&(i=!0),window.location.hash="#"+a},k.toFirstHash=function(b){var c=k.getHash();if(t&&l[c]&&!v[c]||(c=r),c=a(c)){var d=l[c];if(d.stageClass._isPopup){var e=c;p=function(){k.toContent(e)},c=r}return k.toContent(c,b),c}},k.toHash=function(a){v[a]?k.toContent(a):b(a)},k.toContent=function(a,b){if(!m&&(""==a&&(a=r),n!=a)){var d,f;if(b||(b={}),b.firstIn=!1,b.cbContentLoaded=q,m=!0,g&&g.call(null,a),b.lastHash=n,null==n)b.isFirstIn=!0,o=n,n=a,d=l[a],b.contentHash=d.contentHash,k.currentScene=d.stageClass,k.currentScene._isPopup||(w=n),d.stageClass.stageIn(b,c);else if(l[n]&&l[a])if(e&&e.apply(),f=l[n],d=l[a],o=n,n=a,f.stageClass===d.stageClass&&d.contentHash!==f.contentHash)f.stageClass.toContent(d.contentHash,function(){c()});else{k.currentScene=d.stageClass;var h=f.stageClass,i=d.stageClass,j=w;b.contentHash=d.contentHash,k.currentScene._isPopup||(w=n),1!=h._isPopup||i._isPopup?h._isPopup||1!=i._isPopup?1==h._isPopup&&1==i._isPopup?(h.hide(),i.show(c)):f.stageClass.stageOut(b,function(){d.stageClass.stageIn(b,c)}):i.show(c):j&&j!==n?(h.hide(),l[j].stageClass.stageOut(b,function(){d.stageClass.stageIn(b,c)})):h.hide(c)}}},k.loadTemplate=function(a,b,c,e){function f(a){function i(){a++,a>=b.length?(j&&!e&&j.hide(),c.apply(null)):f(a)}if(0==b.length)return j&&j.hide(),void c.apply(null);null==a&&(a=0);var k,l=b[a],m=l.url;l.startWeight&&(g=l.startWeight),l.weight&&(h=l.weight),u[m]?(l.dom=u[m],i()):(j&&j.progress(g),k=document.createElement("div"),$(k).load(m+"?v="+d,function(){u[m]=k;var a=b.extractClass;a||(a="extract-point");var c=l.dom=$(k).find("."+a)[0];$(c).toggleClass(a,!1),$("#invisible-container").append(c),$(c).waitForImages(function(){if(c.parentNode&&c.parentNode.removeChild(c),j){var a=(g+h)/100;j.progress(a)}i()},function(a,b){if(j){var c=(g+a/b*h)/100;j.progress(c)}},!0)}))}j&&j.show();var g=0,h=100;null!=a?Utility.preloadImages(a.list,f,function(a){j&&j.progress(a/100)}):f(0)}}(),function(){var a=".php",b="../api/";window.ApiProxy={callApi:function(c,d,e,f){function g(a){f&&f.call(null,a)}var h=b+c+a,i="POST";$.ajax({url:h,type:i,data:d,dataType:"json"}).done(g).fail(function(){g({error:"無法取得伺服器回應"})})}}}(),function(){var a=(window.Utility={},{}),b={};b.log="log",b.warn="warn",b.error="error",b.debug="debug",b.info="info",Utility.setConsoleMethod=function(b,c){1==c?console[b]=a[b]:console[b]=function(){}},Utility.disableAllConsoleMethods=function(){for(var a in b)this.setConsoleMethod(a,!1)},Utility.enableAllConsoleMethods=function(){for(var a in b)this.setConsoleMethod(a,!0)},function(){if(!window.console){window.console={};for(var c in b)console[b[c]]=function(){}}for(var c in b)a[b[c]]=console[b[c]];window.Array.prototype.indexOf||(window.Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=c<0?Math.ceil(c):Math.floor(c),c<0&&(c+=b);c<b;c++)if(c in this&&this[c]===a)return c;return-1})}();var c={};Utility.analyzeURL=function(a){if(!c[a]){var b=/^((http[s]?|ftp):\/)?\/?([^:\/\s]+)((\/\w+)*\/)([\w\-\.]+[^#?\s]+)(.*)?(#[\w\-]+)?$/;c[a]=a.match(b)}return c[a]},Utility.getPath=function(a){a||(a=window.location.href);var b=a.indexOf("?")==-1?a:a.substr(0,a.indexOf("?"));b.indexOf("#")!==-1&&(b=b.substr(0,b.indexOf("#")));var c=b.split("/"),d=c[c.length-1];for(d.indexOf(".")!==-1&&c.pop(),b=c.join("/");b.length&&"/"==b.charAt(b.length-1);)b=b.slice(0,b.length-1);return b+="/"},Utility.getProtocol=function(a){return a||(a=window.location.href),Utility.analyzeURL(a)[2]},Utility.urlParams=function(){var a=decodeURIComponent(window.location.href),b=a.split("?")[1];if(!b)return{};b=b.split("#")[0];for(var c={},d=b.split("&"),e=0;e<d.length;e++){var f=d[e].split("=");c[f[0]]=f[1]}return c}(),Utility.isLocalhost=function(){var a=window.location.toString().split("/")[2];return"localhost"==a||"192"==a.split(".")[0]}(),Utility.preloadImages=function(a,b,c,d){function e(){function g(){null!=i&&(i.collector[i.name]=j),j.onerror=null,j.onload=null,e()}if(c&&c.apply(null,[f/a.length*100<<0]),f>=a.length)return void(b&&b.apply());var h=a[f],i=null;"string"!=typeof h&&(i=h,h=i.url),f++;var j=new Image;j.onload=g,d&&(j.onerror=function(){console.error("load image error: ["+h+"]"),g()}),j.src=h}if(null==d&&(d=!0),!a||0==a.length)return void(b&&b.apply());var f=0;e()},Utility.shuffleArray=function(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},Utility.isiOS=function(){var a=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];if(navigator.platform)for(;a.length;)if(navigator.platform===a.pop())return!0;return!1}}(),function(){var a=window.PatternSamples={};a.email=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,a.phone=/^(09)[0-9]{8}$/,a.number=/[0-9]/g,a.nonNumber=/[^0-9]/g,a.onlySpace=/^\s*$/,a.localPhone=/^(0)\d{1,3}(-)\d{5,8}$/,a.personId=/^[A-Z]{1}[1-2]{1}[0-9]{8}$/,a.numberAndLetters=/^[a-zA-Z0-9]*$/}(),function(){"use strict";function a(){var a,c=$(window).width(),d=$(window).height(),e=b.settings.viewport;for(a=0;a<e.ranges.length&&!(e.ranges[a]>=c);a++);var f=e.index;e.index=a,e.width=c,e.height=d,e.changed=f!==e.index,SceneHandler.currentScene&&SceneHandler.currentScene.resize()}var b=window.Main={settings:{isLocal:!1,isMobile:!1,useFakeData:!1,isiOS:!1,isLineBrowser:!1,isBirthValided:!1,deadTime:null,viewport:{width:0,height:0,ranges:[640],index:-1,changed:!1}},hashArray:["/LandingPage","/Participate","/Participate/Product","/Participate/Form","/ParticipateRule"],firstHash:"",defaultHash:"/Participate",init:function(){function c(){SceneHandler.init(Main.hashArray,{defaultHash:b.defaultHash,listeningHashChange:!0,loadingClass:Loading,version:(new Date).getTime(),hashChangeTester:function(a){return b.settings.isBirthValided||"/LandingPage"==a?a:(a=null,SceneHandler.setHash("/LandingPage"),null)}}),b.firstHash=SceneHandler.getHash(),"1"==Utility.urlParams.skipLaw?SceneHandler.toFirstHash():SceneHandler.toHash("/LandingPage")}"scrollRestoration"in history&&(history.scrollRestoration="manual"),"1"==Utility.urlParams.skipLaw&&(b.settings.isBirthValided=!0),b.settings.isiOS=Utility.isiOS(),window._CLICK_=b.settings.isiOS?"touchend":"click",Menu.init(),c(),$(window).on("resize",a),a()}}}(),function(){window.MyTools={setupInput:function(a,b,c,d){var e=a.val();b&&(a.on("focus",function(){a.toggleClass("hint-mode",!1),a.val()==e&&a.val("")}),a.on("blur",function(){""==a.val()?(a.val(e),a.toggleClass("hint-mode",!0)):a.toggleClass("hint-mode",!1)}),a._checkOk=function(){return!(a.val()==e)}),a.on("input",function(){d&&a.val(a.val().toUpperCase()),c&&a.val().length>c&&a.val(a.val().substr(0,c))})}}}(),function(){function a(a,b,c){var d=e.container.find(".item-"+a);d.on(_CLICK_,function(){h.close(),c&&c.call()})}function b(){e.bar1=e.icon.find(".bar-1"),e.bar2=e.icon.find(".bar-2"),e.bar3=e.icon.find(".bar-3");var a=([e.bar1[0],e.bar2[0],e.bar3[0]],d=new TimelineMax);a.addLabel("start"),a.set(e.bar1,{marginTop:-9,transformOrigin:"center center"}),a.set(e.bar2,{marginTop:-1,transformOrigin:"center center"}),a.set(e.bar3,{marginTop:7,transformOrigin:"center center"}),a.to(e.bar1,.4,{marginTop:-1,ease:Power1.easeIn},0),a.to(e.bar3,.4,{marginTop:-1,ease:Power1.easeIn},0),a.set(e.bar2,{autoAlpha:0}),a.set(e.bar1,{marginLeft:-1,width:2,height:2}),a.to(e.bar1,.4,{marginTop:-6,height:12,ease:Power1.easeOut}),a.addLabel("hoverComplete"),a.to(e.bar1,.4,{rotation:45}),a.to(e.bar3,.4,{rotation:45},"-=.4"),a.addLabel("end"),a.pause()}function c(a,b){return void 0===b&&(b=!0),a.toggleClass("hide-mode",b),a._show=function(){b&&(b=!1,a.toggleClass("hide-mode",b))},a._hide=function(){b||(b=!0,a.toggleClass("hide-mode",b))},a}var d,e={},f=!1,g=!0,h=window.Menu={init:function(){e.container=$("#menu"),e.buttonContainer=e.container.find(".container"),e.icon=e.container.find(".icon").on("mouseover",function(){f||d.tweenTo("hoverComplete")}).on("mouseout",function(a){f||$.contains(e.icon[0],a.relatedTarget)===!1&&a.relatedTarget!==e.icon[0]&&d.tweenTo("start")}).on("mousedown",function(){f?h.close():h.open()}),b(),a(2,"story",function(){SceneHandler.toHash("/Story")}),a(6,"participate to part2",function(){SceneHandler.toHash("/Participate/Product")}),a(7,"participate to part3",function(){SceneHandler.toHash("/Participate/Form")}),a(8,"participate rule",function(){SceneHandler.toHash("/ParticipateRule")}),a(10,"to offical site",function(){window.open("http://www.theglenlivet.com.tw/")}),a(11,"to FB",function(){window.open("https://www.facebook.com/TheGlenlivetTW/")}),h.Logo=c($("#logo"),!0)},open:function(){f||(f=!0,d.tweenTo("end"),e.buttonContainer.toggleClass("open-mode",!0),$("#scene-container").toggleClass("menu-open-mode",!0),$(".footer").toggleClass("menu-open-mode",!0))},close:function(){f&&(f=!1,d.tweenTo("start"),e.buttonContainer.toggleClass("open-mode",!1),$("#scene-container").toggleClass("menu-open-mode",!1),$(".footer").toggleClass("menu-open-mode",!1))},show:function(){g&&(g=!1,e.icon.toggleClass("hide-mode",!1))},hide:function(){g||(g=!0,e.icon.toggleClass("hide-mode",!0),h.close())}}}(),function(){"use strict";function a(a){e.container=$("#landing-page"),e.year=e.container.find(".select-year"),e.month=e.container.find(".select-month"),e.day=e.container.find(".select-day");var b=new Date;b.setFullYear(b.getFullYear()-18),d=new DateCombo(e.year[0],e.month[0],e.day[0],null,null,null,null,"年","月","日",b),d.to(1998,1,1),e.btnSend=e.container.find(".btn-send").on(_CLICK_,function(){d.getDateString()?(Main.settings.isBirthValided=!0,Main.firstHash?(SceneHandler.toHash(Main.firstHash),Main.firstHash=null):SceneHandler.toHash(Main.defaultHash)):alert("請先選擇您的生日")}),e.container.css("visibility","visible").css("display","none"),f=!0,Loading.hide(),a&&a.call()}function b(a){e.container.css("display","block"),Menu.hide();var b=new TimelineMax;b.set(e.container,{autoAlpha:0}),b.to(e.container,.4,{autoAlpha:1}),b.add(function(){g=!0,a.apply()})}function c(a){g=!1;var b=new TimelineMax;b.to(e.container,.4,{autoAlpha:0}),b.add(function(){Menu.show(),e.container.css("display","none"),a.apply()})}var d,e={},f=!1,g=!1;window.LandingPage={init:function(){a()},stageIn:function(c,d){function e(){b(d)}f?e():a(e)},stageOut:function(a,b){c(b)},resize:function(){}}}(),function(){function a(a){function b(){SceneHandler.toHash("/ParticipateRule")}$("#invisible-container").append(a[0].dom),n.container=$("#participate"),n.topBar=n.container.find(".top-bar"),n["/Logo"]=n.container.find(".part-1"),n["/Product"]=n.container.find(".part-2"),n["/Form"]=n.container.find(".part-3"),n.arrowDown1=n["/Logo"].find(".arrow-down").on(_CLICK_,function(){p.toContent("/Product")}),n.arrowDown2=n["/Product"].find(".arrow-down").on(_CLICK_,function(){p.toContent("/Form")}),n.year=n.container.find("#select-year"),n.month=n.container.find("#select-month"),n.day=n.container.find("#select-day"),n.checkbox=n.container.find(".participate-checkbox");var f=new Date;f.setFullYear(f.getFullYear()-18),l=new DateCombo(n.year[0],n.month[0],n.day[0],null,null,null,null,"年","月","日",f),n.eventTimes=[n.container.find(".time-group-1"),n.container.find(".time-group-2"),n.container.find(".time-group-3"),n.container.find(".time-group-4")],n.eventSelect=n.container.find(".event-select"),n.genderSelect=n.container.find(".gender-select"),c(n.eventSelect),c(n.genderSelect),n.fields={name:n.container.find(".user-name"),phone:n.container.find(".user-phone"),email:n.container.find(".user-email")},MyTools.setupInput(n.fields.name,!0,20),MyTools.setupInput(n.fields.phone,!0,10),MyTools.setupInput(n.fields.email,!0,50),n.btnSend=n.container.find(".btn-send").on(_CLICK_,function(){i()}),n.btnRule=n.container.find(".btn-rule").on(_CLICK_,function(){SceneHandler.toHash("/ParticipateRule")}),n.btnPrivacy=n.container.find(".btn-privacy").on(_CLICK_,b),n.btnPrivacy2=n.container.find(".btn-privacy-2").on(_CLICK_,b),e(),d(),n.container.detach()}function b(a){function b(){d++,d<c||a.call()}var c=1,d=0,e="form_Canvas.js";$LAB.script(e).wait(b)}function c(a){a.on("change",function(){a.toggleClass("white-mode",0!=a[0].selectedIndex)})}function d(){var a,b,c,d=n.textCanvas=n.container.find(".text-animation");a=d[0],c=new lib.form_Canvas,b=new createjs.Stage(a),b.addChild(c),b.update(),createjs.Ticker.setFPS(lib.properties.fps),createjs.Ticker.addEventListener("tick",b)}function e(){var a,b,c,d,e,f={},g=[];for(a=0;a<m.length;a++)e=m[a],d=e.event_date,f[d]||(f[d]=[],g.push(d)),f[d].push(e);for(n.eventSelect.empty(),n.eventSelect.append("<option value='' disabled='disabled' selected='selected'>選擇場次</option>"),a=0;a<g.length;a++)for(d=g[a],c=$(document.createElement("optgroup")).attr("label",d),n.eventSelect.append(c),b=0;b<f[d].length;b++){e=f[d][b];var h=n.eventTimes[a].find(".time:nth-child("+(b+1)+")");"1"==e.participate_able&&parseInt(e.num_participated)<15?(h.toggleClass("filled",!1),c.append("<option value='"+e.id+"'>"+e.event_name+"</option>")):h.toggleClass("filled",!0)}}function f(){n.topBar.toggleClass("open-mode",$(window).scrollTop()>101)}function g(a){$("#scene-container").append(n.container),p.resize(),Menu.show();var b=new TimelineMax;b.set(n.container,{autoAlpha:0}),b.to(n.container,.4,{autoAlpha:1}),b.add(function(){$(window).on("scroll",f),$(window).trigger("scroll"),a.apply()})}function h(a){$(window).unbind("scroll",f);var b=new TimelineMax;b.to(n.container,.4,{autoAlpha:0}),b.add(function(){n.container.detach(),a.apply()})}function i(){var a=k();a&&(Loading.progress("資料傳輸中 ... 請稍候").show(),ApiProxy.callApi("participate",a,!1,function(a){a.error?(alert(a.error),"該場次名額已滿"==a.error?ApiProxy.callApi("get_event_data",null,null,function(a){a.error?alert(a.error):(m=a.data,e()),Loading.hide()}):Loading.hide()):(alert("資料送出成功"),j(),Loading.hide())}))}function j(){l.reset(),n.fields.name.val("").trigger("blur"),n.fields.phone.val("").trigger("blur"),n.fields.email.val("").trigger("blur"),$(n.eventSelect.find("option")[0]).prop({selected:!0}).trigger("change"),$(n.genderSelect.find("option")[0]).prop({selected:!0}).trigger("change")}function k(){var a,b={};if(b.gender=n.genderSelect.val(),!b.gender)return void alert("請選擇您的性別");if(b.event_id=n.eventSelect.val(),
!b.event_id)return void alert("請選擇活動場次");if(!n.checkbox[0].checked)return void alert("您必須同意遵守活動相關規範才能參加活動");if(a=n.fields.name[0],!n.fields.name._checkOk()||PatternSamples.onlySpace.test(a.value))return alert("請輸入您的名稱"),void a.focus();if(b.name=a.value,a=n.fields.phone[0],!PatternSamples.phone.test(a.value))return alert("請輸入正確的手機號碼"),void a.focus();if(b.phone=a.value,a=n.fields.email[0],!PatternSamples.email.test(a.value))return alert("請輸入正確的電子郵件信箱"),void a.focus();b.email=a.value;var c=l.getDateValue();return c.year&&c.month&&c.day?(b.birth_year=c.year,b.birth_month=c.month,b.birth_day=c.day,b):void alert("請輸入您的生日")}var l,m,n={},o=!1,p=window.Participate={stageIn:function(c,d){function e(a){a&&c.cbContentLoaded&&c.cbContentLoaded.call(),g(function(){c.contentHash?p.toContent(c.contentHash,d):d.call()})}function f(c){var d=[{url:"_participate.html",startWeight:0,weight:99,dom:null}];SceneHandler.loadTemplate(null,d,function(){b(function(){ApiProxy.callApi("get_event_data",null,null,function(b){Loading.hide(),m=b.data,a(d),o=!0,c.apply(null)})})},!0)}o?e():f(e)},stageOut:function(a,b){h(b)},toContent:function(a,b){if(o){a||(a="/Logo");var c=n[a],d=c.offset().top;"/Logo"!=a&&Main.settings.viewport.width<=640&&(d-=101),TweenLite.to(window,.8,{scrollTo:d,ease:Power1.easeInOut,onComplete:b})}},resize:function(){if(o){var a=Main.settings.viewport;n.textCanvas&&n.textCanvas.attr("width",Math.min(a.width,1920)).attr("height",Math.min(a.height,1080))}},reset:j}}(),function(){function a(){d.topBar.toggleClass("open-mode",d.container.scrollTop()>101)}function b(a){var b=[{url:"_participate_rule.html",startWeight:0,weight:100,dom:null}];SceneHandler.loadTemplate(null,b,function(){c(b),e=!0,a.apply(null)},0)}function c(a){$("#invisible-container").append(a[0].dom),d.container=$("#participate-rule"),d.contentContainer=d.container.find(".container"),d.topBar=d.container.find(".top-bar"),d.btnClose=d.container.find(".btn-close").on(_CLICK_,function(){SceneHandler.toLastHash()}),d.container.detach()}var d={},e=!1,f=window.ParticipateRule={_isPopup:!0,show:function(c){function g(){Menu.hide(),d.btnClose.toggleClass("showing-mode",!0),$("body").toggleClass("no-scroll-mode",!0).append(d.container),f.resize();var b=new TimelineMax;b.set(d.container,{autoAlpha:0}),b.to(d.container,.4,{autoAlpha:1}),b.add(function(){d.container.on("scroll",a),d.container.trigger("scroll"),c&&c.apply()})}e?g():b(g)},hide:function(b){d.container.unbind("scroll",a),Menu.show(),d.btnClose.toggleClass("showing-mode",!1);var c=new TimelineMax;c.to(d.container,.4,{autoAlpha:0}),c.add(function(){d.container.detach(),$("body").toggleClass("no-scroll-mode",!1),b&&b.apply()})},resize:function(a,b,c){}}}();