!function(a,b,c){function d(a,b){return typeof a===b}function e(){var a,b,c,e,f,g,h;for(var i in l)if(l.hasOwnProperty(i)){if(a=[],b=l[i],b.name&&(a.push(b.name.toLowerCase()),b.options&&b.options.aliases&&b.options.aliases.length))for(c=0;c<b.options.aliases.length;c++)a.push(b.options.aliases[c].toLowerCase());for(e=d(b.fn,"function")?b.fn():b.fn,f=0;f<a.length;f++)g=a[f],h=g.split("."),1===h.length?n[h[0]]=e:(!n[h[0]]||n[h[0]]instanceof Boolean||(n[h[0]]=new Boolean(n[h[0]])),n[h[0]][h[1]]=e),k.push((e?"":"no-")+h.join("-"))}}function f(a){var b=o.className,c=n._config.classPrefix||"";if(p&&(b=b.baseVal),n._config.enableJSClass){var d=new RegExp("(^|\\s)"+c+"no-js(\\s|$)");b=b.replace(d,"$1"+c+"js$2")}n._config.enableClasses&&(b+=" "+c+a.join(" "+c),p?o.className.baseVal=b:o.className=b)}function g(){return"function"!=typeof b.createElement?b.createElement(arguments[0]):p?b.createElementNS.call(b,"http://www.w3.org/2000/svg",arguments[0]):b.createElement.apply(b,arguments)}function h(a,b){if("object"==typeof a)for(var c in a)r(a,c)&&h(c,a[c]);else{a=a.toLowerCase();var d=a.split("."),e=n[d[0]];if(2==d.length&&(e=e[d[1]]),"undefined"!=typeof e)return n;b="function"==typeof b?b():b,1==d.length?n[d[0]]=b:(!n[d[0]]||n[d[0]]instanceof Boolean||(n[d[0]]=new Boolean(n[d[0]])),n[d[0]][d[1]]=b),f([(b&&0!=b?"":"no-")+d.join("-")]),n._trigger(a,b)}return n}function i(){var a=b.body;return a||(a=g(p?"svg":"body"),a.fake=!0),a}function j(a,c,d,e){var f,h,j,k,l="modernizr",m=g("div"),n=i();if(parseInt(d,10))for(;d--;)j=g("div"),j.id=e?e[d]:l+(d+1),m.appendChild(j);return f=g("style"),f.type="text/css",f.id="s"+l,(n.fake?n:m).appendChild(f),n.appendChild(m),f.styleSheet?f.styleSheet.cssText=a:f.appendChild(b.createTextNode(a)),m.id=l,n.fake&&(n.style.background="",n.style.overflow="hidden",k=o.style.overflow,o.style.overflow="hidden",o.appendChild(n)),h=c(m,a),n.fake?(n.parentNode.removeChild(n),o.style.overflow=k,o.offsetHeight):m.parentNode.removeChild(m),!!h}var k=[],l=[],m={_version:"3.3.1",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(a,b){var c=this;setTimeout(function(){b(c[a])},0)},addTest:function(a,b,c){l.push({name:a,fn:b,options:c})},addAsyncTest:function(a){l.push({name:null,fn:a})}},n=function(){};n.prototype=m,n=new n,n.addTest("webaudio",function(){var b="webkitAudioContext"in a,c="AudioContext"in a;return n._config.usePrefixes?b||c:c});var o=b.documentElement,p="svg"===o.nodeName.toLowerCase(),q=m._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];m._prefixes=q,n.addTest("webgl",function(){var b=g("canvas"),c="probablySupportsContext"in b?"probablySupportsContext":"supportsContext";return c in b?b[c]("webgl")||b[c]("experimental-webgl"):"WebGLRenderingContext"in a}),n.addTest("video",function(){var a=g("video"),b=!1;try{(b=!!a.canPlayType)&&(b=new Boolean(b),b.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),b.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),b.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""),b.vp9=a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,""),b.hls=a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,""))}catch(a){}return b});var r;!function(){var a={}.hasOwnProperty;r=d(a,"undefined")||d(a.call,"undefined")?function(a,b){return b in a&&d(a.constructor.prototype[b],"undefined")}:function(b,c){return a.call(b,c)}}(),m._l={},m.on=function(a,b){this._l[a]||(this._l[a]=[]),this._l[a].push(b),n.hasOwnProperty(a)&&setTimeout(function(){n._trigger(a,n[a])},0)},m._trigger=function(a,b){if(this._l[a]){var c=this._l[a];setTimeout(function(){var a,d;for(a=0;a<c.length;a++)(d=c[a])(b)},0),delete this._l[a]}},n._q.push(function(){m.addTest=h}),n.addAsyncTest(function(){function a(g){e++,clearTimeout(b);var i=g&&"playing"===g.type||0!==f.currentTime;return!i&&d>e?void(b=setTimeout(a,c)):(f.removeEventListener("playing",a,!1),h("videoautoplay",i),void f.parentNode.removeChild(f))}var b,c=200,d=5,e=0,f=g("video"),i=f.style;if(!(n.video&&"autoplay"in f))return void h("videoautoplay",!1);i.position="absolute",i.height=0,i.width=0;try{if(n.video.ogg)f.src="data:video/ogg;base64,T2dnUwACAAAAAAAAAABmnCATAAAAAHDEixYBKoB0aGVvcmEDAgEAAQABAAAQAAAQAAAAAAAFAAAAAQAAAAAAAAAAAGIAYE9nZ1MAAAAAAAAAAAAAZpwgEwEAAAACrA7TDlj///////////////+QgXRoZW9yYSsAAABYaXBoLk9yZyBsaWJ0aGVvcmEgMS4xIDIwMDkwODIyIChUaHVzbmVsZGEpAQAAABoAAABFTkNPREVSPWZmbXBlZzJ0aGVvcmEtMC4yOYJ0aGVvcmG+zSj3uc1rGLWpSUoQc5zmMYxSlKQhCDGMYhCEIQhAAAAAAAAAAAAAEW2uU2eSyPxWEvx4OVts5ir1aKtUKBMpJFoQ/nk5m41mUwl4slUpk4kkghkIfDwdjgajQYC8VioUCQRiIQh8PBwMhgLBQIg4FRba5TZ5LI/FYS/Hg5W2zmKvVoq1QoEykkWhD+eTmbjWZTCXiyVSmTiSSCGQh8PB2OBqNBgLxWKhQJBGIhCHw8HAyGAsFAiDgUCw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDAwPEhQUFQ0NDhESFRUUDg4PEhQVFRUOEBETFBUVFRARFBUVFRUVEhMUFRUVFRUUFRUVFRUVFRUVFRUVFRUVEAwLEBQZGxwNDQ4SFRwcGw4NEBQZHBwcDhATFhsdHRwRExkcHB4eHRQYGxwdHh4dGxwdHR4eHh4dHR0dHh4eHRALChAYKDM9DAwOExo6PDcODRAYKDlFOA4RFh0zV1A+EhYlOkRtZ00YIzdAUWhxXDFATldneXhlSFxfYnBkZ2MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEhIVGRoaGhoSFBYaGhoaGhUWGRoaGhoaGRoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhESFh8kJCQkEhQYIiQkJCQWGCEkJCQkJB8iJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQREhgvY2NjYxIVGkJjY2NjGBo4Y2NjY2MvQmNjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRISEhUXGBkbEhIVFxgZGxwSFRcYGRscHRUXGBkbHB0dFxgZGxwdHR0YGRscHR0dHhkbHB0dHR4eGxwdHR0eHh4REREUFxocIBERFBcaHCAiERQXGhwgIiUUFxocICIlJRcaHCAiJSUlGhwgIiUlJSkcICIlJSUpKiAiJSUlKSoqEBAQFBgcICgQEBQYHCAoMBAUGBwgKDBAFBgcICgwQEAYHCAoMEBAQBwgKDBAQEBgICgwQEBAYIAoMEBAQGCAgAfF5cdH1e3Ow/L66wGmYnfIUbwdUTe3LMRbqON8B+5RJEvcGxkvrVUjTMrsXYhAnIwe0dTJfOYbWrDYyqUrz7dw/JO4hpmV2LsQQvkUeGq1BsZLx+cu5iV0e0eScJ91VIQYrmqfdVSK7GgjOU0oPaPOu5IcDK1mNvnD+K8LwS87f8Jx2mHtHnUkTGAurWZlNQa74ZLSFH9oF6FPGxzLsjQO5Qe0edcpttd7BXBSqMCL4k/4tFrHIPuEQ7m1/uIWkbDMWVoDdOSuRQ9286kvVUlQjzOE6VrNguN4oRXYGkgcnih7t13/9kxvLYKQezwLTrO44sVmMPgMqORo1E0sm1/9SludkcWHwfJwTSybR4LeAz6ugWVgRaY8mV/9SluQmtHrzsBtRF/wPY+X0JuYTs+ltgrXAmlk10xQHmTu9VSIAk1+vcvU4ml2oNzrNhEtQ3CysNP8UeR35wqpKUBdGdZMSjX4WVi8nJpdpHnbhzEIdx7mwf6W1FKAiucMXrWUWVjyRf23chNtR9mIzDoT/6ZLYailAjhFlZuvPtSeZ+2oREubDoWmT3TguY+JHPdRVSLKxfKH3vgNqJ/9emeEYikGXDFNzaLjvTeGAL61mogOoeG3y6oU4rW55ydoj0lUTSR/mmRhPmF86uwIfzp3FtiufQCmppaHDlGE0r2iTzXIw3zBq5hvaTldjG4CPb9wdxAme0SyedVKczJ9AtYbgPOzYKJvZZImsN7ecrxWZg5dR6ZLj/j4qpWsIA+vYwE+Tca9ounMIsrXMB4Stiib2SPQtZv+FVIpfEbzv8ncZoLBXc3YBqTG1HsskTTotZOYTG+oVUjLk6zhP8bg4RhMUNtfZdO7FdpBuXzhJ5Fh8IKlJG7wtD9ik8rWOJxy6iQ3NwzBpQ219mlyv+FLicYs2iJGSE0u2txzed++D61ZWCiHD/cZdQVCqkO2gJpdpNaObhnDfAPrT89RxdWFZ5hO3MseBSIlANppdZNIV/Rwe5eLTDvkfWKzFnH+QJ7m9QWV1KdwnuIwTNtZdJMoXBf74OhRnh2t+OTGL+AVUnIkyYY+QG7g9itHXyF3OIygG2s2kud679ZWKqSFa9n3IHD6MeLv1lZ0XyduRhiDRtrNnKoyiFVLcBm0ba5Yy3fQkDh4XsFE34isVpOzpa9nR8iCpS4HoxG2rJpnRhf3YboVa1PcRouh5LIJv/uQcPNd095ickTaiGBnWLKVWRc0OnYTSyex/n2FofEPnDG8y3PztHrzOLK1xo6RAml2k9owKajOC0Wr4D5x+3nA0UEhK2m198wuBHF3zlWWVKWLN1CHzLClUfuoYBcx4b1llpeBKmbayaR58njtE9onD66lUcsg0Spm2snsb+8HaJRn4dYcLbCuBuYwziB8/5U1C1DOOz2gZjSZtrLJk6vrLF3hwY4Io9xuT/ruUFRSBkNtUzTOWhjh26irLEPx4jPZL3Fo3QrReoGTTM21xYTT9oFdhTUIvjqTkfkvt0bzgVUjq/hOYY8j60IaO/0AzRBtqkTS6R5ellZd5uKdzzhb8BFlDdAcrwkE0rbXTOPB+7Y0FlZO96qFL4Ykg21StJs8qIW7h16H5hGiv8V2Cflau7QVDepTAHa6Lgt6feiEvJDM21StJsmOH/hynURrKxvUpQ8BH0JF7BiyG2qZpnL/7AOU66gt+reLEXY8pVOCQvSsBtqZTNM8bk9ohRcwD18o/WVkbvrceVKRb9I59IEKysjBeTMmmbA21xu/6iHadLRxuIzkLpi8wZYmmbbWi32RVAUjruxWlJ//iFxE38FI9hNKOoCdhwf5fDe4xZ81lgREhK2m1j78vW1CqkuMu/AjBNK210kzRUX/B+69cMMUG5bYrIeZxVSEZISmkzbXOi9yxwIfPgdsov7R71xuJ7rFcACjG/9PzApqFq7wEgzNJm2suWESPuwrQvejj7cbnQxMkxpm21lUYJL0fKmogPPqywn7e3FvB/FCNxPJ85iVUkCE9/tLKx31G4CgNtWTTPFhMvlu8G4/TrgaZttTChljfNJGgOT2X6EqpETy2tYd9cCBI4lIXJ1/3uVUllZEJz4baqGF64yxaZ+zPLYwde8Uqn1oKANtUrSaTOPHkhvuQP3bBlEJ/LFe4pqQOHUI8T8q7AXx3fLVBgSCVpMba55YxN3rv8U1Dv51bAPSOLlZWebkL8vSMGI21lJmmeVxPRwFlZF1CpqCN8uLwymaZyjbXHCRytogPN3o/n74CNykfT+qqRv5AQlHcRxYrC5KvGmbbUwmZY/29BvF6C1/93x4WVglXDLFpmbapmF89HKTogRwqqSlGbu+oiAkcWFbklC6Zhf+NtTLFpn8oWz+HsNRVSgIxZWON+yVyJlE5tq/+GWLTMutYX9ekTySEQPLVNQQ3OfycwJBM0zNtZcse7CvcKI0V/zh16Dr9OSA21MpmmcrHC+6pTAPHPwoit3LHHqs7jhFNRD6W8+EBGoSEoaZttTCZljfduH/fFisn+dRBGAZYtMzbVMwvul/T/crK1NQh8gN0SRRa9cOux6clC0/mDLFpmbarmF8/e6CopeOLCNW6S/IUUg3jJIYiAcDoMcGeRbOvuTPjXR/tyo79LK3kqqkbxkkMRAOB0GODPItnX3Jnxro/25Ud+llbyVVSN4ySGIgHA6DHBnkWzr7kz410f7cqO/Syt5KqpFVJwn6gBEvBM0zNtZcpGOEPiysW8vvRd2R0f7gtjhqUvXL+gWVwHm4XJDBiMpmmZtrLfPwd/IugP5+fKVSysH1EXreFAcEhelGmbbUmZY4Xdo1vQWVnK19P4RuEnbf0gQnR+lDCZlivNM22t1ESmopPIgfT0duOfQrsjgG4tPxli0zJmF5trdL1JDUIUT1ZXSqQDeR4B8mX3TrRro/2McGeUvLtwo6jIEKMkCUXWsLyZROd9P/rFYNtXPBli0z398iVUlVKAjFlY437JXImUTm2r/4ZYtMy61hf16RPJIU9nZ1MABAwAAAAAAAAAZpwgEwIAAABhp658BScAAAAAAADnUFBQXIDGXLhwtttNHDhw5OcpQRMETBEwRPduylKVB0HRdF0A";else{if(!n.video.h264)return void h("videoautoplay",!1);f.src="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAs1tZGF0AAACrgYF//+q3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0OCByMjYwMSBhMGNkN2QzIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNSAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MSBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTEgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJfcHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9MCB3ZWlnaHRwPTIga2V5aW50PTI1MCBrZXlpbnRfbWluPTEwIHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAD2WIhAA3//728P4FNjuZQQAAAu5tb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAAZAABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAACGHRyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAZAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAgAAAAIAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAAGQAAAAAAAEAAAAAAZBtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAACgAAAAEAFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAE7bWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAA+3N0YmwAAACXc3RzZAAAAAAAAAABAAAAh2F2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAgACAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAxYXZjQwFkAAr/4QAYZ2QACqzZX4iIhAAAAwAEAAADAFA8SJZYAQAGaOvjyyLAAAAAGHN0dHMAAAAAAAAAAQAAAAEAAAQAAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAABRzdHN6AAAAAAAAAsUAAAABAAAAFHN0Y28AAAAAAAAAAQAAADAAAABidWR0YQAAAFptZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAAC1pbHN0AAAAJal0b28AAAAdZGF0YQAAAAEAAAAATGF2ZjU2LjQwLjEwMQ=="}}catch(a){return void h("videoautoplay",!1)}f.setAttribute("autoplay",""),f.style.cssText="display:none",o.appendChild(f),setTimeout(function(){f.addEventListener("playing",a,!1),b=setTimeout(a,c)},0)});var s=m.testStyles=j;n.addTest("touchevents",function(){var c;if("ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch)c=!0;else{var d=["@media (",q.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");s(d,function(a){c=9===a.offsetTop})}return c}),n.addTest("devicemotion","DeviceMotionEvent"in a),n.addTest("deviceorientation","DeviceOrientationEvent"in a),e(),f(k),delete m.addTest,delete m.addAsyncTest;for(var t=0;t<n._q.length;t++)n._q[t]();a.Modernizr=n}(window,document),function(){function a(a){console.log("statusChangeCallback"),console.log(a),"connected"===a.status?console.log("connected"):"not_authorized"===a.status?console.log("not authorized"):console.log("not login")}function b(a){for(var b=atob(a.split(",")[1]),c=new ArrayBuffer(b.length),d=new Uint8Array(c),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([c],{type:"image/png"})}function c(a,b,c){this.api=a,this.apiParams=b,this.after=null,this.dataList=[],this.thereIsMore=!0,this.cbFetchComplete=c,this.lastFetchIndex=0}var d,e=window.FBHelper={},f=["public_profile"];e.uid=null,e.uname=null,e.init=function(b,c,e){"string"==typeof b&&(b={appId:b,cookie:!0,xfbml:!0,version:"v2.4"}),d=b.appId,window.fbAsyncInit=function(){FB.init(b),e&&FB.getLoginStatus(function(b){a(b)}),c&&c.apply()},function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/zh_TW/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk")},e.login=function(a,b,c){a||(a=f),FB.login(function(a){a.authResponse?(e.uid=a.authResponse.userID,"connected"==a.status?null!=b&&b.apply(null,[a]):null!=c&&c.apply(null,[{action:"login",response:a,type:a.status,message:"not connected"}])):null!=c&&c.apply(null,[{action:"login",response:a,type:a.status,message:"user cancel login"}])},{scope:a})},e.getPublicProfile=function(a){FB.api("/me",function(b){e.uname=b.name,a.apply(null,[b])})},e.checkLoginStatus=function(a,b){function c(c){for(var d={},e=a.length,f=0,g=0;g<a.length;g++)d[a[g]]=!1;FB.api("/me/permissions",function(a){if(a&&a.data&&a.data.length){var g,h;for(g=0;g<a.data.length;g++)h=a.data[g],void 0!==d[h.permission]&&(d[h.permission]=!0,f++);f<e?b.call(null,{message:"lack permission",permissionDic:d},null):b.call(null,null,c)}else b.call(null,{message:"check permission fail"},null)})}FB.getLoginStatus(function(d){"connected"===d.status?a?c(d.authResponse):b.call(null,null,d.authResponse):b.call(null,{message:"no connect"},null)})},e.postImageToFacebook=function(a,c,d){var e,f=a.toDataURL("image/png");try{e=b(f)}catch(a){console.log(a)}var g=new FormData;g.append("access_token",c),g.append("source",e);try{$.ajax({url:"https://graph.facebook.com/me/photos?access_token="+c,type:"POST",data:g,processData:!1,contentType:!1,cache:!1,success:function(a){d.call(null,null,a)},error:function(a,b,c){d.call(null,"error "+c+" Status "+a.status)},complete:function(){}})}catch(a){d.call(null,a)}},window.FBData=c,c.prototype.fetch=function(){var a=this;return a.thereIsMore||(console.log("warning: trying to fetch data where there is no more."),a.cbFetchComplete.call(a,a.dataList)),a.lastFetchIndex=a.dataList.length,FB.api(a.api,"GET",a.apiParams,function(b){b.error?console.error(b.error):(a.dataList=a.dataList.concat(b.data),a.apiParams.after=Boolean(b.paging&&b.paging.next)?b.paging.cursors.after:null,a.apiParams.after?a.thereIsMore=!0:(delete a.apiParams.after,a.thereIsMore=!1),a.cbFetchComplete.call(a,a.dataList))}),this}}(),function(){"use strict";function a(b,c,d,e,f,g,h,i,j,k,l){function m(){var a,f=$(b).val(),g=$(c).val(),i=""!=f&&f==v;i&&g>w&&$(c).prop("selectedIndex",0);var j=i?w:12;for(a=1;a<=12;a++)$($(c).find("option")[a]).css("display",a<=j?"block":"none");if($(d).find("option").remove(),$(d).append('<option value="" selected>'+h+"</option>\n"),""!=f&&""!=g){var l=new Date(f,g,-1),m=l.getDate()+1;for(i&&g==w&&(m=x),a=1;a<=m;a++)$(d).append('<option value="'+a+'">'+a+k+"</option>\n");$(d).prop("selectedIndex",0),e&&e.apply(null,[newDayIndex])}}function n(a,e,f){$(b).prop("selectedIndex",parseInt(a)-1900+1),$(c).prop("selectedIndex",parseInt(e)),m(),$(d).prop("selectedIndex",parseInt(f))}function o(){n(1899,0,0)}function p(){$(b).attr("disabled","disabled"),$(c).attr("disabled","disabled"),$(d).attr("disabled","disabled")}function q(){$(b).removeAttr("disabled"),$(c).removeAttr("disabled"),$(d).removeAttr("disabled")}function r(){return{year:$(b).val(),month:$(c).val(),day:$(d).val()}}function s(a){null==a&&(a="/");var e=r(b,c,d);return""==e.year||""==e.month||""==e.day?null:e.year+a+e.month+a+e.day}var t=a.prototype=this;t.update=m,t.getDateValue=r,t.getDateString=s,t.to=n,t.lock=p,t.unlock=q,t.reset=o,$(b).find("option").remove(),$(c).find("option").remove(),$(d).find("option").remove(),null==f&&(f="年"),null==g&&(g="月"),null==h&&(h="日"),i=null==i?"":" "+i,j=null==j?"":" "+j,k=null==k?"":" "+k,$(b).append('<option value="" selected>'+f+"</option>\n"),$(c).append('<option value="" selected>'+g+"</option>\n");var u;l||(l=new Date);var v=l.getFullYear(),w=l.getMonth()+1,x=l.getDate();for(u=1900;u<=l.getFullYear();u++)$(b).append('<option value="'+u+'">'+u+i+"</option>\n");for(u=1;u<=12;u++)$(c).append('<option value="'+u+'">'+u+j+"</option>\n");$(b).change(m),$(c).change(m),$(b).prop("selectedIndex",0),$(c).prop("selectedIndex",0),$(d).prop("selectedIndex",0),m()}window.FormHelper={};var b,c,d;b=["台北市","基隆市","新北市","宜蘭縣","新竹市","新竹縣","桃園縣","苗栗縣","台中市","彰化縣","南投縣","嘉義市","嘉義縣","雲林縣","台南市","高雄市","澎湖縣","屏東縣","台東縣","花蓮縣","金門縣","連江縣","南海諸島"],c=new Array(23),d=new Array(23),c[0]=["中正區","大同區","中山區","松山區","大安區","萬華區","信義區","士林區","北投區","內湖區","南港區","文山區"],c[1]=["仁愛區","信義區","中正區","中山區","安樂區","暖暖區","七堵區"],c[2]=["萬里區","金山區","板橋區","汐止區","深坑區","石碇區","瑞芳區","平溪區","雙溪區","貢寮區","新店區","坪林區","烏來區","永和區","中和區","土城區","三峽區","樹林區","鶯歌區","三重區","新莊區","泰山區","林口區","蘆洲區","五股區","八里區","淡水區","三芝區","石門區"],c[3]=["宜蘭市","頭城鎮","礁溪鄉","壯圍鄉","員山鄉","羅東鎮","三星鄉","大同鄉","五結鄉","冬山鄉","蘇澳鎮","南澳鄉"],c[4]=new Array("新竹市"),c[5]=["竹北市","湖口鄉","新豐鄉","新埔鄉","關西鎮","芎林鄉","寶山鄉","竹東鎮","五峰鄉","橫山鄉","尖石鄉","北埔鄉","峨嵋鄉"],c[6]=["中壢市","平鎮市","龍潭鄉","楊梅鎮","新屋鄉","觀音鄉","桃園市","龜山鄉","八德市","大溪鎮","復興鄉","大園鄉","蘆竹鄉"],c[7]=["竹南鎮","頭份鎮","三灣鄉","南庄鄉","獅潭鄉","後龍鎮","通霄鎮","苑裡鎮","苗栗市","造橋鄉","頭屋鄉","公館鄉","大湖鄉","泰安鄉","銅鑼鄉","三義鄉","西湖鄉","卓蘭鄉"],c[8]=["中區","東區","南區","西區","北區","北屯區","西屯區","南屯區","太平區","大里區","霧峰區","烏日區","豐原區","后里區","石岡區","東勢區","和平區","新社區","潭子區","大雅區","神岡區","大肚區","沙鹿區","龍井區","梧棲區","清水區","大甲區","外埔區","大安區"],c[9]=["彰化市","芬園鄉","花壇鄉","秀水鄉","鹿港鎮","福興鄉","線西鄉","和美鎮","伸港鄉","員林鎮","社頭鄉","永靖鄉","埔心鄉","溪湖鎮","大村鄉","埔鹽鄉","田中鎮","北斗鎮","田尾鄉","埤頭鄉","溪州鄉","竹塘鄉","二林鎮","大城鄉","芳苑鄉","二水鄉"],c[10]=["南投市","中寮鄉","草屯鎮","國姓鄉","埔里鎮","仁愛鄉","名間鄉","集集鄉","水里鄉","魚池鄉","信義鄉","竹山鎮","鹿谷鄉"],c[11]=new Array("嘉義市"),c[12]=["番路鄉","梅山鄉","竹崎鄉","阿里山鄉","中埔鄉","大埔鄉","水上鄉","鹿草鄉","太保市","朴子市","東石鄉","六腳鄉","新港鄉","民雄鄉","大林鎮","溪口鄉","義竹鄉","布袋鎮"],c[13]=["斗南市","大埤鄉","虎尾鎮","土庫鎮","褒忠鄉","東勢鄉","台西鄉","崙背鄉","麥寮鄉","斗六市","林內鄉","古坑鄉","莿桐鄉","西螺鎮","二崙鄉","北港鎮","水林鄉","口湖鄉","四湖鄉","元長鄉"],c[14]=["中區","東區","南區","西區","北區","安平區","安南區","永康區","歸仁區","新化區","左鎮區","玉井區","楠西區","南化區","仁德區","關廟區","龍崎區","官田區","麻豆區","佳里區","西港區","七股區","將軍區","學甲區","北門區","新營區","後壁區","白河區","東山區","六甲區","下營區","柳營區","鹽水區","善化區","大內區","山上區","新市區","安定區"],c[15]=["新興區","前金區","苓雅區","鹽埕區","鼓山區","旗津區","前鎮區","三民區","楠梓區","小港區","左營區","仁武區","大社區","岡山區","路竹區","阿蓮區","田寮區","燕巢區","橋頭區","梓官區","彌陀區","永安區","湖內區","鳳山區","大寮區","林園區","鳥松區","大樹區","旗山區","美濃區","六龜區","內門區","杉林區","甲仙區","桃源區","那瑪夏區","茂林區","茄萣區"],c[16]=["馬公市","西嶼鄉","望安鄉","七美鄉","白沙鄉","湖西鄉"],c[17]=["屏東市","三地門鄉","霧台鄉","瑪家鄉","九如鄉","里港鄉","高樹鄉","鹽埔鄉","長治鄉","麟洛鄉","竹田鄉","內埔鄉","萬丹鄉","潮州鎮","泰武鄉","來義鄉","萬巒鄉","嵌頂鄉","新埤鄉","南州鄉","林邊鄉","東港鎮","琉球鄉","佳冬鄉","新園鄉","枋寮鄉","枋山鄉","春日鄉","獅子鄉","車城鄉","牡丹鄉","恆春鎮","滿州鄉"],c[18]=["台東市","綠島鄉","蘭嶼鄉","延平鄉","卑南鄉","鹿野鄉","關山鎮","海端鄉","池上鄉","東河鄉","成功鎮","長濱鄉","太麻里鄉","金峰鄉","大武鄉","達仁鄉"],c[19]=["花蓮市","新城鄉","秀林鄉","吉安鄉","壽豐鄉","鳳林鎮","光復鄉","豐濱鄉","瑞穗鄉","萬榮鄉","玉里鎮","卓溪鄉","富里鄉"],c[20]=["金沙鎮","金湖鎮","金寧鄉","金城鎮","烈嶼鄉","烏坵鄉"],c[21]=["南竿鄉","北竿鄉","莒光鄉","東引"],c[22]=["東沙","西沙"],d=new Array(24),d[0]=["100","103","104","105","106","108","110","111","112","114","115","116"],d[1]=["200","201","202","203","204","205","206"],d[2]=["207","208","220","221","222","223","224","226","227","228","231","232","233","234","235","236","237","238","239","241","242","243","244","247","248","249","251","252","253"],d[3]=["260","261","262","263","264","265","266","267","268","269","270","272"],d[4]=new Array("300"),d[5]=["302","303","304","305","306","307","308","310","311","312","313","314","315"],d[6]=["320","324","325","326","327","328","330","333","334","335","336","337","338"],d[7]=["350","351","352","353","354","356","357","358","360","361","362","363","364","365","366","367","368","369"],d[8]=["400","401","402","403","404","406","407","408","411","412","413","414","420","421","422","423","424","426","427","428","429","432","433","434","435","436","437","438","439"],d[9]=["500","502","503","504","505","506","507","508","509","510","511","5112","513","514","515","516","520","521","522","523","524","525","526","527","528","530"],d[10]=["540","541","542","544","545","546","551","552","553","555","556","557","558"],d[11]=new Array("600"),d[12]=["602","603","604","605","606","607","608","611","612","613","614","615","616","621","622","623","624","625"],d[13]=["630","631","632","633","634","635","636","637","638","640","643","646","647","648","649","651","652","653","654","655"],d[14]=["700","701","702","703","704","708","709","710","711","712","713","714","715","716","717","718","719","720","721","722","723","724","725","726","727","730","731","732","733","734","735","736","737","741","742","743","744","745"],d[15]=["800","801","802","803","804","805","806","807","811","812","813","814","815","820","821","822","823","824","825","826","827","828","829","830","831","832","833","840","842","843","844","845","846","847","848","849","851","852"],d[16]=["880","881","882","883","884","885"],d[17]=["900","901","902","903","904","905","906","907","908","909","911","912","913","920","921","922","923","924","925","926","927","928","929","931","932","940","941","942","943","944","945","946","947"],d[18]=["950","951","952","953","954","955","956","957","958","959","961","962","963","964","965","966"],d[19]=["970","971","972","973","974","975","976","977","978","979","981","982","983"],d[20]=["890","891","892","893","894","896"],d[21]=["209","210","211","212"],d[22]=["817","819","290"],FormHelper.completeCounty=function(a,c,d,e,f){a.find("option").remove(),a.append('<option value="" selected>縣市</option>\n');for(var g=0;g<b.length;g++)d==b[g]?a.append('<option value="'+b[g]+'" selected>'+b[g]+"</option>\n"):a.append('<option value="'+b[g]+'">'+b[g]+"</option>\n");FormHelper.completeZone(a,c,e,f),a.on("change",function(){FormHelper.completeZone(a,c,e,f)})},FormHelper.completeZone=function(a,b,e,f){if(b.find("option").remove(),b.append('<option value="" selected>區</option>\n'),""!=a.val())for(var g=a.get(0).selectedIndex-1,h=c[g],i=d[g],j=0;j<h.length;j++){var k=1==f?" "+i[j]:"",l=h[j]+k;e==h[j]?b.append('<option value="'+l+'" selected>'+l+"</option>\n"):b.append('<option value="'+l+'">'+l+"</option>\n")}},FormHelper.getAddressValue=function(a,e){var f=a.get(0).selectedIndex-1,g=e.get(0).selectedIndex-1,h=c[f],i=d[f],j=void 0==b[f]?null:b[f],k=void 0==h?null:h[g],l=void 0==i?null:i[g];return{county:j,zone:k,zipCode:l}},window.DateCombo=a}(),function(){"use strict";function a(a){var b=parseInt(a);return isNaN(b)&&(b=0),b}var b=window.Helper={};b.getSize_cover=function(a,b,c,d){var e,f,g=a/b,h=c/d;h>g?(f=b,e=f*h):(e=a,f=e/h);var i=e/c,j=a/i,k=b/i,l={x:.5*(c-j),y:.5*(d-k),width:j,height:k};return{width:e,height:f,ratio:i,contentCenterBound:l}},b.getSize_contain=function(a,b,c,d){var e,f,g=a/b,h=c/d;return h>g?(e=a,f=e/h):(f=b,e=f*h),{width:e,height:f,ratio:e/c}},Helper.extract=function(a,b,c,d){null==d&&(d=0),null==b&&(b=document);var e=$(b).find(a).get(d);return e||console.error("can't find dom, selector: "+a+", source: "+b),Helper.getInitValue(e),null!=c&&c.appendChild(e),e},Helper.$extract=function(a,b,c,d){null==d&&(d=0),null==b&&(b=document);var e=$(b).find(a).get(d);return e||console.error("can't find dom, selector: "+a+", source: "+b),Helper.getInitValue(e),null!=c&&c.appendChild(e),$(e)},Helper.pxToPercent=function(b,c,d,e,f){function g(b,c,d){null==d&&(d=100);var e=Helper.styleDic[b];e||(e=b);var g=a(i.css(e)),h=g/c*d+"%";f?f[b]=h:0!=g&&i.css(e,h)}e||(e={w:!0,h:!1,l:!0,t:!1,r:!0,b:!1});var h,i=$(b);for(h in e){var j=1==e[h]?c:d;g(h,j)}},Helper.clearStyles=function(a){$(a).removeAttr("style")},Helper.getInitValue=function(b,c,d,e,f,g){b.init||(b.init={}),b.geom||(b.geom={}),f&&Helper.clearStyles(b);var h,i;if(g?(h=b.init[g]={},i=b.geom[g]={}):(h=b.init,i=b.geom),c||(b.currentStyle?(i.w=h.w=a(b.currentStyle.width),i.h=h.h=a(b.currentStyle.height),i.ml=h.ml=a(b.currentStyle.marginLeft),i.mt=h.mt=a(b.currentStyle.marginTop),i.mr=h.mr=a(b.currentStyle.marginRight),i.mb=h.mb=a(b.currentStyle.marginBottom),i.t=h.t=a(b.currentStyle.top),i.l=h.l=a(b.currentStyle.left),i.r=h.r=a(b.currentStyle.right),i.b=h.b=a(b.currentStyle.bottom)):(i.w=h.w=$(b).width(),i.h=h.h=$(b).height(),i.ml=h.ml=a($(b).css("margin-left")),i.mt=h.mt=a($(b).css("margin-top")),i.mr=h.mr=a($(b).css("margin-right")),i.mb=h.mb=a($(b).css("margin-bottom")),i.t=h.t=a($(b).css("top")),i.l=h.l=a($(b).css("left")),i.r=h.r=a($(b).css("right")),i.b=h.b=a($(b).css("bottom")))),i.scale=h.scale=1,d)for(var j=0;j<d.length;j++){var k=d[j];h[k]=i[k]=a($(b).css(k))}if(e){var l,m,n;l=e.width,m=e.height,n=e.styleDic,Helper.pxToPercent(b,l,m,n,h)}},Helper.styleDic={l:"left",r:"right",t:"top",b:"bottom",ml:"margin-left",mr:"margin-right",mt:"margin-top",mb:"margin-bottom",w:"width",h:"height"},Helper.applyTransform=function(a,b,c,d,e,f){var g,h;f?(g=a.init[f],h=a.geom[f]):(g=a.init,h=a.geom);var i,j,k,l,m=null!=b?g.scale*b:g.scale,n=$(a);if(c)for(j=c.length,i=0;i<j;i++)k=c[i],l=Helper.styleDic[k],l||(l=k),h[k]=g[k]*m,n.css(l,h[k]+"px");if(d)for(j=d.length,i=0;i<j;i++)k=d[i],l=Helper.styleDic[k],h[k]=g[k]*m,n.css(l,h[k]+"%");if(e)for(j=e.length,i=0;i<j;i++)k=e[i],l=Helper.styleDic[k],l||(l=k),n.css(l,g[k])},Helper.transformDom=function(a,b,c,d,e){var f=null!=b?a.init.scale*b:a.init.scale;0!=e&&(e===!0?(a.geom.w=a.init.w*f,a.geom.h=a.init.h*f,$(a).css("width",a.geom.w).css("height",a.geom.h)):(c.l&&(a.geom.l=a.init.l*f,$(a).css("left",a.geom.l)),c.t&&(a.geom.t=a.init.t*f,$(a).css("top",a.geom.t)))),0!=c&&(c===!0?(a.geom.t=a.init.t*f,a.geom.l=a.init.l*f,$(a).css("top",a.geom.t).css("left",a.geom.l)):(c.l&&(a.geom.l=a.init.l*f,$(a).css("left",a.geom.l)),c.t&&(a.geom.t=a.init.t*f,$(a).css("top",a.geom.t)),c.r&&(a.geom.r=a.init.r*f,$(a).css("right",a.geom.r)),c.b&&(a.geom.b=a.init.b*f,$(a).css("bottom",a.geom.b)))),0!=d&&(d===!0?(a.geom.mt=a.init.mt*f,a.geom.ml=a.init.ml*f,$(a).css("margin-top",a.geom.mt).css("margin-left",a.geom.ml)):(c.ml&&(a.geom.ml=a.init.ml*f,$(a).css("margin-left",a.geom.ml)),c.mt&&(a.geom.mt=a.init.mt*f,$(a).css("margin-top",a.geom.mt)),c.mr&&(a.geom.mr=a.init.mr*f,$(a).css("margin-right",a.geom.mr)),c.mb&&(a.geom.mb=a.init.mb*f,$(a).css("margin-bottom",a.geom.mb))))},Helper.downScaleImage=function(a,b,c,d,e,f){var g=document.createElement("canvas");g.width=a.width,g.height=a.height;var h=g.getContext("2d");return h.drawImage(a,0,0),Helper.downScaleCanvas(g,b,c,d,e,f)},Helper.downScaleCanvas=function(a,b,c,d,e,f){if(c||(c=0),d||(d=0),!(b<1&&b>0))throw"scale must be a positive number <1 ";var g=b*b,h=a.width,i=a.height,j=Math.floor(h*b),k=Math.floor(i*b),l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=!1,B=!1,C=a.getContext("2d").getImageData(0,0,h,i).data,D=new Float32Array(3*j*k),E=0,F=0,G=0;for(m=0;m<i;m++)for(p=m*b,t=0|p,q=3*t*j,B=t!=(0|p+b),B&&(y=t+1-p,z=p+b-t-1),l=0;l<h;l++,n+=4)o=l*b,s=0|o,r=q+3*s,A=s!=(0|o+b),A&&(w=s+1-o,x=o+b-s-1),E=C[n],F=C[n+1],G=C[n+2],A||B?A&&!B?(u=w*b,D[r]+=E*u,D[r+1]+=F*u,D[r+2]+=G*u,v=x*b,D[r+3]+=E*v,D[r+4]+=F*v,D[r+5]+=G*v):B&&!A?(u=y*b,D[r]+=E*u,D[r+1]+=F*u,D[r+2]+=G*u,v=z*b,D[r+3*j]+=E*v,D[r+3*j+1]+=F*v,D[r+3*j+2]+=G*v):(u=w*y,D[r]+=E*u,D[r+1]+=F*u,D[r+2]+=G*u,v=x*y,D[r+3]+=E*v,D[r+4]+=F*v,D[r+5]+=G*v,v=w*z,D[r+3*j]+=E*v,D[r+3*j+1]+=F*v,D[r+3*j+2]+=G*v,v=x*z,D[r+3*j+3]+=E*v,D[r+3*j+4]+=F*v,D[r+3*j+5]+=G*v):(D[r]+=E*g,D[r+1]+=F*g,D[r+2]+=G*g);var H=document.createElement("canvas");H.width=e?e:j,H.height=f?f:k;var I=H.getContext("2d"),J=I.getImageData(0,0,j,k),K=J.data,L=0;for(n=0,r=0;L<j*k;n+=3,r+=4,L++)K[r]=Math.ceil(D[n]),K[r+1]=Math.ceil(D[n+1]),K[r+2]=Math.ceil(D[n+2]),K[r+3]=255;return I.putImageData(J,c,d),H},Helper.imageToCanvas=function(a,b,c){var d=document.createElement("canvas"),e=1,f=b,g=c;d.width=f,d.height=g;var h=d.getContext("2d"),i=Helper.getSize_cover(f,g,a.width,a.height),j=.5*(f-i.width),k=.5*(g-i.height);return i.ratio<1?($(d).detach(),d=Helper.downScaleImage(a,i.ratio,j,k,f,g)):h.drawImage(a,0,0,a.width,a.height,j,k,i.width*e,i.height),d},Helper.getContextBoundingBox=function(a,b){void 0===b&&(b=15);var c,d,e,f,g,h,i=a.canvas.width,j=a.canvas.height,k=a.getImageData(0,0,i,j).data;a:for(d=j;d--;)for(c=i;c--;)if(k[4*(i*d+c)+3]>b){h=d;break a}if(h){a:for(c=i;c--;)for(d=h+1;d--;)if(k[4*(i*d+c)+3]>b){g=c;break a}a:for(c=0;c<=g;++c)for(d=h+1;d--;)if(k[4*(i*d+c)+3]>b){e=c;break a}a:for(d=0;d<=h;++d)for(c=e;c<=g;++c)if(k[4*(i*d+c)+3]>b){f=d;break a}return{x:e,y:f,maxX:g,maxY:h,w:g-e,h:h-f}}},Helper.precentPullToRefresh=function(){var a=function(a){function b(b){a=b.touches[0].clientY}function c(b){var c=b.touches[0].clientY,d=c-a;return a=c,d>0}a=a||0;var d=!1;return{touchstartHandler:function(a){1==a.touches.length&&(b(a),d=0===window.pageYOffset)},touchmoveHandler:function(a){if(d&&(d=!1,c(a)))return void a.preventDefault()}}}();document.addEventListener("touchstart",a.touchstartHandler),document.addEventListener("touchmove",a.touchmoveHandler)},Helper.changeQueryParam=function(a,b,c){var d=new RegExp("([?&])"+b+"=.*?(&|$)","i"),e=a.indexOf("?")!==-1?"&":"?";return a.match(d)?a.replace(d,"$1"+b+"="+c+"$2"):a+e+b+"="+c},Helper.removeURLParameter=function(a,b){var c=a.split("?");if(c.length>=2){for(var d=encodeURIComponent(b)+"=",e=c[1].split(/[&;]/g),f=e.length;f-- >0;)e[f].lastIndexOf(d,0)!==-1&&e.splice(f,1);return a=c[0]+(e.length>0?"?"+e.join("&"):"")}return a},Helper.getParameterByName=function(a,b){b||(b=window.location.href),a=a.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null},Helper.selectIntoArray=function(a,b,c,d){function e(b){var e=a.find(b);return e.length>0&&c.push(e[0]),d&&(d[b]=e),e}if(b.constructor!==Array)return e(b);for(var f=0;f<b.length;f++)e(b[f])},Helper.clearElementsStyles=function(a,b){if(b){var c;for(c=0;c<b.length;c++)a.css(b[c],"")}else a.attr("style","")}}(),function(){function a(a){return h&&(a=h.call(null,a)),a}function b(a){a||(a=r),t&&k.getHash()!=a?k.setHash(a):k.toContent(a)}function c(){m=!1,null!=p&&(p.apply(),p=null),f&&f.apply()}var d,e,f,g,h,i,j,k=window.SceneHandler={},l={},m=!1,n=null,o=null,p=null,q=null,r="/Index",s=!1,t=!0,u={},v={},w=null;k.currentScene=null,k.processHashNames=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];_contentClasses.push(window[d]),b.push("/"+d)}return b},k.getLastHash=function(){return o},k.init=function(b,c){c=c||{},d=c.version||"0",e=c.cbBeforeChange,f=c.cbAfterChange,h=c.hashChangeTester,g=c.cbContentChange,q=c.cbContentLoaded,j=c.loadingClass,r=c.defaultHash||"/Index",t=void 0===c.listeningHashChange||c.listeningHashChange;var i,n,o;if(c.blockHashs)for(i=0;i<c.blockHashs.length;i++)v[c.blockHashs[i]]=!0;var s,u,w;for(i=0;i<b.length;i++){if(n=b[i],s=n.split("/"),u=s[1],w=null,2==s.length);else{if(3!=s.length){console.error("illegal hash: "+n);continue}w="/"+s[2]}window[u]?(o={hash:n,index:i,stageClass:window[u],contentHash:w},l[n]=o):console.error("class for: "+u+" is not exist")}t&&k.onHashChange(function(b){""==b&&(b=r),b=a(b),b&&l[b]&&!v[b]&&(m?p=function(){k.toContent(b)}:k.toContent(b))})},k.setLock=function(a){s=a},k.onHashChange=function(a){function b(){s||(i?i=!1:a.apply(null,[k.getHash()]))}if("onhashchange"in window)window.onhashchange=function(){b()};else{var c=window.location.hash;window.setInterval(function(){window.location.hash!=c&&(c=window.location.hash,b())},100)}},k.toLastHash=function(){k.toHash(o)},k.toLastNonPopupHash=function(){k.toHash(w)},k.getHash=function(){return window.location.hash.replace("#","")},k.setHash=function(a,b){b&&(i=!0),window.location.hash="#"+a},k.toFirstHash=function(b){var c=k.getHash();if(t&&l[c]&&!v[c]||(c=r),c=a(c)){var d=l[c];if(d.stageClass._isPopup){var e=c;p=function(){k.toContent(e)},c=r}return k.toContent(c,b),c}},k.toHash=function(a){v[a]?k.toContent(a):b(a)},k.toContent=function(a,b){if(!m&&(""==a&&(a=r),n!=a)){var d,f;if(b||(b={}),
b.firstIn=!1,b.cbContentLoaded=q,m=!0,g&&g.call(null,a),b.lastHash=n,null==n)b.isFirstIn=!0,o=n,n=a,d=l[a],b.contentHash=d.contentHash,k.currentScene=d.stageClass,k.currentScene._isPopup||(w=n),d.stageClass.stageIn(b,c);else if(l[n]&&l[a])if(e&&e.apply(),f=l[n],d=l[a],o=n,n=a,f.stageClass===d.stageClass&&d.contentHash!==f.contentHash)f.stageClass.toContent(d.contentHash,function(){c()});else{k.currentScene=d.stageClass;var h=f.stageClass,i=d.stageClass,j=w;b.contentHash=d.contentHash,k.currentScene._isPopup||(w=n),1!=h._isPopup||i._isPopup?h._isPopup||1!=i._isPopup?1==h._isPopup&&1==i._isPopup?(h.hide(),i.show(c)):f.stageClass.stageOut(b,function(){d.stageClass.stageIn(b,c)}):i.show(c):j&&j!==n?(h.hide(),l[j].stageClass.stageOut(b,function(){d.stageClass.stageIn(b,c)})):h.hide(function(){i.executeAfterPopupClosed&&i.executeAfterPopupClosed.call(),c()})}}},k.loadTemplate=function(a,b,c,e,f){function g(a){function k(){a++,a>=b.length?(!j||f||e||j.hide(),c.apply(null)):g(a)}if(0==b.length)return j&&!f&&j.hide(),void c.apply(null);null==a&&(a=0);var l,m=b[a],n=m.url;m.startWeight&&(h=m.startWeight),m.weight&&(i=m.weight),u[n]?(m.dom=u[n],k()):(j&&!f&&j.progress(.01*h),l=document.createElement("div"),$(l).load(n+"?v="+d,function(){u[n]=l;var a=b.extractClass;a||(a="extract-point");var c=m.dom=$(l).find("."+a)[0];$(c).toggleClass(a,!1),$("#invisible-container").append(c),$(c).waitForImages(function(){if(c.parentNode&&c.parentNode.removeChild(c),j&&!f){var a=(h+i)/100;j.progress(a)}k()},function(a,b){if(j&&!f){var c=(h+a/b*i)/100;j.progress(c)}},!0)}))}j&&!f&&j.show();var h=0,i=100;null!=a?Utility.preloadImages(a.list,g,function(a){j&&!f&&j.progress(a/100)}):g(0)}}(),function(){function a(){i=!0,e=console.log.bind(console),console.log=k.add}function b(){var a="";if(h)for(var b=0;b<f.length;b++)b>0&&(a+="<br/>"),a+="> "+f[b];else a="> "+f[f.length-1];d.innerHTML=a,c.style.height=d.clientHeight+8+"px"}var c,d,e,f=[],g=10,h=!1,i=!1,j=26,k=window.Logger={init:function(e){return c=document.createElement("div"),c.style.position="fixed",c.style.width="100%",c.style.height=j+"px",c.style.bottom="0",c.style.backgroundColor="black",c.style.zIndex=8e3,c.style.color="white",c.style.overflow="hidden",d=document.createElement("div"),d.style.position="absolute",d.style.width="100%",d.style.height="auto",d.style.bottom="5px",d.style.left="5px",c.appendChild(d),a(),b(),c.addEventListener("click",function(){h?k.close():k.open()}),k},show:function(){return document.body.appendChild(c),k},hide:function(){return c.parentNode&&document.body.removeChild(c),k},open:function(){if(!h)return h=!0,b(),k},close:function(){if(h)return h=!1,b(),k},add:function(a){return f.push(a),f.length>g&&f.shift(),b(),i&&e.call(null,a),k}}}(),function(){var a=".php",b="../api/";window.ApiProxy={callApi:function(c,d,e,f){function g(a){f&&f.call(null,a)}var h=b+c+a,i="POST";$.ajax({url:h,type:i,data:d,dataType:"json"}).done(g).fail(function(){g({error:"無法取得伺服器回應"})})}}}(),function(){var a=(window.Utility={},{}),b={};b.log="log",b.warn="warn",b.error="error",b.debug="debug",b.info="info",Utility.setConsoleMethod=function(b,c){1==c?console[b]=a[b]:console[b]=function(){}},Utility.disableAllConsoleMethods=function(){for(var a in b)this.setConsoleMethod(a,!1)},Utility.enableAllConsoleMethods=function(){for(var a in b)this.setConsoleMethod(a,!0)},function(){if(!window.console){window.console={};for(var c in b)console[b[c]]=function(){}}for(var c in b)a[b[c]]=console[b[c]];window.Array.prototype.indexOf||(window.Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=c<0?Math.ceil(c):Math.floor(c),c<0&&(c+=b);c<b;c++)if(c in this&&this[c]===a)return c;return-1})}();var c={};Utility.analyzeURL=function(a){if(!c[a]){var b=/^((http[s]?|ftp):\/)?\/?([^:\/\s]+)((\/\w+)*\/)([\w\-\.]+[^#?\s]+)(.*)?(#[\w\-]+)?$/;c[a]=a.match(b)}return c[a]},Utility.getPathWithFilename=function(){return window.location.href.replace(window.location.search,"").replace(window.location.hash,"").replace("?","")},Utility.getPath=function(a){a||(a=window.location.href);var b=a.indexOf("?")==-1?a:a.substr(0,a.indexOf("?"));b.indexOf("#")!==-1&&(b=b.substr(0,b.indexOf("#")));var c=b.split("/"),d=c[c.length-1];for(d.indexOf(".")!==-1&&c.pop(),b=c.join("/");b.length&&"/"==b.charAt(b.length-1);)b=b.slice(0,b.length-1);return b+="/"},Utility.getProtocol=function(a){return a||(a=window.location.href),Utility.analyzeURL(a)[2]},Utility.urlParams=function(){var a=decodeURIComponent(window.location.href),b=a.split("?")[1];if(!b)return{};b=b.split("#")[0];for(var c={},d=b.split("&"),e=0;e<d.length;e++){var f=d[e].split("=");c[f[0]]=f[1]}return c}(),Utility.isLocalhost=function(){var a=window.location.toString().split("/")[2];return"localhost"==a||"192"==a.split(".")[0]}(),Utility.preloadImages=function(a,b,c,d){function e(){function g(){null!=i&&(i.collector[i.name]=j),j.onerror=null,j.onload=null,e()}if(c&&c.apply(null,[f/a.length*100<<0]),f>=a.length)return void(b&&b.apply());var h=a[f],i=null;"string"!=typeof h&&(i=h,h=i.url),f++;var j=new Image;j.onload=g,d&&(j.onerror=function(){console.error("load image error: ["+h+"]"),g()}),j.src=h}if(null==d&&(d=!0),!a||0==a.length)return void(b&&b.apply());var f=0;e()},Utility.shuffleArray=function(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},Utility.isiOS=function(){var a=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];if(navigator.platform)for(;a.length;)if(navigator.platform===a.pop())return!0;return!1}}(),function(){var a=window.PatternSamples={};a.email=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,a.phone=/^(09)[0-9]{8}$/,a.number=/[0-9]/g,a.nonNumber=/[^0-9]/g,a.onlySpace=/^\s*$/,a.localPhone=/^(0)\d{1,3}(-)\d{5,8}$/,a.personId=/^[A-Z]{1}[1-2]{1}[0-9]{8}$/,a.numberAndLetters=/^[a-zA-Z0-9]*$/}(),function(){function a(a){var d=$(a);if(!a._viewports){var e=d.attr("resizable"),f=e.split(";");a._viewports=[];for(var g=0;g<f.length;g++){var h=!1,i=f[g];i.match("c")&&(h=!0,i=i.replace("c",""));var j=i.split("p"),k=j[0]?j[0].split("x"):[0,0],l=j[1]?j[1].split("x"):[0,0],m=!!l;a._viewports.push({w:parseInt(k[0]),h:parseInt(k[1]),paddingW:parseInt(l[0]),paddingH:parseInt(l[1]),hasPadding:m,resizeByParent:h})}}var n=a._viewports[c.modeIndex];if(n){if(ScalableContent.enableDrawBounds&&!a._boundDom&&b(d,n),a._boundDom){$(a._boundDom).css("width",n.w+"%").css("height",n.h+"%").css("left",.5*-n.w+"%").css("top",.5*-n.h+"%");var o=n.w+" x "+n.h;(n.paddingW||n.paddingH)&&(o="size: "+o+"</br>padding: "+n.paddingW+" x "+n.paddingH),a._boundDom.textDom.innerHTML=o}var p=c.width,q=c.height;if(n.resizeByParent){var r=d.parent();p=r.width(),q=r.height()}var s=Helper.getSize_contain(p-2*n.paddingW,q-2*n.paddingH,n.w,n.h).ratio;s>1&&(s=1),d.css("width",100*s).css("height",100*s)}}function b(a,b){if(ScalableContent.enableDrawBounds){var c=document.createElement("div");c.className="text";var d=document.createElement("div");d.className="bound",$(d).css("width",b.w+"%").css("height",b.h+"%").css("left",.5*-b.w+"%").css("top",.5*-b.h+"%"),d.appendChild(c),d.textDom=c,a.prepend(d),a[0]._boundDom=d}}var c={width:0,height:0,viewWidthRanges:[640,1280],modeIndex:-1,modeChanged:!1};window.ScalableContent={enableFixFullImage:!0,enableDrawBounds:!0,init:function(a){c.viewWidthRanges=a},updateView:function(a,b){for(var d=c,e=d.modeIndex,f=0;a>d.viewWidthRanges[f]&&f<d.viewWidthRanges.length;)f++;d.modeIndex=f,d.modeChanged=e!=d.modeIndex,d.width=a,d.height=b},updateResizeAble:function(){var b=$(document).find("[resizable]");$.each(b,function(b,c){a(c)})},fixFullImage:function(a){if(ScalableContent.enableFixFullImage){var b=a.find("[full-image='']");$.each(b,function(a,b){var c,d=$(b);if(d.attr("full-image","handled"),c=d.css("background-image")){c=c.slice(5,c.length-2);var e=document.createElement("img");e.setAttribute("width","100%"),e.setAttribute("height","100%"),e.setAttribute("full-size-image-for",b.className),e.src=c,e.className="full-size-image",$(b).prepend(e).css("background-image","none")}}),b=a.find("[full-btn]"),$.each(b,function(a,b){var c=$(b);c.removeAttr("full-btn"),c.toggleClass("full-size-btn",!0),c.find("img").toggleClass("full-size-btn-image",!0)}),b=a.find("[hover-fix]"),$.each(b,function(a,b){var c=$(b);c.removeAttr("hover-fix"),c.on("mouseover",function(){c.toggleClass("hovered",!0)}),c.on("mouseout",function(){c.toggleClass("hovered",!1)})})}}}}(),function(){"use strict";function a(){try{if(navigator.isCocoonJS)return!0;var a=document.createElement("canvas"),b=a.getContext("webgl")||a.getContext("experimental-webgl");return null!=b&&!!window.WebGLRenderingContext}catch(a){return!1}}function b(){var a={};a.whiteCover=$("<div>",{class:"white-cover"});var b=!0;g.showWhiteCover=function(){if(b){b=!1,$("body").append(a.whiteCover);var c=new TimelineMax;c.set(a.whiteCover,{autoAlpha:0}),c.to(a.whiteCover,.4,{autoAlpha:1,ease:Power1.easeOut})}},g.hideWhiteCover=function(){if(!b){b=!0;var c=new TimelineMax;c.to(a.whiteCover,.9,{autoAlpha:0,ease:Power3.easeIn}),c.add(function(){a.whiteCover.detach()})}}}function c(){var a,b=$(window).width(),c=$(window).height(),d=g.settings.viewport;for(a=0;a<d.ranges.length&&!(d.ranges[a]>=b);a++);var e=d.index;d.index=a,d.width=b,d.height=c,d.changed=e!==d.index,SceneHandler.currentScene&&SceneHandler.currentScene.resize();var f=$("#scene-container");ScalableContent.updateView(f.width(),f.height()),ScalableContent.updateResizeAble()}function d(){if(location.hash.match("access_token")&&location.hash.match("state")){g.settings.isBirthValided=!0;var a=location.hash.replace("#","?");if(a){g.settings.fbToken=Helper.getParameterByName("access_token",a);var b=Helper.getParameterByName("state",a);window.location.hash="#"+b,"/Story/Fingerprint"==b&&(g.settings.startPhase=6)}}}function e(){if(history&&history.replaceState){var a=Helper.removeURLParameter(location.href,"sharetype");window.history.replaceState({path:a},"",a)}}function f(a,b,c){function d(){var b=c?encodeURI(c):encodeURI(Utility.getPathWithFilename()),d="https://www.facebook.com/dialog/oauth?response_type=token&client_id="+Main.settings.fb_appid+"&scope="+Main.settings.fbPermissions.join(",")+"&state="+a+"&redirect_uri="+b;window.open(d,"_self")}function e(a){a&&(Main.settings.fbToken=a.accessToken,Main.settings.fbUid=a.userID),Loading.hide(),b&&b.apply()}a||(a="/Index"),Loading.progress("登入 Facebook 中...請稍候").show(),Main.settings.fbUid?e():Main.settings.isiOS||Main.settings.isLineBrowser?FB.getLoginStatus(function(a){"connected"===a.status?e(a.authResponse):d()}):FB.login(function(a){a.error?alert("登入 Facebook 失敗"):a.authResponse?e(a.authResponse):Loading.hide()},{scope:Main.settings.fbPermissions,return_scopes:!0,auth_type:"rerequest"})}var g=window.Main={version:"0.0.0",demoSettings:{fb_appid:"181931492244009",path:"demo.ogilvyrw.com/website/theglenlivet-Cipher/phase2/"},localSettings:{fb_appid:"181932332243925",path:"http://local.savorks.com/projects/hogarth-ogilvy/Cipher-IT/app/"},settings:{fb_appid:"181926195577872",fbPermissions:[],path:"http://www.theglenlivet.com.tw/events/2016Cipher/dist/",isLocal:!1,isMobile:!1,useFakeData:!1,isiOS:!1,isLineBrowser:!1,isBirthValided:!1,deadTime:null,startPhase:0,viewport:{width:0,height:0,ranges:[640],index:-1,changed:!1}},soundSettings:{folder:"./misc/",globalClassName:"SP",defaultFadeDuration:1},hashArray:["/LandingPage","/Intro","/Story","/Story/Evidences","/Story/TattooMan","/Story/Backpacker","/Story/Bartender","/Story/SportGirl","/Story/Businessman","/Story/Door","/Story/Key","/Story/Phone","/Story/Poster","/Story/Photos","/Story/Billboard","/Story/Fingerprint","/Story/Medal","/Story/Briefcase","/Story/ExitConfirm","/HappyEnd/Yes","/HappyEnd/NotReally","/HappyEnd/Form","/Roulette","/Notes","/Participate","/Participate/Product","/Participate/Form","/ParticipateRule","/StoryRule"],firstHash:"",defaultHash:"/Intro",init:function(){function f(){SceneHandler.init(Main.hashArray,{defaultHash:g.defaultHash,listeningHashChange:!0,loadingClass:Loading,version:(new Date).getTime(),cbBeforeChange:function(){Menu.close()},hashChangeTester:function(a){return g.settings.isBirthValided||"/LandingPage"==a?a.match("/Story")&&!g.settings.isWebGLSupported?(alert("您的瀏覽器不支援 WebGL"),SceneHandler.setHash("/Participate/Product"),null):a:(a=null,SceneHandler.setHash("/LandingPage"),null)}});var a=SceneHandler.getHash();"/LandingPage"!=a&&(g.firstHash=SceneHandler.getHash()),g.settings.isBirthValided?SceneHandler.toFirstHash():SceneHandler.toHash("/LandingPage")}e(),CSSPlugin.defaultTransformPerspective=400,"local.savorks.com"==window.location.host||"socket.savorks.com"==window.location.host?$.extend(g.settings,g.localSettings):"demo.ogilvyrw.com"==window.location.host&&$.extend(g.settings,g.demoSettings),g.settings.isLineBrowser=Boolean(navigator.userAgent.match("Line")),g.settings.isiOS=Utility.isiOS(),g.version=(new Date).getTime(),"scrollRestoration"in history&&(history.scrollRestoration="manual"),g.settings.isWebGLSupported=a(),Utility.urlParams.startPhase&&(g.settings.startPhase=parseInt(Utility.urlParams.startPhase)),Modernizr.touchevents&&"1"==Utility.urlParams.debug&&Logger.init(!0).show(),ScalableContent.init([640,1920]),ScalableContent.enableFixFullImage=!1,ScalableContent.enableDrawBounds="1"==Utility.urlParams.drawbound,"1"==Utility.urlParams.skipLaw&&(g.settings.isBirthValided=!0),g.settings.isiOS=Utility.isiOS(),window._CLICK_=g.settings.isiOS?"touchend":"click",d(),b(),Menu.init(),FBHelper.init(Main.settings.fb_appid),f(),$(window).on("resize",c),c()},loginFB:f}}(),function(){window.MyTools={setupInput:function(a,b,c,d){var e=a.val();b&&(a.on("focus",function(){a.toggleClass("hint-mode",!1),a.val()==e&&a.val("")}),a.on("blur",function(){""==a.val()?(a.val(e),a.toggleClass("hint-mode",!0)):a.toggleClass("hint-mode",!1)}),a._checkOk=function(){return!(a.val()==e)}),a.on("input",function(){d&&a.val(a.val().toUpperCase()),c&&a.val().length>c&&a.val(a.val().substr(0,c))})}}}(),function(){function a(a){this.$dom=a,a.css("background-color","transparent")}function b(a){var b,c,d,e=1;a.progress<=.5?(b=2*a.progress*(1+e),c=100*(b-e),d=100*b,a.$dom.css("background-image","radial-gradient(circle, rgba(0, 0, 0, .85) "+c+"%, rgba(0, 0, 0, 0) "+d+"%)")):(b=2*(a.progress-.5)*(1+e),c=100*(b-e),d=100*b,a.$dom.css("background-image","radial-gradient(circle, rgba(0, 0, 0, 0) "+c+"%, rgba(0, 0, 0, .85) "+d+"%)"))}window.BackgroundAnimation=a,a.prototype={progress:0,$dom:null,tl:null,show:function(a){var c=new TimelineMax;c.set(this,{progress:0}),c.to(this,1.1,{progress:.5,ease:Power1.easeOut,onUpdate:b,onUpdateParams:[this]}),a&&c.add(a,"-=.5")},hide:function(a){var c=new TimelineMax;c.set(this,{progress:.5}),c.to(this,1.1,{progress:1,ease:Power1.easeIn,onUpdate:b,onUpdateParams:[this]}),a&&c.add(a)}}}(),function(){function a(a,b,c){var d=e.container.find(".item-"+a);d.on(_CLICK_,function(){h.close(),c&&c.call()})}function b(){e.bar1=e.icon.find(".bar-1"),e.bar2=e.icon.find(".bar-2"),e.bar3=e.icon.find(".bar-3");var a=d=new TimelineMax;a.addLabel("start"),a.set(e.bar1,{marginLeft:-6,marginTop:-9,width:12,autoAlpha:1,transformOrigin:"center center"}),a.set(e.bar2,{marginLeft:-6,marginTop:-1,width:12,autoAlpha:1,transformOrigin:"center center"}),a.set(e.bar3,{marginLeft:-6,marginTop:7,width:12,autoAlpha:1,transformOrigin:"center center"}),a.to(e.bar1,.3,{marginTop:-1,ease:Power1.easeIn},0),a.to(e.bar3,.3,{marginTop:-1,ease:Power1.easeIn},0),a.set(e.bar2,{autoAlpha:0}),a.set(e.bar1,{marginLeft:-1,width:2,height:2}),a.to(e.bar1,.3,{marginTop:-6,height:12,ease:Power1.easeOut}),a.addLabel("hoverComplete"),a.to(e.bar1,.3,{rotation:45}),a.to(e.bar3,.3,{rotation:45},"-=.3"),a.addLabel("end"),a.pause()}function c(a,b){return void 0===b&&(b=!0),a.toggleClass("hide-mode",b),a._show=function(){b&&(b=!1,a.toggleClass("hide-mode",b))},a._hide=function(){b||(b=!0,a.toggleClass("hide-mode",b))},a}var d,e={},f=!1,g=!0,h=window.Menu={init:function(){SoundSwitch.init(),e.container=$("#menu"),e.buttonContainer=e.container.find(".container"),e.icon=e.container.find(".icon").on("mouseover",function(){f||d.tweenTo("hoverComplete")}).on("mouseout",function(a){f||$.contains(e.icon[0],a.relatedTarget)===!1&&a.relatedTarget!==e.icon[0]&&d.tweenTo("start")}).on("mousedown",function(){f?h.close():h.open()}),b(),a(2,"story",function(){SceneHandler.toHash("/Story")}),a(3,"story rule",function(){SceneHandler.toHash("/StoryRule")}),a(6,"participate to part2",function(){SceneHandler.toHash("/Participate/Product")}),a(7,"participate to part3",function(){SceneHandler.toHash("/Participate/Form")}),a(8,"participate rule",function(){SceneHandler.toHash("/ParticipateRule")}),a(10,"Roulette",function(){var a,b="https://cipherapp.theglenlivet.com",c=!1,d=function(){a.close(),SceneHandler.toHash("/Roulette")};window.addEventListener("message",function(a){(a.origin||a.originalEvent.origin)===b&&"cookie set"===a.data&&(c=!0,d())},!1),a=window.open(b+"/cookie","Setting cookie...","toolbar=no,height=100,width=200"),window.setTimeout(function(){c||d()},5e3)}),a(11,"Notes",function(){SceneHandler.toHash("/Notes")}),a(12,"to offical site",function(){window.open("http://www.theglenlivet.com.tw/")}),a(13,"to FB",function(){window.open("https://www.facebook.com/TheGlenlivetTW/")}),h.Logo=c($("#logo"),!0),h.Logo.on(_CLICK_,function(){SceneHandler.toHash("/Intro")})},open:function(){f||(f=!0,d.tweenTo("end"),e.buttonContainer.toggleClass("open-mode",!0),$("#scene-container").toggleClass("menu-open-mode",!0),$(".footer").toggleClass("menu-open-mode",!0))},close:function(){f&&(f=!1,d.tweenTo("start"),e.buttonContainer.toggleClass("open-mode",!1),$("#scene-container").toggleClass("menu-open-mode",!1),$(".footer").toggleClass("menu-open-mode",!1))},show:function(){g&&(g=!1,e.icon.toggleClass("hide-mode",!1))},hide:function(){g||(g=!0,e.icon.toggleClass("hide-mode",!0),h.close())}}}(),function(){function a(){Cookies.set("soundOn",c,{expires:7}),d.btn.toggleClass("off-mode",!c),window.SP&&TweenMax.to(window.SP,1,{volume:c?1:0})}var b=!0,c=!0,d={},e=window.SoundSwitch={$doms:null,init:function(){e.$doms=d,d.container=$("#sound-switch"),d.btn=d.container.find(".btn-sound").on(_CLICK_,function(){e.setSoundOn(!c)}),void 0===Cookies.get("soundOn")&&Cookies.set("soundOn",c,{expires:7}),c="true"===Cookies.get("soundOn"),a()},getSoundOn:function(){return c},setSoundOn:function(b){c=b,a()},show:function(a){b&&(b=!1,d.container.toggleClass("hide-mode",b))},hide:function(a){b||(b=!0,d.container.toggleClass("hide-mode",b))},update:a}}(),function(){"use strict";function a(a){e.container=$("#landing-page"),e.year=e.container.find(".select-year"),e.month=e.container.find(".select-month"),e.day=e.container.find(".select-day");var b=new Date;d=new DateCombo(e.year[0],e.month[0],e.day[0],null,null,null,null,"年","月","日",b),d.to(1998,1,1),e.btnSend=e.container.find(".btn-send").on(_CLICK_,function(){if(d.getDateString()){var a=d.getDateValue(),b=new Date;b.setFullYear(a.year),b.setMonth(a.month-1),b.setDate(a.day);var c=new Date;if(c.setFullYear(c.getFullYear()-18),b.getTime()>c.getTime())return void alert("很抱歉，您必須滿 18 歲才能參加活動");Main.settings.isBirthValided=!0,Main.firstHash?(SceneHandler.toHash(Main.firstHash),Main.firstHash=null):SceneHandler.toHash(Main.defaultHash)}else alert("請先選擇您的生日")}),e.container.css("visibility","visible").css("display","none"),f=!0,Loading.hide(),a&&a.call()}function b(a){e.container.css("display","block"),Menu.hide();var b=new TimelineMax;b.set(e.container,{autoAlpha:0}),b.to(e.container,.4,{autoAlpha:1}),b.add(function(){g=!0,a.apply()})}function c(a){g=!1;var b=new TimelineMax;b.to(e.container,.4,{autoAlpha:0}),b.add(function(){e.container.css("display","none"),a.apply()})}var d,e={},f=!1,g=!1;window.LandingPage={init:function(){a()},stageIn:function(c,d){function e(){b(d)}f?e():a(e)},stageOut:function(a,b){c(b)},resize:function(){}}}(),function(){function a(a){$("#invisible-container").append(a[0].dom),k.container=$("#intro"),k.leftContent=k.container.find(".left-content"),k.btnPlay=k.container.find(".btn-play").on(_CLICK_,function(){m?SceneHandler.toHash("/Story"):SceneHandler.toHash("/Story/Key"),m=!0}),k.video=k.container.find(".intro-video"),k.btnSkip=k.container.find(".btn-skip").on(_CLICK_,function(){d()}),e(),k.container.detach()}function b(a){p=!0,$("#scene-container").append(k.container),$("body").toggleClass("inner-scroll",!0),r.resize(),ScalableContent.updateResizeAble(),Menu.hide(),i(),SP.restartTrack("intro-bgm",null,14);var b=new TimelineMax;b.set(k.container,{autoAlpha:0}),b.to(k.container,.3,{autoAlpha:1}),b.add(function(){a.apply()})}function c(a){p=!1,SP.stopTrack("intro-bgm"),Menu.hide(),SoundSwitch.hide();var b=new TimelineMax;b.to(k.container,.4,{autoAlpha:0}),b.add(function(){k.container.detach(),$("body").toggleClass("inner-scroll",!1),a.apply()})}function d(){o&&(o=!1,n.killPlayTo(),n.gotoAndStop(n.totalFrames-1),j&&j.progress(1))}function e(){var a,b,c,d=k.introCanvas=k.container.find(".intro-animation");a=d[0],n=c=new lib.intro,b=l=new createjs.Stage(a),b.addChild(c),b.update(),createjs.Ticker.setFPS(lib.properties.fps),createjs.Ticker.addEventListener("tick",b),n.stop()}function f(a){function b(){k++,Loading.progress(d+e*k/j),k==j&&g(function(){h(a)})}var c,d=.3,e=.2,f=0==Main.settings.viewport.index?"js/animes/intro_m.js?v=3":"js/animes/intro.js?v=3",i=["js/lib/createjs-2015.11.26.min.js","js/lib/CreatejsExtend.js","js/lib/SoundjsExtend.js",f],j=i.length,k=0,l=$LAB;for(c=0;c<i.length;c++)l=l.script(i[c]).wait(b)}function g(a){var b=.5,c=.1;window.SP||createjs.Sound.init(Main.soundSettings),SP.load([{id:"intro-bgm",src:"intro_bg.mp3?v=2",defaultPlayProps:{loop:-1,volume:1}}],function(a,d){Loading.progress(b+c*a/d)},function(){SoundSwitch.update(),a&&a.call()})}function h(a){function b(a){f++,Loading.progress(c+f/e*d),"image"==a.item.type&&(g[a.item.id]=a.result)}var c=.6,d=.4,e=lib.properties.manifest.length,f=0,g=window.images||{},h=new createjs.LoadQueue(!0);h.addEventListener("fileload",b),h.addEventListener("complete",a),h.loadManifest(lib.properties.manifest)}function i(a){o=!0,SoundSwitch.show(),SoundSwitch.$doms.container.toggleClass("intro-mode",!0),k.btnSkip.toggleClass("hide-mode",!1);var b=j=new TimelineMax;b.set([k.leftContent[0],k.btnPlay[0]],{autoAlpha:0,x:200}),n.gotoAndStop(1);var c=n.playTo(n.totalFrames-1,null,function(){});c-=.3,b.to(k.leftContent,.8,{autoAlpha:1,x:0,ease:Back.easeOut},c),b.to(k.btnPlay,.8,{autoAlpha:1,x:0,ease:Back.easeOut},c+.3),b.add(function(){p&&(SoundSwitch.$doms.container.toggleClass("intro-mode",!1),Menu.show()),k.btnSkip.toggleClass("hide-mode",!0),o=!1,a&&a.call()})}var j,k={},l=null,m=!1,n=null,o=!1,p=!1,q=!1,r=window.Intro={stageIn:function(c,d){function e(a){a&&c.cbContentLoaded&&c.cbContentLoaded.call(),b(d)}function g(b){var c=[{url:"_intro.html",startWeight:0,weight:30,dom:null}];SceneHandler.loadTemplate(null,c,function(){f(function(){Loading.hide(),a(c),q=!0,b.apply(null)})},!0)}q?e():g(e)},stageOut:function(a,b){c(b)},executeAfterPopupClosed:function(){Menu.show()},resize:function(){if(q&&k.introCanvas){var a=Main.settings.viewport,b=1920,c=936;0==a.index&&(b=640,c=855);var d=k.container.width(),e=k.container.height(),f=Helper.getSize_cover(d,e,b,c),g=.5*(d-f.width),h=.5*(e-f.height);k.introCanvas.css("width",f.width).css("height",f.height).css("left",g).css("top",h).attr("width",f.width).attr("height",f.height),l.scaleX=f.width/b,l.scaleY=f.height/c}}}}(),function(){function a(a){$("#invisible-container").append(a[0].dom),j.container=$("#story"),j.rotateScreenHint=$("#rotate-screen-hint"),j.buttons={container:j.container.find(".buttons"),exit:j.container.find(".btn-exit").on(_CLICK_,function(){SP.play("click_2"),SceneHandler.toHash("/Story/ExitConfirm")}),fullscreen:j.container.find(".btn-fullscreen").on(_CLICK_,function(){SP.play("click_2"),o.changeFullScreen()}),soundSwitch:j.container.find(".btn-sound").on(_CLICK_,function(){SP.play("click_2"),SoundSwitch.setSoundOn(!SoundSwitch.getSoundOn()),j.buttons.soundSwitch.toggleClass("off-mode",!SoundSwitch.getSoundOn())}),help:j.container.find(".btn-help").on(_CLICK_,function(){SP.play("click_2"),o.triggerHelp()}),evidences:j.container.find(".btn-evidence").on(_CLICK_,function(){SP.play("click_2"),SceneHandler.toHash("/Story/Evidences")})},g={"/Evidences":o.Evidences.init(j.container.find(".evidences"),j.buttons.evidences),"/Key":o.Key.init(j.container.find(".key-popup")),"/Phone":o.Phone.init(j.container.find(".phone-popup")),"/Poster":o.Poster.init(j.container.find(".poster-popup")),"/Photos":o.Photos.init(j.container.find(".photos-popup")),"/Billboard":o.Billboard.init(j.container.find(".billboard-popup")),"/Fingerprint":o.Fingerprint.init(j.container.find(".fingerprint-popup")),"/Medal":o.Medal.init(j.container.find(".medal-popup")),"/Briefcase":o.Briefcase.init(j.container.find(".briefcase-popup")),"/ExitConfirm":o.ExitConfirm.init(j.container.find(".exit-confirm-popup"))},o.DialogText.init(j.container.find(".dialog")),o.DialogTrigger.init(),j.dragHint=j.container.find(".drag-hint").toggleClass("hide-mode",!0),j.sceneCanvas=j.container.find(".scene-canvas")}function b(a){$("#scene-container").append(j.container),h=!0,o.resize(),Story.Scene.enablePostEffect&&PostProcessLib.getEffect("scene").raidalMotionTo(0,0),Menu.show(),Menu.Logo._show(),j.buttons.soundSwitch.toggleClass("off-mode",!SoundSwitch.getSoundOn()),SP.playTrack("game-bgm"),j.buttons.container.toggleClass("hide-mode",!1),Story.Scene.setActive(!0);var b=new TimelineMax;b.set(j.container,{autoAlpha:0}),b.to(j.container,1,{autoAlpha:1,ease:Power3.easeIn}),b.add(function(){Story.Scene.setUserControlEnabled(!0),a.apply()})}function c(a){function b(){Story.Scene.setActive(!1),j.container.detach(),h=!1,j.rotateScreenHint.toggleClass("hide-mode",!0),a.apply()}if(!k)return void a.call();Menu.Logo._hide(),Menu.hide(),SP.stopTrack("game-bgm"),Story.Scene.setUserControlEnabled(!1);var c=new TimelineMax;if(m){m=!1;var d;Story.Scene.enablePostEffect?(d=1.2,PostProcessLib.getEffect("scene").raidalMotionTo(1,d,Power1.easeIn)):d=.4,c.add(Main.showWhiteCover,d-.4),c.add(b,d)}else c.to(j.container,1,{autoAlpha:0,ease:Power3.easeOut}),c.add(b)}function d(){var a=document.getElementById("scene-container"),b=a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullscreen||a.msRequestFullscreen||null;b&&b.call(document.body)}function e(){var a=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msCancelFullScreen||null;a&&a.call(document)}var f,g,h,i,j={},k=!1,l=0,m=!1,n={0:{description:"start",type:"",helpObjectHash:"/Phone"},1:{description:"phone enabled",type:"",helpObjectHash:"/Phone"},2:{description:"poster enabled (phone puzzle complete)",type:"",helpObjectHash:"/Poster"},3:{description:"billboard enabled",type:"",helpObjectHash:"/Billboard"},4:{description:"sport girl key dialog enabled",type:"",helpObjectHash:"/SportGirlSP"},5:{description:"bartender key dialog enabled",type:"",helpObjectHash:"/Bartender"},6:{description:"fingerprint enabled",type:"",helpObjectHash:"/Bartender"},7:{description:"medal enabled, briefcase enabled (fingerprint puzzle complete)",type:"",helpObjectHash:"/Medal"}};window.StoryPhases={START:0,PHONE:1,POSTER:2,BILLBOARD:3,SPORT_GIRL:4,BARTENDER:5,FINGERPRINT:6,MEDAL_AND_BRIEFCASE:7};var o=window.Story={stageIn:function(c,d){function e(a){return i?(a&&c.cbContentLoaded&&c.cbContentLoaded.call(),void b(function(){c.contentHash?o.toContent(c.contentHash,d):d.call()})):(alert("您的瀏覽器不支援需要的 WebGL 功能"),Loading.hide(),d.call(),void SceneHandler.toHash("/Participate/Product"))}function f(a){function b(){k++,Loading.progress(d+e*k/j),k==j&&(i=BABYLON.Engine.isSupported(),i?g(function(){h(a)}):a.call())}Loading.progress(0).show();var c,d=0,e=.3,f=["js/lib/babylon.2.4.js","js/lib/createjs-2015.11.26.min.js","js/lib/SoundjsExtend.js"],j=f.length,k=0,l=$LAB;for(c=0;c<f.length;c++)l=l.script(f[c]).wait(b)}function g(a){var b=.3,c=.1;window.SP||createjs.Sound.init(Main.soundSettings),SP.load([{id:"game-bgm",src:"game_bg.mp3?v=2",defaultPlayProps:{loop:-1,volume:1}},{id:"zoom",src:"zoom.mp3"},{id:"click",src:"click.mp3"},{id:"click_2",src:"click_2.mp3"},{id:"click_3",src:"click_3.mp3"},{id:"bingo",src:"bingo.mp3"},{id:"stageClear",src:"stage_clear.mp3"}],function(a,d){Loading.progress(b+c*a/d)},function(){SoundSwitch.update(),a&&a.call()})}function h(b){var c=[{url:"_story.html",startWeight:40,weight:30,dom:null}];SceneHandler.loadTemplate(null,c,function(){a(c);var d=0==Main.settings.viewport.index;Story.Scene.init(j.sceneCanvas[0],d,function(a){Loading.progress(.7+.3*a)},function(){if(k=!0,Loading.hide(),HappyEnd.preload(),Main.settings.startPhase&&n[Main.settings.startPhase]){var a=parseInt(Main.settings.startPhase);for(var c in StoryPhases)if(StoryPhases[c]==a){o.setPhaseTo(a,!0);break}}j.container.detach(),b.call()})},!0)}k?e():f(e)},stageOut:function(a,b){f?f.hide(function(){f=null,c(b)}):c(b)},executeAfterPopupClosed:function(){Menu.show()},activeSpHiding:function(){m=!0},toContent:function(a,b){function c(){f=h,f==Story.DialogTrigger&&Story.DialogTrigger.setContent(e),f?(Story.Scene.setUserControlEnabled(!1),f.show(d)):(Story.Scene.setUserControlEnabled(!0),d())}function d(){h&&h.needHideUI||(Menu.show(),j.buttons.container.toggleClass("hide-mode",!1)),b.call()}var e,h=g[a];h||(e=Story.DialogTrigger.searchForContent(a),e&&(h=e.contentClass?e.contentClass:Story.DialogTrigger)),h&&h.needHideUI&&(Menu.hide(),j.buttons.container.toggleClass("hide-mode",!0)),f?f.hide(c):c()},setPhaseTo:function(a,b){function c(){console.log("story progress to "+l+" => "+n[l].description),0==l||(1==l?Story.Evidences.unlockEvidence("/Phone"):2==l?(Story.Phone.toCompleteMode(),Story.ObjectManager.disableFlash("/Phone"),Story.ObjectManager.setObjectDialog("/TattooMan",1),Story.ObjectManager.setDialogToNew("/TattooMan"),Story.ObjectManager.setObjectEnabled("/Poster",!0)):3==l?(Story.Evidences.unlockEvidence("/Poster"),Story.ObjectManager.disableFlash("/Poster"),Story.ObjectManager.getObject("/Backpacker").contentClass=g["/Photos"],Story.ObjectManager.setDialogToNew("/Backpacker"),Story.ObjectManager.setObjectEnabled("/Billboard",!0)):4==l?(Story.Evidences.unlockEvidence("/Billboard"),Story.ObjectManager.disableFlash("/Billboard"),Story.ObjectManager.setObjectEnabled("/SportGirlSP",!0),Story.ObjectManager.setObjectDialog("/SportGirl",1,StoryPhases.BARTENDER),Story.ObjectManager.setDialogToNew("/SportGirl")):5==l?(Story.ObjectManager.disableFlash("/SportGirlSP"),Story.ObjectManager.changeNpcAction("/Bartender",1,0),Story.ObjectManager.setObjectDialog("/Bartender",1,StoryPhases.FINGERPRINT,null,"/Story/Fingerprint",null),Story.ObjectManager.setDialogToNew("/Bartender")):6==l?Story.Evidences.unlockEvidence("/Fingerprint"):7==l&&(b&&Story.Fingerprint.toCompleteMode(),Story.ObjectManager.setObjectDialog("/Businessman",1),Story.ObjectManager.setDialogToNew("/Businessman"),Story.ObjectManager.setObjectEnabled("/Medal",!0),Story.ObjectManager.setObjectEnabled("/Briefcase",!0)))}if(!(l>=a)){for(var d;l<a;)d=l,l++,c();return!0}},changePhaseHelpHash:function(a,b){var c=n[a];c.helpObjectHash=b},triggerHelp:function(){var a=n[l],b=a.helpObjectHash,c=Story.ObjectManager.getObject(b),d=c.editorObject._mesh.position.clone();c.y&&(d.y+=c.y),Story.Scene.customCamera.lookAt(d,function(){Story.ObjectManager.showPointFingerAt(b)})},changeFullScreen:function(){var a=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;a?e():d()},enableDragHint:function(){j.dragHint.toggleClass("hide-mode",!1),Story.Scene.customCamera.listenDrag(this.disableDragHint)},disableDragHint:function(){j.dragHint.toggleClass("hide-mode",!0),TweenMax.delayedCall(1,function(){j.dragHint.detach()})},resize:function(){if(k&&(Story.Scene.engine.resize(),o.Evidences.resize(),
o.Fingerprint.resize(),h)){var a=Main.settings.viewport;0==a.index&&j.rotateScreenHint.toggleClass("hide-mode",!(a.width>a.height))}}}}(),function(){function a(){var a,e,f,g,h,i,j,k=LightEditor.getDicByName(),l=BillboardEditor.getDicByName();for(a in v){if(f=v[a],!k["light-"+a])return void alert("[light-"+a+"] is missing in scenedata");g=f.light=k["light-"+a]._light,i=f.relatedBillboardArray=[],j=f.relatedMeshArray=[];for(e in l)h=l[e],h._linkedLight&&h._linkedLight.match(a)&&(i.push(h),j.push(h._mesh));"simpleFlash"==f.mode?f.tl=b(g,j):"fastFlash"==f.mode?f.tl=c(g,j):"fastFlash2"==f.mode&&(f.tl=d(g,j))}}function b(a,b){var c;return c=new TimelineMax({repeat:-1,paused:!0}),c.to(a,1,{intensity:0}),c.to(b,1,{visibility:0},"-=1"),c.to(a,1,{intensity:1}),c.to(b,1,{visibility:1},"-=1"),c}function c(a,b){var c,d=.1;return c=new TimelineMax({repeat:-1,paused:!0}),c.to(a,d,{intensity:0}),c.to(b,d,{visibility:.3},"-="+d),c.to(a,d,{intensity:1}),c.to(b,d,{visibility:1},"-="+d),c}function d(a,b){var c=new TimelineMax({paused:!0});return c.add(function(){Math.random()>.5?e(a,b):f(a,b),u&&TweenMax.delayedCall(2*Math.random()+1,function(){c.restart()})},1),c}function e(a,b){var c,d=new TimelineMax,e=parseInt(1+3*Math.random()),f=.05,g=0;for(c=0;c<e;c++){var h=f*c*2,i=h+f;d.set(a,{intensity:.3},h+g),d.set(b,{visibility:.8},h+g),d.set(a,{intensity:.6},i+g),d.set(b,{visibility:1},i+g),g+=.1*Math.random()}}function f(a,b){var c=new TimelineMax,d=.5*Math.random()+.5,e=0;Math.random()>.5&&(c.set(a,{intensity:.3},0),c.set(b,{visibility:.8},0),e+=.1,c.set(a,{intensity:.6},e),c.set(b,{visibility:1},e),e+=.1),c.set(a,{intensity:.3},e),c.set(b,{visibility:.8},e),c.set(a,{intensity:.6},e+d),c.set(b,{visibility:1},e+d)}function g(){j.render()}var h,i,j,k,l,m=200,n=64,o=75,p=25,q=5,r="scenedata/",s=!1,t=!1,u=!1,v={"white-1":{mode:"fastFlash2"},"white-2":{mode:"fastFlash2"},"blue-1":{mode:"fastFlash"}},w=window.Story.Scene={engine:null,customCamera:null,enablePostEffect:!0,init:function(b,c,d,e){h=b,i=this.engine=new BABYLON.Engine(h,!1),$(h).on("pointerdown",function(a){a.preventDefault()}),0==Main.settings.viewport.index&&(w.enablePostEffect=!1);var f=j=new BABYLON.Scene(i);f.clearColor=new BABYLON.Color3(0,0,0),MaterialLib.defaultPath="../editor/textures/",MaterialLib.init(f),BillboardEditor.init(j,m,!0),ShapeEditor.init(j,!0),LightEditor.init(j,!0),k=this.customCamera=new CustomCamera(h,j,m,o,p,q),l=new BABYLON.Mesh.CreateSphere("background",n,2*m,f),l.scaling.y=-1,l.isPickable=!1,l.material=MaterialLib.createNormal(),l.material.disableLighting=!0,1==Utility.urlParams.fog&&(f.fogMode=BABYLON.Scene.FOGMODE_EXP2,f.fogDensity=.0018,f.fogColor=new BABYLON.Color3(.9,.9,.85)),ShaderLoader.defaultPath="./shaders/",ShaderLoader.loadFiles(["for-scene","shape"],function(){var b=.25,f=1-b;DataManager.loadFromExtractedData(r,w,c,function(a,c,e){"background"==a?d.call(null,b):d.call(null,b+c/e*f)},function(){BillboardEditor.setAllUnPickable(),a(),Story.ObjectManager.init(j),w.enablePostEffect&&(RainMaker.init(j),PostProcessLib.init(i,j,k._camera),PostProcessLib.enableEffect("scene")),e&&e.call()})})},setActive:function(a){a!=u&&(u=a,w.setLightAnimation(u),a?i.runRenderLoop(g):i.stopRenderLoop(g))},setUserControlEnabled:function(a){a!=s&&(s=a,k.setEnabled(s),Story.ObjectManager.setEnabled(s))},applyBase64Background:function(a){var b=new BABYLON.Texture("data:background"+(new Date).getTime(),j,null,!0,null,null,null,a,!0),c=l.material;c.diffuseTexture=b},applyBackground:function(a,b){var c=new BABYLON.Texture(a,j,null,!0,null,function(){var a=l.material;a.diffuseTexture=c,b&&b.call()})},setLightAnimation:function(a){if(a!=t){t=a;var b;for(b in v)t?v[b].tl.restart():v[b].tl.pause()}}}}(),function(){var a={},b=!0,c=window.Story.ExitConfirm={needHideUI:!0,init:function(b){return a.container=b,a.parent=b.parent(),a.content=a.container.find(".content"),a.btnYes=a.container.find(".btn-yes").on(_CLICK_,function(){SceneHandler.toHash("/HappyEnd/NotReally")}),a.btnNo=a.container.find(".btn-no").on(_CLICK_,function(){SceneHandler.toHash("/Story")}),a.container.detach(),c},show:function(c){if(b){b=!1,a.parent.append(a.container);var d=new TimelineMax;d.set([a.container,a.content],{autoAlpha:0}),d.to(a.container,.4,{autoAlpha:1}),d.to(a.content,1,{autoAlpha:1,ease:Linear.easeNone},0),d.add(c)}},hide:function(c){if(!b){b=!0;var d=new TimelineMax;d.to(a.container,.4,{autoAlpha:0}),d.add(function(){a.container.detach(),c&&c.apply()})}}}}(),function(){var a,b={},c=!0,d=!0,e='<span>嫌犯棄車匆匆逃逸，在現場掉了一把刻有</span><span class="green">Ｃ的鑰匙</span><span>，這也許是某種線索</span>',f=window.Story.Key={needHideUI:!0,init:function(c){return b.container=c,b.parent=c.parent(),b.content=b.container.find(".content"),b.btnClose=b.container.find(".btn-close").on(_CLICK_,function(){SceneHandler.toHash("/Story")}),a=new BackgroundAnimation(b.container),b.container.detach(),f},show:function(d){c&&(c=!1,b.parent.append(b.container),b.btnClose.toggleClass("showing-mode",!0),ScalableContent.updateResizeAble(),Story.DialogText.show(e,null,d),TweenMax.set(b.container,{autoAlpha:1}),TweenMax.set(b.content,{autoAlpha:0}),a.show(function(){TweenMax.to(b.content,1,{autoAlpha:1,ease:Linear.easeNone})}))},hide:function(e){c||(c=!0,d&&(d=!1,Story.enableDragHint()),b.btnClose.toggleClass("showing-mode",!1),Story.DialogText.hide(),TweenMax.to(b.content,.4,{autoAlpha:0,ease:Linear.easeNone}),a.hide(function(){b.container.detach(),e&&e.apply()}))}}}(),function(){function a(){j.bingo=j.container.find(".bingo").detach();var a=j.bingo.find(".icon"),b=j.container.find(".honey").detach();j.bingo._play=function(){SP.play("bingo"),j.content.append(j.bingo);var c=new TimelineMax;c.set(j.bingo,{autoAlpha:1}),c.set(b,{autoAlpha:0}),c.set(a,{autoAlpha:0},.1),c.set(a,{autoAlpha:1},.2),c.set(a,{autoAlpha:0},.3),c.set(a,{autoAlpha:1},.4),c.to(j.bingo,.6,{autoAlpha:0,ease:Power2.easeIn},"+=1.4"),c.to(j.quez,.6,{autoAlpha:0,ease:Power2.easeIn},"-=.6"),c.add(function(){j.quez.detach(),j.bingo.detach(),j.content.append(b)}),c.to(b,.7,{autoAlpha:1,ease:Power2.easeIn}),c.add(function(){l=!0,Story.DialogText.hide("fadeOut",function(){Story.DialogText.show(t[q],null,function(){l=!1,r&&(r=!1,SceneHandler.toHash("/Story"))})})},"-=.6")},j.bingo._toCompleteMode=function(){j.quez.detach(),j.bingo.detach(),j.content.append(b)}}function b(){j.wrong=j.container.find(".wrong").detach();var a=j.wrong.find(".icon"),b=j.container.find(".honey").detach();j.wrong._play=function(){j.content.append(j.wrong);var c=new TimelineMax;c.set(j.wrong,{autoAlpha:1}),c.set(b,{autoAlpha:0}),c.set(a,{autoAlpha:0},.1),c.set(a,{autoAlpha:1},.2),c.set(a,{autoAlpha:0},.3),c.set(a,{autoAlpha:1},.4),c.to(j.wrong,.6,{autoAlpha:0,ease:Power2.easeIn},"+=1.4"),c.add(function(){j.wrong.detach()})},j.wrong._toCompleteMode=function(){j.wrong.detach()}}function c(){function a(a){var b=j.numbers[a]=j.numberContainer.find(".number-"+a);b.toggleClass("hide-mode",!0),b[0].__index=a,b.find(".hover-state")[0].__index=a}function b(a){var b=j.nodes[a]=j.nodeContainer.find(".node:nth-child("+a+")");b.toggleClass("hide-mode",!0)}var c,d=j.quez=j.container.find(".quez-container");for(j.numberContainer=d.find(".numbers"),j.numbers={},c=0;c<10;c++)a(c);for(j.nodeContainer=d.find(".nodes"),j.nodes={},c=1;c<=7;c++)b(c)}function d(){m||(m=!0,i.restart(),j.container.on("pointerdown",e))}function e(a){function b(){$(window).unbind("pointerup",b)}function c(){this.__triggered=!this.__triggered,this.__triggered?p++:p--,s[this.__index]?this.__triggered?o++:o--:this.__triggered?o--:o++,$(this).toggleClass("hide-mode",!this.__triggered),f(p),o>=7?(Story.setPhaseTo(StoryPhases.POSTER),q=1,j.bingo._play(),n=!0,g(),b()):p>=7&&d()}function d(){i.restart(),j.wrong._play();var a,b;for(a=0;a<10;a++)b=j.numbers[a],b[0].__triggered=!1,b.toggleClass("hide-mode",!0),o=0,p=0,f(p)}if(a.preventDefault(),a.stopPropagation(),$(window).on("pointerup",b),$.contains(j.numberContainer[0],a.target)){var e=j.numbers[a.target.__index];c.call(e[0])}}function f(a){a<0&&(a=0);var b,c;for(b=1;b<=7;b++)c=j.nodes[b],c.toggleClass("hide-mode",!(b<=a))}function g(){m&&(m=!1,i.pause(),j.container.unbind("pointerdown",e))}var h,i,j={},k=!0,l=!1,m=!1,n=!1,o=0,p=0,q=0,r=!1,s={3:!0,2:!0,1:!0,4:!0,7:!0,8:!0,9:!0},t=['<span>Bingo！啊..有支手機！解鎖瞧瞧是否有更多線索，密碼可能跟</span><span class="green">英文字母Ｃ的形狀</span><span>有些關聯</span>','<span>嗯...</span><span class="green">Honey</span><span>！</span><br/><span>　看來我知道下個該找的線索了</span>'],u=window.Story.Phone={needHideUI:!0,init:function(d){j.container=d,j.parent=d.parent(),j.content=j.container.find(".content"),j.btnClose=j.container.find(".btn-close").on(_CLICK_,function(){l?r=!0:SceneHandler.toHash("/Story")}),j.cLetter=j.container.find(".c-letter").css("visibility","hidden");var e=h=new TimelineMax;return e.set(j.cLetter,{autoAlpha:0}),e.to(j.cLetter,1.5,{autoAlpha:1,ease:Power1.easeInOut}),e.to(j.cLetter,1.5,{autoAlpha:0,ease:Power1.easeInOut}),e.pause(),e=i=new TimelineMax,e.add(function(){h.restart()},15),e.pause(),c(),a(),b(),j.container.detach(),u},show:function(a){if(k){k=!1,r=!1,l=!1,Story.Evidences.unlockEvidence("/Phone")&&SP.play("bingo"),j.parent.append(j.container),j.btnClose.toggleClass("showing-mode",!0),ScalableContent.updateResizeAble(),Story.DialogText.show(t[q],null,a);var b=new TimelineMax;b.set([j.container,j.content],{autoAlpha:0}),b.to(j.container,.4,{autoAlpha:1}),b.to(j.content,1,{autoAlpha:1,ease:Linear.easeNone},0),b.add(function(){n||d()},.6)}},hide:function(a){if(!k){k=!0,g(),j.btnClose.toggleClass("showing-mode",!1),Story.DialogText.hide();var b=new TimelineMax;b.to(j.container,.4,{autoAlpha:0}),b.add(function(){j.container.detach(),a&&a.apply()})}},toCompleteMode:function(){n||(q=1,n=!0,j.bingo._toCompleteMode())}}}(),function(){var a,b={},c=!0,d='<span>這是海報的一角！</span><span class="green">地圖</span><span>似乎在哪裡看過，這絕對不是巧合</span>',e=window.Story.Poster={needHideUI:!0,init:function(c){return b.container=c,b.parent=c.parent(),b.content=b.container.find(".content"),b.btnClose=b.container.find(".btn-close").on(_CLICK_,function(){SceneHandler.toHash("/Story")}),a=new BackgroundAnimation(b.container),b.container.detach(),e},show:function(e){c&&(c=!1,Story.setPhaseTo(StoryPhases.BILLBOARD)&&SP.play("bingo"),b.parent.append(b.container),b.btnClose.toggleClass("showing-mode",!0),ScalableContent.updateResizeAble(),Story.DialogText.show(d,null,e),TweenMax.set(b.container,{autoAlpha:1}),TweenMax.set(b.content,{autoAlpha:0}),a.show(function(){TweenMax.to(b.content,1,{autoAlpha:1,ease:Linear.easeNone})}))},hide:function(d){c||(c=!0,b.btnClose.toggleClass("showing-mode",!1),Story.DialogText.hide(),TweenMax.to(b.content,.4,{autoAlpha:0,ease:Linear.easeNone}),a.hide(function(){b.container.detach(),d&&d.apply()}))}}}(),function(){var a={},b=!0,c="<span>這些是我前一小時拍的照片，不知道能不能給您一點幫助？</span>",d=window.Story.Photos={needHideUI:!0,init:function(b){return a.container=b,a.parent=b.parent(),a.content=a.container.find(".content"),a.btnClose=a.container.find(".btn-close").on(_CLICK_,function(){SceneHandler.toHash("/Story")}),a.container.detach(),d},show:function(d){if(b){b=!1,a.parent.append(a.container),a.btnClose.toggleClass("showing-mode",!0),Story.ObjectManager.setDialogToNormal("/Backpacker"),ScalableContent.updateResizeAble(),Story.DialogText.show(c,null,d);var e=new TimelineMax;e.set([a.container,a.content],{autoAlpha:0}),e.to(a.container,.4,{autoAlpha:1}),e.to(a.content,1,{autoAlpha:1,ease:Linear.easeNone},0)}},hide:function(c){if(!b){b=!0,a.btnClose.toggleClass("showing-mode",!1),Story.DialogText.hide();var d=new TimelineMax;d.to(a.container,.4,{autoAlpha:0}),d.add(function(){a.container.detach(),c&&c.apply()})}}}}(),function(){var a,b={},c=!0,d='<span>這燈箱上也有地圖！是否答案跟</span><span class="green">西洋梨</span><span>有關？！</span>',e=window.Story.Billboard={needHideUI:!0,init:function(c){return b.container=c,b.parent=c.parent(),b.content=b.container.find(".content"),b.btnClose=b.container.find(".btn-close").on(_CLICK_,function(){SceneHandler.toHash("/Story")}),a=new BackgroundAnimation(b.container),b.container.detach(),e},show:function(e){c&&(c=!1,Story.setPhaseTo(StoryPhases.SPORT_GIRL)&&SP.play("bingo"),b.parent.append(b.container),b.btnClose.toggleClass("showing-mode",!0),ScalableContent.updateResizeAble(),Story.DialogText.show(d,null,e),TweenMax.set(b.container,{autoAlpha:1}),TweenMax.set(b.content,{autoAlpha:0}),a.show(function(){TweenMax.to(b.content,1,{autoAlpha:1,ease:Linear.easeNone})}))},hide:function(d){c||(c=!0,b.btnClose.toggleClass("showing-mode",!1),Story.DialogText.hide(),TweenMax.to(b.content,.4,{autoAlpha:0,ease:Linear.easeNone}),a.hide(function(){b.container.detach(),d&&d.apply()}))}}}(),function(){function a(a){g=!0;var b=new TimelineMax;b.set(f.badge,{scale:.5}),b.to(f.wineglass,.4,{autoAlpha:1}),b.to(f.wineglass,1,{autoAlpha:0,ease:Power1.easeIn},"+=1"),b.to(f.badge,1,{autoAlpha:1,ease:Power1.easeOut},"-=1"),b.to(f.badge,3,{scale:1.5,ease:SlowMo.ease.config(.5,.7,!1)},"-=1"),b.to(f.badge,1,{autoAlpha:0,ease:Power1.easeIn},"-=1"),b.to(f.systemBackground,.6,{autoAlpha:1,ease:Power1.easeIn},"-=.4"),b.to(f.systemContainer,.6,{autoAlpha:1},"-=.3"),b.add(function(){a&&a.call()})}function b(){f.results=f.container.find(".results"),f.misMatch=f.results.find(".mis-match"),f.bingo=f.results.find(".bingo"),TweenMax.set([f.results[0],f.misMatch[0],f.bingo[0]],{autoAlpha:0}),f.btnAsk=f.container.find(".btn-ask").on(_CLICK_,function(){SceneHandler.toHash("/Story/Businessman")})}function c(a){var b=f.misMatch,c=b.find(".icon"),d=new TimelineMax;d.to(f.results,.4,{autoAlpha:1}),d.set(b,{autoAlpha:1}),d.set(c,{autoAlpha:0},"+=.05"),d.set(c,{autoAlpha:1},"+=.1"),d.set(c,{autoAlpha:0},"+=.15"),d.set(c,{autoAlpha:1},"+=.2"),d.to(b,.5,{autoAlpha:0},"+=1"),d.to(f.results,.4,{autoAlpha:0},"-=.3"),d.add(a)}function d(a){SP.play("bingo");var b=f.bingo,c=new TimelineMax;c.set(b,{autoAlpha:1}),c.to(f.systemContainer,.5,{autoAlpha:0},0),c.to(f.results,.8,{autoAlpha:1,ease:Power3.easeIn},0),c.add(a)}function e(){function a(a){w||(a<r&&(a=r),a>s&&(a=s),a!=n&&(n=a,k()))}function b(a,b,c){var d=parseInt(b/o),f=b-o*d,h=a.find(".sample:nth-child("+(b+1)+")");h.attr("touch-action","none").children().css("pointer-events","none"),h._row=d,h._col=f,h._index=b,h._container=a,c&&v.push(h),h.on("pointerenter",function(){w||e(h)}),h.on("pointerleave",function(){w||e(null)}),h.on("pointerdown",function(){w||g(h)})}function e(a){D&&D.toggleClass("selected",!1),D=a,D&&D.toggleClass("selected",!0)}function g(a){e(null),a._container.append(E),w=!0;var b,f;x?(TweenMax.set(E,{scale:1,transformOrigin:"center center"}),b=(parseInt(a.css("left"))+parseInt(.5*a.width()))/parseInt(a._container.width())*100+"%",f=(parseInt(a.css("top"))+parseInt(.5*a.height()))/parseInt(a._container.height())*100+"%",E.css("left",b).css("top",f)):(TweenMax.set(E,{scale:.55,transformOrigin:"center center"}),b=(parseInt(a.css("left"))+parseInt(.5*a.width()))/parseInt(a._container.width())*100-1+"%",f=(parseInt(a.css("top"))+parseInt(.5*a.height()))/parseInt(a._container.height())*100-1+"%",E.css("left",b).css("top",f));var g=A.children(".circle"),i=E.children(".circle"),j=[A[0],E[0]],k=new TimelineMax;k.set(j,{autoAlpha:1}),k.set(g,{autoAlpha:0}),k.set(i,{autoAlpha:0}),k.staggerTo(g,.5,{autoAlpha:1},.18,0),k.staggerTo(i,.5,{autoAlpha:1},.18,0);var l=a._index==z;if(l){h=!0,Story.setPhaseTo(StoryPhases.MEDAL_AND_BRIEFCASE);var m=.3,n=k.duration();k.set(A,{autoAlpha:0},n),k.set(E,{autoAlpha:0},n),n+=m,k.set(A,{autoAlpha:1},n),k.set(E,{autoAlpha:1},n),n+=m,k.set(A,{autoAlpha:0},n),k.set(E,{autoAlpha:0},n),n+=m,k.set(A,{autoAlpha:1},n),k.set(E,{autoAlpha:1},n),k.add(function(){d(function(){})})}else k.set(j,{autoAlpha:0},"+=.7"),k.add(function(){c(function(){w=!1})})}function i(){w=!0,f.content.toggleClass("shared-mode",!0),f.container.scrollTop(0),x=!0,z=y,TweenMax.delayedCall(1,function(){w=!1})}function k(a){null!==a&&void 0!==a||(a=.4);var b,c;if(0==Main.settings.viewport.index){for(b=0;b<v.length;b++)c=v[b],c.toggleClass("hide-mode",!1);TweenMax.set(B,{marginTop:0})}else{for(b=0;b<v.length;b++){c=v[b];var d=c._row-n;d<0?c.toggleClass("hide-mode",!0):d>=q?c.toggleClass("hide-mode",!0):c.toggleClass("hide-mode",!1)}var e=String(-n*u)+"%";w=!0,m&&m.kill(),m=new TimelineMax,m.to(B,a,{marginTop:e,ease:Power2.easeOut}),m.add(function(){w=!1})}}var l,m,n=0,o=5,p=2,q=2,r=0,s=p-q,t=30,u=135,v=[],w=!1,x=!1,y=0,z=6;f.btnSend=f.container.find(".btn-send"),f.arrowUp=f.container.find(".arrow-up").on(_CLICK_,function(){a(n-1)}),f.arrowDown=f.container.find(".arrow-down").on(_CLICK_,function(){a(n+1)}),f.btnShare=f.container.find(".btn-share").on(_CLICK_,function(){if(!w){if(i(),!FB)return;FB.ui({app_id:Main.settings.fb_appid,method:"feed",link:Utility.getPathWithFilename()+"?sharetype=fingerprint"},function(){})}});var A=f.container.find(".raw-sample-match-circle"),B=f.container.find(".fingerprints .wrapper"),C=f.container.find(".fingerprints-2"),D=null,E=A.clone().toggleClass("raw-sample-match-circle",!0);for(TweenMax.set(E,{left:0,top:0,autoAlpha:0}),TweenMax.set(A,{autoAlpha:0}),E.css("left",0).css("top",0),B.append(E),l=0;l<t;l++)b(B,l,!0);for(l=0;l<3;l++)b(C,l);j.updateFingerprint=k,k()}var f={},g=!1,h=!1,i=!0,j=window.Story.Fingerprint={needHideUI:!0,init:function(a){return f.container=a,f.parent=a.parent(),f.content=f.container.children(".content"),f.btnClose=f.container.find(".btn-close").on(_CLICK_,function(){SceneHandler.toHash("/Story")}),f.wineglass=f.container.find(".wineglass").css("visibility","hidden"),f.badge=f.container.find(".big-badge").css("visibility","hidden"),f.systemContainer=f.container.find(".system").css("visibility","hidden"),f.systemBackground=f.container.find(".system-background").css("visibility","hidden"),b(),e(),f.container.detach(),j},show:function(b){if(i){i=!1,f.parent.append(f.container),f.btnClose.toggleClass("showing-mode",!0),ScalableContent.updateResizeAble(),j.resize();var c=new TimelineMax;c.set([f.container,f.content],{autoAlpha:0}),c.to(f.container,.4,{autoAlpha:1}),c.to(f.content,1,{autoAlpha:1,ease:Linear.easeNone},0),g||h?c.add(b):a(b)}},toSystem:function(){g=!0,TweenMax.set([f.systemContainer[0],f.systemBackground[0]],{autoAlpha:1})},toCompleteMode:function(){h=!0,j.toSystem(),TweenMax.set(f.systemContainer,{autoAlpha:0}),TweenMax.set([f.results[0],f.bingo[0]],{autoAlpha:1})},hide:function(a){if(!i){i=!0,f.btnClose.toggleClass("showing-mode",!1);var b=new TimelineMax;b.to(f.container,.4,{autoAlpha:0}),b.add(function(){f.container.detach(),a&&a.apply()})}},resize:function(){f.container.scrollTop(0),j.updateFingerprint(0)},updateFingerprint:null}}(),function(){var a,b={},c=!0,d='<span>這個領釦很特別，感覺上面的</span><span class="green">數字</span><span>感覺隱藏了某些秘密</span>',e=window.Story.Medal={needHideUI:!0,init:function(c){return b.container=c,b.parent=c.parent(),b.content=b.container.find(".content"),b.btnClose=b.container.find(".btn-close").on(_CLICK_,function(){SceneHandler.toHash("/Story")}),a=new BackgroundAnimation(b.container),b.container.detach(),e},show:function(e){c&&(c=!1,Story.Evidences.unlockEvidence("/Medal")&&SP.play("bingo"),Story.changePhaseHelpHash(StoryPhases.MEDAL_AND_BRIEFCASE,"/Briefcase"),b.parent.append(b.container),b.btnClose.toggleClass("showing-mode",!0),ScalableContent.updateResizeAble(),Story.DialogText.show(d,null,e),TweenMax.set(b.container,{autoAlpha:1}),TweenMax.set(b.content,{autoAlpha:0}),a.show(function(){TweenMax.to(b.content,1,{autoAlpha:1,ease:Linear.easeNone})}))},hide:function(d){c||(c=!0,b.btnClose.toggleClass("showing-mode",!1),Story.DialogText.hide(),TweenMax.to(b.content,.4,{autoAlpha:0,ease:Linear.easeNone}),a.hide(function(){b.container.detach(),d&&d.apply()}))}}}(),function(){function a(){function a(){i=!0;var a=new TimelineMax,b=0;a.set(j,{autoAlpha:1},b),a.set(f,{autoAlpha:0},b),b+=.15,a.set(j,{autoAlpha:0},b),b+=.15,a.set(j,{autoAlpha:1},b),b+=1,a.set(j,{autoAlpha:0},b),a.set(f,{autoAlpha:1},b),a.add(function(){i=!1})}function d(){h=!0,SP.play("bingo"),i=!0;var a=new TimelineMax,c=0;a.set(k,{autoAlpha:1},c),a.set(f,{autoAlpha:0},c),c+=.1,a.set(k,{autoAlpha:0},c),c+=.1,a.set(k,{autoAlpha:1},c),c+=.1,a.set(k,{autoAlpha:0},c),c+=.1,a.set(k,{autoAlpha:1},c),a.add(function(){i=!1,b()},"+=1")}e.btnUnlock=e.container.find(".btn-unlock");var f=e.btnUnlock.find(".btn-state"),j=e.btnUnlock.find(".error-state"),k=e.btnUnlock.find(".correct-state");e.btnUnlock.on(_CLICK_,function(){if(!i){if(h)return void b();var e=c();e===g?d():a()}})}function b(){SP.play("stageClear"),Story.activeSpHiding(),SceneHandler.toHash("/HappyEnd/Yes")}function c(){for(var a="",b=0;b<e.slots.length;b++)a+=e.slots[b]._getNumber();return a}function d(){function a(a){function b(){if(SP.play("click_3"),!i&&!h){var a=g._number-1;d(a)}}function c(){if(SP.play("click_3"),!i&&!h){var a=g._number+1;d(a)}}function d(a,b,c){if(g._number!=a){g._number=a,void 0!==b&&null!==b||(b=.5);var d=k*(a-1);TweenMax.to(l,b,{y:d,onUpdate:f,onComplete:c})}}function f(){var a=l.y;TweenMax.set(j,{backgroundPosition:"0 "+a+"%"})}var g=e.container.find(".slot-"+a),j=g.find(".number-clip");e.container.find(".arrow-up-"+a).on(_CLICK_,b),e.container.find(".arrow-down-"+a).on(_CLICK_,c),e.slots.push(g);var k=14.2857,l={y:0};g._number=1,d(0),g._getNumber=function(){var a=g._number;return a%=10,a<0&&(a+=10),String(a)}}e.slots=[],a(1),a(2),a(3),a(4)}var e={},f=!0,g="1824",h=!1,i=!1,j="<span>數字密碼？和格蘭利威的領扣有關嗎？</span>",k=window.Story.Briefcase={needHideUI:!0,init:function(b){return e.container=b,e.parent=b.parent(),e.content=e.container.find(".content"),e.btnClose=e.container.find(".btn-close").on(_CLICK_,function(){SceneHandler.toHash("/Story")}),d(),a(),e.container.detach(),k},show:function(a){if(f){f=!1,Story.Evidences.unlockEvidence("/Briefcase")&&SP.play("bingo"),e.parent.append(e.container),e.btnClose.toggleClass("showing-mode",!0),ScalableContent.updateResizeAble(),Story.DialogText.show(j,null,a);var b=new TimelineMax;b.set([e.container,e.content],{autoAlpha:0}),b.to(e.container,.4,{autoAlpha:1}),b.to(e.content,1,{autoAlpha:1,ease:Linear.easeNone},0)}},hide:function(a){if(!f){f=!0,e.btnClose.toggleClass("showing-mode",!1),Story.DialogText.hide();var b=new TimelineMax;b.to(e.container,.4,{autoAlpha:0}),b.add(function(){e.container.detach(),a&&a.apply()})}}}}(),function(){var a,b=!1,c=!0;window.Story.DialogTrigger={needHideUI:!0,init:function(){b=!0},searchForContent:function(a){var b=Story.ObjectManager.getObjectDic();return b[a]&&"dialog"==b[a].type?b[a]:null},setContent:function(b){a=b},show:function(b){function d(){a.changePhaseAfterDialog&&(Story.setPhaseTo(a.changePhaseAfterDialog),a.changePhaseAfterDialog=null),b&&b.call()}c&&(c=!1,Story.ObjectManager.hideObject(a.hash),"trigger"==a.nameHead&&Story.ObjectManager.setDialogToNormal(a.hash),a.clearAble&&Story.ObjectManager.clearObject(a.hash),(a.changePhaseAfterActionChange||a.changePhaseAfterDialog)&&SP.play("bingo"),Story.Scene.customCamera.focusOn(a.position,function(){if(a.changeActionWhenDialoging&&null!==a.changeActionWhenDialoging){var b=a.changeActionWhenDialoging;a.changeActionWhenDialoging=null,Story.ObjectManager.changeNpcAction(a.hash,b,null,function(){a.changePhaseAfterActionChange&&(Story.setPhaseTo(a.changePhaseAfterActionChange),a.changePhaseAfterActionChange=null)})}var e=a.currentDialog;e?Story.DialogText.playDialogs(e,a.dialogAnimeType,function(){d(),TweenMax.delayedCall(2.5,function(){c||SceneHandler.toHash("/Story")})}):d()}))},hide:function(b){c||(c=!0,a.changeHashAfterDialog?(b&&b.call(),Story.DialogText.hide(),Story.Scene.customCamera.recover(function(){Story.ObjectManager.showObject(a.hash)}),SceneHandler.toHash(a.changeHashAfterDialog)):(Story.DialogText.hide(),Story.Scene.customCamera.recover(function(){TweenMax.to(a.editorObject._mesh,.5,{visibility:1}),b&&b.call()})))}}}(),function(){function a(a,f){var g=h=new TimelineMax;g.to(e.cover,.8,{autoAlpha:0,ease:Power2.easeOut}),"fadeOut"==a?g.staggerTo(i,.5,{alpha:0,ease:Power2.easeOut},.01,0):g.to(i,2,{alpha:0,x:b,y:b,scale:c,transformOrigin:"center center 0",rotationX:d,rotationY:d,ease:Power2.easeOut},0),g.add(function(){i=null,e.container.detach(),h=null,f&&f.call()})}function b(){return-100+200*Math.random()}function c(){return-2+4*Math.random()}function d(){return-360+720*Math.random()}var e={},f=!1,g=!0,h=null,i=null,j=window.Story.DialogText={init:function(a){e.container=a,e.parent=a.parent(),e.textContainer=e.container.find(".text-container"),e.cover=e.container.find(".cover"),TweenMax.set(e.cover,{autoAlpha:0}),e.container.detach(),f=!0},playDialogs:function(a,b,c){function d(){var a=e.shift();j.show(a,b,function(){e.length?TweenMax.delayedCall(2,function(){j.hide(null),d()}):c.call()})}var e;"string"==typeof a?j.show(a,b,c):(e=a.concat([]),d())},show:function(a,b,c){if(g){g=!1,h&&(h.kill(),h=null),e.parent.append(e.container),e.textContainer.empty().html(a);var d=e.textContainer.children("span").lettering(),f=[];d.each(function(a,b){f=f.concat($(b).children("span").toArray())}),f=Utility.shuffleArray(f);var j=f.length/10*1.1;j<2&&(j=2),j>3.5&&(j=3.5);var k=new TimelineMax;if("shake"==b){var l,m=10,n=.1;for(k.set(f,{transformOrigin:"center center",perspective:300,scale:1,alpha:1,x:0,y:0,rotationX:0,rotationY:0}),l=0;l<7;l++)k.to(f,n,{x:m}),m*=-.9,n*=.9;k.to(f,n,{x:0})}else k.set(f,{transformOrigin:"center center",perspective:300,scale:1,alpha:0,x:0,y:0,rotationX:0,rotationY:0}),k.staggerTo(f,1.3,{rotationX:0,rotationY:0,alpha:1,x:0,y:0,scale:1,ease:Linear.easeNone},.03,0);return k.to(e.cover,k.duration()-.2,{autoAlpha:1,ease:Linear.easeNone},0),c&&k.add(c),i=f,j}},hide:function(b,c){g||(g=!0,i?a(b,c):c&&c.call())},resize:function(){}}}(),function(){function a(){var a=64,c=95,d=i=new BABYLON.Mesh("pointfinger container",g);d.isPickable=!1;var e=h=BABYLON.MeshBuilder.CreatePlane("point-finger",{width:6.4,height:9.5,updatable:!0},g);e.billboardMode=BABYLON.Mesh.BILLBOARDMODE_ALL,e.renderingGroupId=3,e.parent=d,e.isPickable=!1;var f=new BABYLON.Texture("textures/finger.png",g),j=MaterialLib.createNormal();e.material=j,j.specularColor=BABYLON.Color3.Black(),j.opacityTexture=j.diffuseTexture=f,e.visibility=0,b(e,a,c,.17,.65,0);var k=e.position,l=new TimelineMax({repeat:-1});l.set(k,{y:0}),l.to(k,.6,{y:-1,ease:Power2.easeIn}),l.to(k,.6,{y:0,ease:Power2.easeOut}),e.setEnabled(!1)}function b(a,b,c,d,e,f){var g=a.getVerticesData(BABYLON.VertexBuffer.PositionKind),h=b*d,i=c*d,j=-h*e,k=h*(1-e),l=-i*f,m=i*(1-f);g[0]=j,g[1]=l,g[3]=k,g[4]=l,g[6]=k,g[7]=m,g[9]=j,g[10]=m,a.updateVerticesData(BABYLON.VertexBuffer.PositionKind,g,!0)}function c(){for(var a in n)d(a)}function d(a){var b=n[a],c=b.editorObject._mesh;b.hitareaMesh&&(c=b.hitareaMesh),m&&b.isEnabled?c.actionManager.actions=c.actionManager.__actions:c.actionManager.actions=[],b.editorObject._mesh.setEnabled(b.isEnabled)}function e(a,b,c,d){var e,h;e=d.name;var i=d.nameHead?d.nameHead:d.type,m=i+"-"+e;if(d.nameHead=i,h=a[m],!h)return void alert("object: "+e+" is lacking from scene data");if(d.hash||(d.hash=c),d.dialogs&&(d.currentDialog=d.dialogs[0]),d.editorObject=h,d.isNpc){d.numNpcActions||(d.numNpcActions=1);for(var n=[],p=1;p<=d.numNpcActions;p++){var q="npc-"+e;p>1&&(q+="-"+p);var r=a[q];if(!r)return void alert("object: "+q+" is lacking from scene data");p>1&&r._mesh.setEnabled(!1),n.push(r)}d.npcArray=n,d.position=d.npcArray[0]._mesh.position.clone()}else d.position=h._mesh.position.clone();d.position.y=d.y,d.isEnabled=!Boolean(d.disableInStart);var s=d.editorObject._mesh,t=s;if(s.isPickable=!0,"hint"==d.nameHead){d.editorObject._imageWidth=278,d.editorObject._imageHeight=282,d.editorObject._updateGeom(),s.material.diffuseTexture=s.material.opacityTexture=k,s.visibility=0;var u=s.clone("myFlash");u.parent=s,u.position=BABYLON.Vector3.Zero(),u.isPickable=!1,d.flashMesh=u,s.material=null;var v=d.flashTriggerTl=new TimelineMax;v.to(d,0,{onComplete:f,onCompleteParams:[d]},.1)}if("trigger"==d.nameHead){var w=d.newDialogMesh=s.clone(),x=MaterialLib.createNormal();x.opacityTexture=x.diffuseTexture=l,x.specularColor=BABYLON.Color3.Black(),w.material=x,w.position=BABYLON.Vector3.Zero(),w.parent=s,w.alphaIndex=s.alphaIndex+1,w.isPickable=!1,s.billboardMode=BABYLON.Mesh.BILLBOARDMODE_ALL;var y=d.newDialogMeshTl=new TimelineMax({repeat:-1,paused:!0});y.to(w,.5,{visibility:.2,ease:Linear.easeNone},0),y.to(w,.5,{visibility:1,ease:Linear.easeNone}),o.setDialogToNew(c)}d.withHitarea&&(s.isPickable=!1,t=d.hitareaIsShape?b["hitarea-"+d.name]._mesh:a["hitarea-"+d.name]._mesh,t||alert("hitarea for: "+d.name+" is missing"),d.hitareaMesh=t,t.setEnabled(!1),t.isPickable=!0),t.actionManager=new BABYLON.ActionManager(g),t.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger,function(){j&&o.hidePointerFinger(),SP.play("click_2"),SceneHandler.toHash("/Story"+d.hash)})),t.actionManager.__actions=t.actionManager.actions,t.actionManager.actions=[]}function f(a){if(!a.flashDisabled){if(!a.isHiding){var b=a.flashMesh,c=b.rotation,d=new TimelineMax;d.set(b,{visibility:0,scalingDeterminant:0}),d.set(c,{z:0}),d.to(b,.3,{visibility:1,scalingDeterminant:1,ease:Power2.easeIn}),d.to(b,.3,{visibility:0,scalingDeterminant:0,ease:Power2.easeOut}),d.to(c,.6,{z:1,ease:Power2.easeInOut},"-=.6"),d.set(b,{scalingDeterminant:1})}var e=.8+Math.random();TweenMax.delayedCall(e,function(){a.flashTriggerTl.restart()})}}var g,h,i,j,k,l,m=!1,n={"/TattooMan":{type:"dialog",nameHead:"trigger",name:"tattoo-man",isNpc:!0,dialogs:['<span>我喜歡跟朋友參加派對，</span><span class="green">格蘭利威威士忌</span><span>是我的最愛！</span>',"<span>找到那瓶失踪的威士忌了沒？嘖！你真的破的了案嗎？</span>"],dialogEvent:null,triggerPhase:null,y:20},"/Backpacker":{type:"dialog",nameHead:"trigger",name:"backpacker",isNpc:!0,dialogs:["<span>昨晚在酒吧聽說有神秘新酒登台，全台僅624瓶!跟這案子有關嗎？</span>"],y:10},"/Bartender":{type:"dialog",nameHead:"trigger",name:"bartender",numNpcActions:2,currentAction:0,isNpc:!0,dialogs:["<span>對人最好的觀察就是從喝酒後開始</span>","<span>最近確實有個新來的客人，他都拿著一個公事包獨自坐在這喝酒，他剛剛才來過！</span></br><span>這就是他喝的杯子，也許您可以查查這杯子上的指紋？</span>"],changePhaseAfterDialog:null,changeActionWhenDialoging:null,changeHashAfterDialog:null,y:10},"/SportGirl":{type:"dialog",nameHead:"trigger",name:"sport-girl",isNpc:!0,dialogs:["<span>小心點，沒有證據請不要接近我！</span>",'<span>這裡的</span><span class="green">&nbsp;RAEP&nbsp;Bar&nbsp;</span><span>是我們社區鄰居喜歡聚集的地方，但最近好像有個不認識的人常進出這裡…</span>'],changePhaseAfterDialog:null,y:10},"/Businessman":{type:"dialog",nameHead:"trigger",name:"businessman",isNpc:!0,dialogs:["<span>我只是個商人，請問我什麼時候可以離開，我還得去趕飛機去參加名酒拍賣會啊！</span>",["<span>...</span>","<span>不回答！想必是心虛…他的公事包真的非常可疑！</span>"]],dialogEvent:null,y:10},"/Door":{type:"dialog",nameHead:"hint",name:"door",dialogs:["<span>打不開！果然沒有我想得那麼簡單！</span>"],dialogAnimeType:"shake",clearAble:!0,withHitarea:!0,hitareaIsShape:!0,y:10},"/Phone":{type:"hint",name:"mailbox"},"/Poster":{type:"hint",name:"poster",disableInStart:!0,withHitarea:!0,hitareaIsShape:!0,y:10},"/SportGirlSP":{type:"hint",name:"sport-girl-sp",disableInStart:!0,withHitarea:!0,hash:"/SportGirl",y:40},"/Billboard":{type:"hint",name:"billboard",disableInStart:!0,withHitarea:!0,hitareaIsShape:!0},"/Medal":{type:"hint",name:"medal",disableInStart:!0},"/Briefcase":{type:"hint",name:"briefcase",disableInStart:!0,withHitarea:!0,y:30}},o=window.Story.ObjectManager={getObjectDic:function(){return n},init:function(b){g=b,k=new BABYLON.Texture("textures/lightdemo.png",g),l=new BABYLON.Texture("textures/information_icon_new.png",g);var d,f,h=BillboardEditor.getDicByName(),i=ShapeEditor.getDicByName();for(d in n)f=n[d],e(h,i,d,f);c(),a()},getObject:function(a){return n[a]},setObjectEnabled:function(a,b){var c=n[a];c.isEnabled=b,d(a)},clearObject:function(a){var b=n[a];b&&(b.flashTriggerTl&&b.flashTriggerTl.kill(),b.editorObject&&(b.editorObject._mesh.setEnabled(!1),TweenMax.delayedCall(5,function(){b.editorObject.dispose()})),delete n[a])},setEnabled:function(a){a!=m&&(m=a,c())},setObjectDialog:function(a,b,c,d,e,f){var g=n[a];g&&g.dialogs&&(g.currentDialog=g.dialogs[b],g.changePhaseAfterDialog=c,g.changeActionWhenDialoging=d,g.changeHashAfterDialog=e,g.changePhaseAfterActionChange=f);
},changeNpcAction:function(a,b,c,d){c||0==c||(c=.8);var e=n[a];if(e&&e.npcArray){if(b==e.currentAction)return;var f=e.npcArray[b];if(!f)throw"npc object index: "+b+" for "+a+" not found.";var g=e.npcArray[e.currentAction];e.currentAction=b,f._mesh.setEnabled(!0);var h=new TimelineMax;h.set(f._mesh,{visibility:0}),h.to(f._mesh,c,{visibility:1,ease:Power2.easeInOut}),h.to(g._mesh,c,{visibility:0,ease:Power2.easeInOut},0),h.add(function(){g._mesh.setEnabled(!1),d&&d.call()})}},hideObject:function(a){var b=n[a],c=b.editorObject._mesh;b.isHiding=!0,b.flashTriggerTl&&b.flashTriggerTl.pause(),TweenMax.to(c,.5,{visibility:0})},showObject:function(a){var b=n[a],c=b.editorObject._mesh;b.isHiding=!1,b.flashTriggerTl&&b.flashTriggerTl.resume(),TweenMax.to(c,.5,{visibility:1})},showPointFingerAt:function(a,b){void 0==b&&(b=6);var c=n[a],d=c.editorObject._mesh.position.clone();d.y+=b,i.position=d,h.setEnabled(!0),TweenMax.to(h,.5,{visibility:1}),j=a},hidePointerFinger:function(){j=null,TweenMax.to(h,.5,{visibility:0,onComplete:function(){h.setEnabled(!1)}})},setDialogToNew:function(a){var b=n[a];b.newDialogMesh.setEnabled(!0),b.newDialogMeshTl.restart()},setDialogToNormal:function(a){var b=n[a];b.newDialogMesh.setEnabled(!1),b.newDialogMeshTl.pause()},disableFlash:function(a){n[a].flashDisabled=!0}}}(),function(){function a(a,b){var c=f.clips[a],d=c._unlocked;return c._unlocked=Boolean(b),c.toggleClass("lock-mode",!c._unlocked),d}function b(a){i=a,i<=0&&(i=0),i+j>=k&&(i=k-j),d(),e()}function c(){var a=80,c=200,d=1760,e=Main.settings.viewport.width,g=e-2*a;g>d&&(g=d);var h=g-2*c,k=parseInt(h/m.gapX),l=k*m.gapX,n=.5*(g-l),o=.5*(h-l);f.arrowLeft.css("left",o),f.arrowRight.css("right",o),j=k+1,f.centerContainer.css("width",g).css("margin-left",.5*-g),f.clipContainer.css("left",n),b(i)}function d(){var a=-i*m.gapX,b=.9;TweenMax.to(f.clipContainer,b,{marginLeft:a,ease:Power3.easeInOut});for(var c in f.clips){var d=f.clips[c],e=d._index-i<0||d._index-i>=j;d.toggleClass("hide-mode",e)}}function e(){j>=k?(f.arrowLeft.toggleClass("hide-mode",!0),f.arrowRight.toggleClass("hide-mode",!0)):(f.arrowLeft.toggleClass("hide-mode",0==i),f.arrowRight.toggleClass("hide-mode",i+j>=k))}var f={},g=!0,h=!1,i=0,j=0,k=0,l=null,m={width:0,height:0,gapX:0},n=window.Story.Evidences={needHideUI:!0,init:function(c,d){function e(b,c,d,e){var g=f.clips[d]=f.clipContainer.find(".clip-"+b);g._index=c,a(d,e),g.on(_CLICK_,function(){SP.play("click"),g._unlocked&&SceneHandler.toHash("/Story"+d)}),k++}f.container=c,f.parent=c.parent(),f.triggerButton=d,f.btnClose=f.container.find(".btn-close").on(_CLICK_,function(){SceneHandler.toHash("/Story")}),f.centerContainer=f.container.find(".center-container"),f.clipContainer=f.container.find(".clips"),f.clips={},e("key",0,"/Key",!0),e("phone",1,"/Phone"),e("map",2,"/Poster"),e("billboard",3,"/Billboard"),e("wineglass",4,"/Fingerprint"),e("medal",5,"/Medal"),e("briefcase",6,"/Briefcase");var g=f.clips["/Phone"];return m.width=parseInt(g.css("width")),m.height=parseInt(g.css("height")),m.gapX=parseInt(g.css("left")),f.clipContainer.find(".clip-locked").detach(),f.arrowLeft=f.container.find(".arrow-left").on(_CLICK_,function(){b(i-1)}),f.arrowRight=f.container.find(".arrow-right").on(_CLICK_,function(){b(i+1)}),f.container.detach(),h=!0,n},show:function(a){if(g){if(g=!1,f.triggerButton.toggleClass("news-mode",!1),f.parent.append(f.container),f.btnClose.toggleClass("showing-mode",!0),n.resize(),null!==l){var c=l-j+1;b(c),l=null}var d=new TimelineMax;d.set(f.container,{autoAlpha:0}),d.to(f.container,.4,{autoAlpha:1}),d.add(function(){a&&a.apply()})}},hide:function(a){if(!g){g=!0,f.btnClose.toggleClass("showing-mode",!1);var b=new TimelineMax;b.to(f.container,.4,{autoAlpha:0}),b.add(function(){f.container.detach(),a&&a.apply()})}},unlockEvidence:function(b){if(f.clips[b]){var c=a(b,!0);if(!c)return f.triggerButton.toggleClass("news-mode",!0),l=f.clips[b]._index,!0}return!1},isEvidenceUnlocked:function(a){return Boolean(f.clips[a]._unlocked)},resize:function(){h&&c()}}}(),function(){function a(){d.topBar.toggleClass("open-mode",d.container.scrollTop()>101)}function b(a){var b=[{url:"_story_rule.html",startWeight:0,weight:100,dom:null}];SceneHandler.loadTemplate(null,b,function(){c(b),e=!0,a.apply(null)},0)}function c(a){$("#invisible-container").append(a[0].dom),d.container=$("#story-rule"),d.contentContainer=d.container.find(".container"),d.topBar=d.container.find(".top-bar"),d.btnClose=d.container.find(".btn-close").on(_CLICK_,function(){SceneHandler.toLastHash()}),d.container.detach()}var d={},e=!1,f=window.StoryRule={_isPopup:!0,show:function(c){function g(){Menu.hide(),d.btnClose.toggleClass("showing-mode",!0),$("body").toggleClass("no-scroll-mode",!0).append(d.container),f.resize();var b=new TimelineMax;b.set(d.container,{autoAlpha:0}),b.to(d.container,.4,{autoAlpha:1}),b.add(function(){d.container.on("scroll",a),d.container.trigger("scroll"),c&&c.apply()})}e?g():b(g)},hide:function(b){d.container.unbind("scroll",a),d.btnClose.toggleClass("showing-mode",!1);var c=new TimelineMax;c.to(d.container,.4,{autoAlpha:0}),c.add(function(){d.container.detach(),$("body").toggleClass("no-scroll-mode",!1),b&&b.apply()})},resize:function(a,b,c){}}}(),function(){function a(a,c){var d=[{url:"_happy_end.html",startWeight:0,weight:100,dom:null}];SceneHandler.loadTemplate(null,d,function(){b(d),p=!0,a.apply(null)},!1,c)}function b(a){$("#invisible-container").append(a[0].dom),n.container=$("#happy-end"),e(),f(),h(),n.container.detach()}function c(a){$("#scene-container").append(n.container),t.resize(),Menu.show(),Menu.Logo._show(),TweenMax.set(n.firstStepContainer,{autoAlpha:0}),TweenMax.set(n.notReallyContainer,{autoAlpha:0}),TweenMax.set(n.formStepContainer,{autoAlpha:0}),TweenMax.set(n.container,{autoAlpha:0}),TweenMax.to(n.container,.5,{autoAlpha:1}),m=null,a.call()}function d(a){Menu.Logo._hide(),Menu.hide();var b=new TimelineMax;b.to(n.container,.4,{autoAlpha:0}),b.add(function(){n.container.detach(),a.apply()})}function e(){n.notReallyContainer=o["/NotReally"]=n.container.find(".not-really"),n.container.find(".btn-to-form-2").on(_CLICK_,function(){r=!0,SceneHandler.toHash("/HappyEnd/Form"),FB&&FB.ui({app_id:Main.settings.fb_appid,method:"feed",link:Utility.getPathWithFilename()+"?sharetype=badend"},function(){})})}function f(){var a=n.firstStepContainer=o["/Yes"]=n.container.find(".first-step"),b=n.container.find(".btn-to-form").on(_CLICK_,function(){r=!1,SceneHandler.toHash("/HappyEnd/Form"),FB&&FB.ui({app_id:Main.settings.fb_appid,method:"feed",link:Utility.getPathWithFilename()+"?sharetype=happyend"},function(){})}),c=a.find(".title"),d=a.find(".text"),e=a.find(".stamp");d.css("background-position","top"),n.firstStepContainer._show=function(f){d._height=0==Main.settings.viewport.index?158:173;var h=new TimelineMax;h.set(a,{autoAlpha:0}),h.set([c[0],e[0],b[0]],{autoAlpha:0}),h.set(d,{height:0}),h.add(Main.showWhiteCover,0),h.set(a,{autoAlpha:1},.4),h.set(c,{x:50,y:-50,marginTop:100,rotation:-30,scale:3}),h.set(e,{scale:1.5,marginTop:100}),h.add(Main.hideWhiteCover,.6),h.to(c,.3,{autoAlpha:1},"-=.1"),h.to(c,1.5,{x:0,y:0,rotation:0,scale:1,ease:SlowMo.ease.config(.3,.5,!1)},"-=.4"),h.to(e,.1,{scale:1,autoAlpha:1,ease:Back.easeOut},"+=.0"),h.add(g,"-=.0"),h.to([c[0],e[0]],1,{marginTop:0,ease:Power1.easeInOut},"+=.5"),h.to(d,.8,{height:d._height,ease:Linear.easeNone},"-=.4"),h.to(b,.4,{autoAlpha:1}),f&&h.add(f)}}function g(){var a=(16*Math.random()+16)*(Math.random()>.5?1:-1),b=(12*Math.random()+12)*(Math.random()>.5?1:-1);a*=.3,b*=.3;var c=$("body");TweenMax.killTweensOf(c),TweenMax.set(c,{marginLeft:a,marginTop:b}),TweenMax.to(c,.7,{marginLeft:0,marginTop:0,ease:Elastic.easeOut.config(1,.2)})}function h(){function a(a){a.on("change",function(){a.toggleClass("white-mode",0!=a[0].selectedIndex)})}n.formStepContainer=o["/Form"]=n.container.find(".form-step"),n.genderSelect=n.container.find(".gender-select"),a(n.genderSelect),n.fields={familyName:n.container.find(".family-name"),name:n.container.find(".user-name"),phone:n.container.find(".user-phone"),email:n.container.find(".user-email"),addressDetail:n.container.find(".address-detail")},0==Main.settings.viewport.index&&(n.fields.familyName.val("姓氏"),n.fields.name.val("名字")),MyTools.setupInput(n.fields.familyName,!0,20),MyTools.setupInput(n.fields.name,!0,20),MyTools.setupInput(n.fields.phone,!0,10),MyTools.setupInput(n.fields.email,!0,50),MyTools.setupInput(n.fields.addressDetail,!0,100),n.year=n.container.find("#select-year"),n.month=n.container.find("#select-month"),n.day=n.container.find("#select-day"),n.checkbox=n.container.find(".participate-checkbox");var b=new Date;b.setFullYear(b.getFullYear()-18),l=new DateCombo(n.year[0],n.month[0],n.day[0],null,null,null,null,"年","月","日",b),n.addressCounty=n.container.find(".address-county"),n.addressZone=n.container.find(".address-zone"),FormHelper.completeCounty(n.addressCounty,n.addressZone),n.btnRule=n.container.find(".btn-rule").on(_CLICK_,function(){SceneHandler.toHash("/StoryRule")}),n.btnPrivacy=n.container.find(".btn-privacy").add(".btn-privacy-2").on(_CLICK_,function(){console.log("check")}),n.btnSend=n.container.find(".btn-send").on(_CLICK_,function(){i()})}function i(){var a=k();a&&(a.is_fail=r?1:0,Loading.progress("資料傳輸中 ... 請稍候").show(),ApiProxy.callApi("lottery",a,!1,function(a){a.error?(alert(a.error),Loading.hide()):(alert("資料送出成功"),r=!0,j(),Loading.hide(),SceneHandler.toHash("/Participate/Product"))}))}function j(){l.reset(),n.fields.familyName.val("").trigger("blur"),n.fields.name.val("").trigger("blur"),n.fields.phone.val("").trigger("blur"),n.fields.email.val("").trigger("blur"),n.fields.addressDetail.val("").trigger("blur"),$(n.genderSelect.find("option")[0]).prop({selected:!0}).trigger("change"),n.addressCounty.prop("selectedIndex",0),n.addressCounty.trigger("change"),n.addressZone.prop("selectedIndex",0)}function k(){var a,b={};if(!n.checkbox[0].checked)return void alert("您必須同意遵守活動相關規範才能參加活動");if(b.gender=n.genderSelect.val(),!b.gender)return void alert("請選擇您的性別");if(a=n.fields.familyName[0],!n.fields.familyName._checkOk()||PatternSamples.onlySpace.test(a.value))return alert("請輸入您的姓氏"),void a.focus();if(b.family_name=a.value,a=n.fields.name[0],!n.fields.name._checkOk()||PatternSamples.onlySpace.test(a.value))return alert("請輸入您的名字"),void a.focus();if(b.name=a.value,a=n.fields.phone[0],!PatternSamples.phone.test(a.value))return alert("請輸入正確的手機號碼"),void a.focus();if(b.phone=a.value,a=n.fields.email[0],!PatternSamples.email.test(a.value))return alert("請輸入正確的電子郵件信箱"),void a.focus();b.email=a.value;var c=l.getDateValue();if(!(c.year&&c.month&&c.day))return void alert("請輸入您的生日");b.birth_year=c.year,b.birth_month=c.month,b.birth_day=c.day;var d=FormHelper.getAddressValue(n.addressCounty,n.addressZone);return d.county?d.zone?(b.address_county=d.county,b.address_zone=d.zone,a=n.fields.addressDetail[0],!n.fields.addressDetail._checkOk()||PatternSamples.onlySpace.test(a.value)?(alert("請輸入詳細的地址"),void a.focus()):(b.address_detail=a.value,b)):void alert("請選擇您居住的地區"):void alert("請選擇您居住的縣市")}var l,m,n={},o={"/NotReally":!0,"/Yes":!0,"/Form":!0},p=!1,q=!1,r=!0,s=null,t=window.HappyEnd={preload:function(){p||(q=!0,a(function(){q=!1,s&&(s.call(),s=null)},!0))},stageIn:function(b,d){function e(a){a&&b.cbContentLoaded&&b.cbContentLoaded.call(),c(function(){b.contentHash?t.toContent(b.contentHash,d):d.call()})}q?s=e:p?e():a(e)},stageOut:function(a,b){d(b)},executeAfterPopupClosed:function(){Menu.show()},toContent:function(a,b){if(p){a||(a="/NotReally");var c=o[a];if(c){var d=new TimelineMax;m&&d.to(m,.5,{autoAlpha:0}),m=c,"/Yes"==a?n.firstStepContainer._show(b):(d.set(m,{autoAlpha:0}),d.to(m,.5,{autoAlpha:1}),d.add(b))}}},resize:function(){}}}(),function(){function a(){var a="https://cipherapp.theglenlivet.com/?language=tw&country=tw";d.container=$('<iframe id="roulette" src="'+a+'" width="100%" height="100%"></iframe>'),d.container.attr("width","100%").attr("height","100%")}function b(a){$("#scene-container").append(d.container),f.resize(),$("#logo").toggleClass("roulette-mode",!0),$("#menu").find(".icon").toggleClass("roulette-mode",!0),$("body").toggleClass("roulette-mode",!0),$(".footer").toggleClass("roulette-mode",!0),Menu.show(),Menu.Logo._show();var b=new TimelineMax;b.set(d.container,{autoAlpha:0}),b.to(d.container,.4,{autoAlpha:1}),b.add(function(){a.apply()})}function c(a){Menu.hide(),Menu.Logo._hide();var b=new TimelineMax;b.to(d.container,.4,{autoAlpha:0}),b.add(function(){$("#logo").toggleClass("roulette-mode",!1),$("#menu").find(".icon").toggleClass("roulette-mode",!1),$("body").toggleClass("roulette-mode",!1),$(".footer").toggleClass("roulette-mode",!1),d.container.detach(),a.apply()})}var d={},e=!1,f=window.Roulette={stageIn:function(c,d){function f(a){a&&c.cbContentLoaded&&c.cbContentLoaded.call(),b(d)}function g(b){Loading.hide(),a(),e=!0,b.apply(null)}e?f():g(f)},stageOut:function(a,b){c(b)},resize:function(){}}}(),function(){function a(a){$("#invisible-container").append(a[0].dom),i.container=$("#notes"),i.topMenu=i.container.find(".top-menu"),i.buttonContainer=i.container.find(".button-container"),i.sectionContainer=i.container.find(".sections"),i.topMenu=i.container.find(".top-menu");for(var c=1;c<=10;c++)b(c);i.container.detach()}function b(a){i["section-"+a]=i.sectionContainer.find(".section:nth-child("+a+")");var b=i["button-"+a]=i.buttonContainer.find(".button:nth-child("+a+")").on(_CLICK_,function(){h=a,m.toContent(a)}).on("pointerenter",function(){b.toggleClass("selected-mode",!0)}).on("pointerout",function(){a!==h&&b.toggleClass("selected-mode",!1),l||c()})}function c(){if(!l){i.topMenu.toggleClass("scrolled-mode",$(window).scrollTop()>10);var a,b,c=d(),f=$(window).scrollTop()+c+50,g=1;for(a=1;a<=10&&(b=i["section-"+a],!(b.offset().top>=f));a++)g=a;e(g)}}function d(){var a=parseInt(i["section-1"].css("margin-top"));return 0==Main.settings.viewport.index&&(a-=82),a}function e(a){var b=k;k=a,b&&i["button-"+b].toggleClass("selected-mode",!1),i["button-"+k].toggleClass("selected-mode",!0)}function f(a){$("#scene-container").append(i.container),$(window).on("scroll",c),c(),Menu.show(),m.resize();var b=new TimelineMax;b.set(i.container,{autoAlpha:0}),b.to(i.container,.4,{autoAlpha:1}),b.add(function(){a.apply()})}function g(a){Menu.hide(),$(window).unbind("scroll",c);var b=new TimelineMax;b.to(i.container,.4,{autoAlpha:0}),b.add(function(){i.container.detach(),a.apply()})}var h,i={},j=!1,k=null,l=!1,m=window.Notes={stageIn:function(b,c){function d(a){a&&b.cbContentLoaded&&b.cbContentLoaded.call(),f(c)}function e(b){var c=[{url:"_notes.html",startWeight:0,weight:100,dom:null}];SceneHandler.loadTemplate(null,c,function(){a(c),j=!0,b.apply(null)},0)}j?d():e(d)},stageOut:function(a,b){g(b)},executeAfterPopupClosed:function(){Menu.show()},toContent:function(a,b){if(j){var f=i["section-"+a],g=f.offset().top-d();1==a&&(g=0);var h=Math.abs(g-$(window).scrollTop()),k=h/1400;k<.7&&(k=.7),k>2&&(k=2),e(a),1!=a&&i.topMenu.toggleClass("scrolled-mode",!0),l=!0,TweenLite.killTweensOf(window),TweenLite.to(window,k,{scrollTo:g,ease:Power1.easeInOut,onComplete:function(){l=!1,c(),b&&b.call()}})}},resize:function(){if(j){var a=Main.settings.viewport,b=i["section-10"],e=0==a.index?50:300,f=.1*a.height+e,g=a.height-b.height()-d();g<f&&(g=f),b.css("margin-bottom",g),c()}}}}(),function(){function a(a){function b(){SceneHandler.toHash("/ParticipateRule")}$("#invisible-container").append(a[0].dom),n.container=$("#participate"),n.topBar=n.container.find(".top-bar"),n["/Logo"]=n.container.find(".part-1"),n["/Product"]=n.container.find(".part-2"),n["/Form"]=n.container.find(".part-3"),n.arrowDown1=n["/Logo"].find(".arrow-down").on(_CLICK_,function(){p.toContent("/Product")}),n.arrowDown2=n["/Product"].find(".arrow-down").on(_CLICK_,function(){p.toContent("/Form")}),n.year=n.container.find("#select-year"),n.month=n.container.find("#select-month"),n.day=n.container.find("#select-day"),n.checkbox=n.container.find(".participate-checkbox");var f=new Date;f.setFullYear(f.getFullYear()-18),l=new DateCombo(n.year[0],n.month[0],n.day[0],null,null,null,null,"年","月","日",f),n.eventTimes=[n.container.find(".time-group-1"),n.container.find(".time-group-2"),n.container.find(".time-group-3"),n.container.find(".time-group-4")],n.eventSelect=n.container.find(".event-select"),n.genderSelect=n.container.find(".gender-select"),c(n.eventSelect),c(n.genderSelect),n.fields={name:n.container.find(".user-name"),phone:n.container.find(".user-phone"),email:n.container.find(".user-email")},MyTools.setupInput(n.fields.name,!0,20),MyTools.setupInput(n.fields.phone,!0,10),MyTools.setupInput(n.fields.email,!0,50),n.btnSend=n.container.find(".btn-send").on(_CLICK_,function(){i()}),n.btnRule=n.container.find(".btn-rule").on(_CLICK_,function(){SceneHandler.toHash("/ParticipateRule")}),n.btnPrivacy=n.container.find(".btn-privacy").on(_CLICK_,b),n.btnPrivacy2=n.container.find(".btn-privacy-2").on(_CLICK_,b),e(),d(),n.container.detach()}function b(a){function b(){f++,Loading.progress(g+f/e*h),f==e&&a.call()}var c,d=["js/lib/createjs-2015.11.26.min.js","js/lib/CreatejsExtend.js","js/animes/form_Canvas.js"],e=d.length,f=0,g=.7,h=.3,i=$LAB;for(c=0;c<d.length;c++)i=i.script(d[c]).wait(b)}function c(a){a.on("change",function(){a.toggleClass("white-mode",0!=a[0].selectedIndex)})}function d(){var a,b,c,d=n.textCanvas=n.container.find(".text-animation");a=d[0],c=new lib.form_Canvas,b=new createjs.Stage(a),b.addChild(c),b.update(),createjs.Ticker.setFPS(lib.properties.fps),createjs.Ticker.addEventListener("tick",b)}function e(){var a,b,c,d,e,f={},g=[];for(a=0;a<m.length;a++)e=m[a],d=e.event_date,f[d]||(f[d]=[],g.push(d)),f[d].push(e);for(n.eventSelect.empty(),n.eventSelect.append("<option value='' disabled='disabled' selected='selected'>選擇場次</option>"),a=0;a<g.length;a++)for(d=g[a],c=$(document.createElement("optgroup")).attr("label",d),n.eventSelect.append(c),b=0;b<f[d].length;b++){e=f[d][b];var h=n.eventTimes[a].find(".time:nth-child("+(b+1)+")");"1"==e.participate_able&&parseInt(e.num_participated)<10?(h.toggleClass("filled",!1),c.append("<option value='"+e.id+"'>"+e.event_name+"</option>")):h.toggleClass("filled",!0)}}function f(){n.topBar.toggleClass("open-mode",$(window).scrollTop()>101)}function g(a){$("#scene-container").append(n.container),p.resize(),Menu.show();var b=new TimelineMax;b.set(n.container,{autoAlpha:0}),b.to(n.container,1,{autoAlpha:1,ease:Power3.easeIn}),b.add(function(){$(window).on("scroll",f),$(window).trigger("scroll"),a.apply()})}function h(a){$(window).unbind("scroll",f);var b=new TimelineMax;b.to(n.container,.4,{autoAlpha:0}),b.add(function(){n.container.detach(),a.apply()})}function i(){var a=k();a&&(Loading.progress("資料傳輸中 ... 請稍候").show(),ApiProxy.callApi("participate",a,!1,function(a){a.error?(alert(a.error),"該場次名額已滿"==a.error?ApiProxy.callApi("get_event_data",null,null,function(a){a.error?alert(a.error):(m=a.data,e()),Loading.hide()}):Loading.hide()):(alert("資料送出成功"),j(),Loading.hide())}))}function j(){l.reset(),n.fields.name.val("").trigger("blur"),n.fields.phone.val("").trigger("blur"),n.fields.email.val("").trigger("blur"),$(n.eventSelect.find("option")[0]).prop({selected:!0}).trigger("change"),$(n.genderSelect.find("option")[0]).prop({selected:!0}).trigger("change")}function k(){var a,b={};if(b.gender=n.genderSelect.val(),!b.gender)return void alert("請選擇您的性別");if(b.event_id=n.eventSelect.val(),!b.event_id)return void alert("請選擇活動場次");if(!n.checkbox[0].checked)return void alert("您必須同意遵守活動相關規範才能參加活動");if(a=n.fields.name[0],!n.fields.name._checkOk()||PatternSamples.onlySpace.test(a.value))return alert("請輸入您的名稱"),void a.focus();if(b.name=a.value,a=n.fields.phone[0],!PatternSamples.phone.test(a.value))return alert("請輸入正確的手機號碼"),void a.focus();if(b.phone=a.value,a=n.fields.email[0],!PatternSamples.email.test(a.value))return alert("請輸入正確的電子郵件信箱"),void a.focus();b.email=a.value;var c=l.getDateValue();return c.year&&c.month&&c.day?(b.birth_year=c.year,b.birth_month=c.month,b.birth_day=c.day,b):void alert("請輸入您的生日")}var l,m,n={},o=!1,p=window.Participate={stageIn:function(c,d){function e(a){a&&c.cbContentLoaded&&c.cbContentLoaded.call(),g(function(){c.contentHash?p.toContent(c.contentHash,d):d.call()})}function f(c){var d=[{url:"_participate.html",startWeight:0,weight:70,dom:null}];SceneHandler.loadTemplate(null,d,function(){b(function(){ApiProxy.callApi("get_event_data",null,null,function(b){Loading.hide(),m=b.data,a(d),o=!0,c.apply(null)})})},!0)}o?e():f(e)},stageOut:function(a,b){h(b)},executeAfterPopupClosed:function(){Menu.show()},toContent:function(a,b){if(o){a||(a="/Logo");var c=n[a],d=c.offset().top;"/Logo"!=a&&Main.settings.viewport.width<=640&&(d-=101),TweenLite.to(window,.8,{scrollTo:d,ease:Power1.easeInOut,onComplete:b})}},resize:function(){if(o){var a=Main.settings.viewport;n.textCanvas&&n.textCanvas.attr("width",Math.min(a.width,1920)).attr("height",Math.min(a.height,1080)),n["/Logo"].css("height",.9*a.height)}},reset:j}}(),function(){function a(){d.topBar.toggleClass("open-mode",d.container.scrollTop()>101)}function b(a){var b=[{url:"_participate_rule.html",startWeight:0,weight:100,dom:null}];SceneHandler.loadTemplate(null,b,function(){c(b),e=!0,a.apply(null)},0)}function c(a){$("#invisible-container").append(a[0].dom),d.container=$("#participate-rule"),d.contentContainer=d.container.find(".container"),d.topBar=d.container.find(".top-bar"),d.btnClose=d.container.find(".btn-close").on(_CLICK_,function(){SceneHandler.toLastHash()}),d.container.detach()}var d={},e=!1,f=window.ParticipateRule={_isPopup:!0,show:function(c){function g(){Menu.hide(),d.btnClose.toggleClass("showing-mode",!0),$("body").toggleClass("no-scroll-mode",!0).append(d.container),f.resize();var b=new TimelineMax;b.set(d.container,{autoAlpha:0}),b.to(d.container,.4,{autoAlpha:1}),b.add(function(){d.container.on("scroll",a),d.container.trigger("scroll"),c&&c.apply()})}e?g():b(g)},hide:function(b){d.container.unbind("scroll",a),d.btnClose.toggleClass("showing-mode",!1);var c=new TimelineMax;c.to(d.container,.4,{autoAlpha:0}),c.add(function(){d.container.detach(),$("body").toggleClass("no-scroll-mode",!1),b&&b.apply()})},resize:function(a,b,c){}}}(),function(){function a(a,b,c,d,e,f){this._canvas=a,this._scene=b;var i=this._camera=new BABYLON.ArcRotateCamera("camera1",0,0,0,new BABYLON.Vector3(0,0,-1),b);i.setTarget(new BABYLON.Vector3(0,0,0)),i.angularSensibilityX=2500,i.angularSensibilityY=2500,i.radius=this._defaultCameraRadius=d,i.upperBetaLimit=h+g*e/180,i.lowerBetaLimit=h-g*f/180,this._tweenObj.alpha=this._tweenObj.targetAlpha=i.alpha=0,this._tweenObj.beta=this._tweenObj.targetBeta=i.beta}function b(){function a(a){var c=a.alpha,d=a.beta;d=90-.5*(d-60);var e=c/180*g,f=d/180*g;b._camera.alpha=b._camera.alpha%i,Math.abs(e-b._camera.alpha)>g&&(e>b._camera.alpha?b._camera.alpha+=i:b._camera.alpha-=i,console.log(b._camera.alpha)),b._camera.inertialAlphaOffset=.1*(e-b._camera.alpha),b._camera.inertialBetaOffset=.1*(f-b._camera.beta)}var b=this;this._useDeviceOrientation?(this.handleOrientation=a,window.addEventListener("deviceorientation",a)):($(this._canvas).on("pointerdown",{self:this},d),$(window).on("pointermove",{self:this},e).on("pointerup",{self:this},f))}function c(){this._useDeviceOrientation?window.removeEventListener("deviceorientation",this.handleOrientation):($(this._canvas).unbind("pointerdown",d),$(window).unbind("pointermove",e).unbind("pointerup",f),this._tweenObj.pointerDownPosition=null)}function d(a){var b=a.data.self;b._tweenObj.pointerDownPosition={x:a.clientX,y:a.clientY}}function e(a){var b=a.data.self,c=b._tweenObj.pointerDownPosition;if(c){b._cbOnDrag&&(b._cbOnDrag.call(),b._cbOnDrag=null);var d=$(b._canvas).width(),e=$(b._canvas).height(),f=a.clientX-c.x,g=a.clientY-c.y,h=f/d*.2,i=g/e*.1;b._tweenObj.pointerDownPosition={x:a.clientX,y:a.clientY},b._camera.inertialAlphaOffset+=h,b._camera.inertialBetaOffset+=i}}function f(a){var b=a.data.self;b._tweenObj.pointerDownPosition=null}var g=Math.PI,h=.5*g,i=2*g;window.CustomCamera=a,a.prototype={_canvas:null,_scene:null,_camera:null,_oldAlpha:null,_oldBeta:null,_oldPosition:null,_oldRadius:null,_oldRadius2:null,_defaultCameraRadius:0,_dBetaLimitArc:0,_cbOnDrag:null,_tweenObj:{pointerDownPosition:null,targetAlpha:0,alpha:0,targetBeta:0,beta:0},_isEnabled:!1,_useDeviceOrientation:!1,listenDrag:function(a){this._cbOnDrag=a},setEnabled:function(a){this._isEnabled!=a&&(this._isEnabled=a,this._isEnabled?b.call(this):c.call(this))},getAlpha:function(){return this._camera.alpha},lookAt:function(a,b){this._camera.alpha%=i,this._oldAlpha=this._camera.alpha,this._oldBeta=this._camera.beta;var c=Math.atan2(-a.z,-a.x),d=Math.sqrt(a.x*a.x+a.z*a.z),e=Math.atan2(-a.y,-d)-h;e<0&&(e+=i),Math.abs(this._oldAlpha-c)>g&&(c>this._oldAlpha?c-=i:c+=i);var f=new TimelineMax;f.to(this._camera,1,{alpha:c,beta:e,ease:Power1.easeInOut}),f.add(b)},focusOn:function(a,b){var c=this;this._camera.alpha%=i,this._oldAlpha=this._camera.alpha,this._oldBeta=this._camera.beta;var d=Math.atan2(-a.z,-a.x),e=Math.sqrt(a.x*a.x+a.z*a.z),f=Math.atan2(-a.y,-e)-h;f<0&&(f+=i),Math.abs(this._oldAlpha-d)>g&&(d>this._oldAlpha?d-=i:d+=i);var j=new TimelineMax;j.to(this._camera,1,{alpha:d,beta:f,ease:Power1.easeInOut}),j.add(function(){SP.play("zoom",{delay:400});var b=c._camera.position.subtract(a).length();c._oldPosition=c._camera.position.clone(),c._oldRadius=c._camera.radius,c._oldRadius2=b,c._camera.setTarget(a),c._camera.radius=b});var k=j.duration();j.to(this._camera,1.5,{radius:60,ease:Linear.easeNone},k),j.to(this._camera,1.5,{fov:1.6,ease:Linear.easeNone},k),j.add(b)},recover:function(a){var b=this,c=new TimelineMax;c.to(this._camera,1.5,{radius:this._oldRadius2,fov:.8,ease:Linear.easeNone}),c.add(function(){b._camera.setTarget(BABYLON.Vector3.Zero()),b._camera.radius=b._oldRadius;var a=b._camera.alpha;Math.abs(b._oldAlpha-a)>g&&(a>b._oldAlpha?a-=i:a+=i,b._camera.alpha=a)}),c.to(this._camera,1,{beta:.5*g,radius:75,fov:.8,ease:Power1.easeInOut}),c.add(a)},resetCamera:function(a,b,c){var d=new BABYLON.Animation("alphaAnim","alpha",60,BABYLON.Animation.ANIMATIONTYPE_FLOAT,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),e=(new BABYLON.Animation("betaAnim","beta",60,BABYLON.Animation.ANIMATIONTYPE_FLOAT,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),[{frame:0,value:this._camera.alpha},{frame:100,value:a}]);d.setKeys(e),this._camera.animations.push(d),this._scene.beginAnimation(this._camera,0,100,!1,1,c)}}}(),function(){var a=130,b=1e3,c=50;window.RainMaker={init:function(d){var e=new BABYLON.ParticleSystem("particles",b,d);e.particleTexture=new BABYLON.Texture("textures/rain-drop.png?v=1232",d),e.minSize=20,e.minLifeTime=.2,e.maxLifeTime=.2,e.minEmitPower=50.5,e.emitter=new BABYLON.Vector3(0,50,0),e.emitRate=b,e.blendMode=BABYLON.ParticleSystem.BLENDMODE_ONEONE,e.direction1=new BABYLON.Vector3(0,-c,0),e.direction2=new BABYLON.Vector3(0,-c,0),e.gravity=new BABYLON.Vector3(0,-5,0),e.minEmitBox=new BABYLON.Vector3(-a,0,-a),e.maxEmitBox=new BABYLON.Vector3(a,0,a),e.renderingGroupId=2,e.start()}}}(),function(){function a(){var a="scene",c=.1,f=new BABYLON.Vector2(0,0),h=new BABYLON.PostProcess(a,a,["time","motion","radialMotionPower"],null,1,null,null,b,!1),i=g[a];i.effect=new BABYLON.PostProcessRenderEffect(b,a,function(){return h}),e.addEffect(i.effect);var j={radialMotionPower:0};i.raidalMotionTo=function(a,b,c,d){if(c||(c=Power1.easeInOut),0==b)return j.radialMotionPower=a,void(d&&d.call());var e=new TimelineMax;e.to(j,b,{radialMotionPower:a,ease:c}),d&&e.add(d)},h.onApply=function(a){c+=.01,a.setFloat("time",c);var b=100*-d.inertialAlphaOffset;b>1&&(b=1),b<-1&&(b=-1),Math.abs(b)>Math.abs(f.x)&&(f.x=b),f.x*=.87,f.x<.01&&f.x>.01&&(f.x=0),b=100*-d.inertialBetaOffset,b>1&&(b=1),b<-1&&(b=-1),Math.abs(b)>Math.abs(f.y)&&(f.y=b),f.y*=.87,f.y<.01&&f.y>.01&&(f.y=0),a.setVector2("motion",f),a.setFloat("radialMotionPower",j.radialMotionPower)}}var b,c,d,e,f="scenePipeline",g={scene:{label:"雜訊 + 動態模糊",enabled:!1,effect:null}};window.PostProcessLib={init:function(h,i,j){b=h,c=i,d=j,e=new BABYLON.PostProcessRenderPipeline(h,f),a(),c.postProcessRenderPipelineManager.addPipeline(e),c.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(f,j);for(var k in g)g[k].enabled||c.postProcessRenderPipelineManager.disableEffectInPipeline(f,k,d)},getEffect:function(a){return g[a]},enableEffect:function(a){return g[a]?(g[a].enabled=!0,void c.postProcessRenderPipelineManager.enableEffectInPipeline(f,a,d)):void console.error("effect: ["+a+"] not defined")},disableEffect:function(a){return g[a]?(g[a].enabled=!1,void c.postProcessRenderPipelineManager.disableEffectInPipeline(f,a,d)):void console.error("effect: ["+a+"] not defined")}}}(),function(){function a(){Main.gui.add(i,"_triggerLoad").name("讀入場景"),Main.gui.add(i,"_triggerSave").name("儲存場景")}function b(){Loading.progress("打包檔案中").show();var a=SphereScene.getBackgroundData();if(a){var b=BillboardEditor.getExportData(),c=ShapeEditor.getExportData(),d=LightEditor.getExportData(),e=[a].concat(b.imageArray).concat(b.lightImageArray),g={version:h,backgroundImage:a.name,backgroundImageHead:a.imageHead,backgroundRotationY:SphereScene._rotationY,billboardData:b.dataArray,shapeData:c.dataArray,lightData:d.dataArray},i=new JSZip;i.file("config.json",JSON.stringify(g)),f(i,e,function(){i.generateAsync({type:"blob"}).then(function(a){saveAs(a,"scenedata.zip"),Loading.hide()})})}else alert("缺乏背景影像，請選取或讀入不同場景圖片"),Loading.hide()}function c(){function a(a){if(a.files&&a.files[0]){var b=a.files[0];JSZip.loadAsync(b).then(function(a){d.call(null,a,SphereScene)})}}g=$("#scene-input");var b=g[0];g.on("change",function(){Loading.progress("載入場景資料中").show(),a(b)})}function d(a,b,c){var d=a.file("config.json");d?d.async("string").then(function(d){var f;try{f=JSON.parse(d)}catch(a){return void alert("file error: illegal data format")}if(f.version!==h)alert("file error: file version ["+f.version+"] outdated");else{Loading.progress("資料分析中").show();var g=f.billboardData,i=f.shapeData,j=f.lightData;e(a,function(a){BillboardEditor.applyImportData(g,a),ShapeEditor.applyImportData(i),LightEditor.applyImportData(j),b.applyBase64Background(f.backgroundImageHead+a["textures/"+f.backgroundImage]),void 0!==f.backgroundRotationY&&(SphereScene._rotationY=f.backgroundRotationY,SphereScene.updateSeceneRotation()),c&&c.call(),Loading.hide()})}}):alert("file error: missing data")}function e(a,b){var c={},d=0;a.folder("textures/").forEach(function(e,f){f.dir||(d++,a.file(f.name).async("base64").then(function(a){d--,c[f.name]=a,0==d&&b.call(null,c)}))}),0==d&&b.call(null,c)}function f(a,b,c){function d(){if(e++,e>=b.length)return void c.call();var f=b[e];f.isDataUrl?(a.file(f.folderPath+f.name,f.data,{base64:!0}),d()):JSZipUtils.getBinaryContent(f.data,function(b,c){if(b)throw b;a.file(f.folderPath+f.name,c,{binary:!0}),d()})}var e=-1;d()}var g,h="0.0.2",i=window.DataManager={BILLBOARD_FOLDER_PATH:"textures/billboard/",PNG_HEAD:"data:image/png;base64,",JPEG_HEAD:"data:image/jpeg;base64,",init:function(){c(),a()},loadFromZip:function(a,b,c){Loading.progress("載入場景資料中").show(),JSZipUtils.getBinaryContent(a,function(a,e){if(a)throw a;JSZip.loadAsync(e).then(function(a){d.call(null,a,b,c)})})},loadFromExtractedData:function(a,b,c,d,e){var f=c?"textures_m":"textures";$.ajax(a+"config.json?v="+Main.version).done(function(g){if(c){var h,i,j=g.billboardData;for(h=0;h<j.length;h++)i=j[h],i.scale=2*Number(i.scale)}b.applyBackground(a+"textures/"+g.backgroundImage,function(){d.call(null,"background",1,1),ShapeEditor.applyImportData(g.shapeData),LightEditor.applyImportData(g.lightData),BillboardEditor.applyImportData(g.billboardData,a+f+"/billboard/",function(a,b){d.call(null,"billboard",a,b)},function(){e&&e.call()})})})},_triggerLoad:function(){g.value=null,g.click()},_triggerSave:function(){b()}}}(),function(){function a(a,b,c,d,e){this.name=a,this.data=c,this.folderPath=b,this.isDataUrl=d,this.imageHead=e}window.ImageObject=a,a.prototype={name:null,data:null,folderPath:null,
isDataUrl:!1,imageHead:null},a.HandleImageSrc=function(a,b){var c;if(b){var d=a,e=d.indexOf(",")+1;c=d.substr(0,e),a=d.substr(e)}else{var f=a.split(".");f=f.pop(),"png"==f&&(c=DataManager.PNG_HEAD),"jpg"!=f&&"jpeg"!=f||(c=DataManager.JPEG_HEAD)}return{imageSrc:a,imageHead:c}}}(),function(){var a={},b=window.ShaderLoader={preventCache:!0,defaultPath:"shaders/",extension:".fx.html",loadFiles:function(a,c){function d(){if(e<a.length){var f=a[e];e++,b.loadOne(f,d)}else null!=c&&c.apply()}var e=0;d()},loadOne:function(c,d){var e=b.defaultPath+c+b.extension;b.preventCache&&(e+="?v="+(new Date).getTime());var f=document.createElement("div");$(f).load(e,function(){a[c]=f;var b=$(f).find("shader");b.each(function(a,b){var d=$(b),e=d.find("script[type='x-shader/x-vertex']"),f=d.find("script[type='x-shader/x-fragment']"),g=b.id;g?(e.length&&(BABYLON.Effect.ShadersStore[g+"VertexShader"]=e.text()),f.length&&(BABYLON.Effect.ShadersStore[g+"FragmentShader"]=f.text())):console.warn("loaded shader file: ["+c+"] shader element lack id")}),null!=d&&d.apply()})}}}(),function(){function a(){var a=new BABYLON.StandardMaterial("wireframe",d);a.wireframe=!0,a.hasAlpha=!0,a.alpha=.5,e.wireframe=a}function b(){var a=new BABYLON.StandardMaterial("material1",d);return a.emissiveColor=new BABYLON.Color3(1,1,1),a.backFaceCulling=!1,a}function c(){var a=0,b=.01,c=new BABYLON.ShaderMaterial("noiseShader",d,"noise",{attributes:["position","normal","uv"],uniforms:["worldViewProjection"]});c.__motion=new BABYLON.Vector2(0,0),c.setFloat("time",a),c.setVector2("motion",c.__motion),c.backFaceCulling=!1,d.registerBeforeRender(function(){a+=b,c.setFloat("time",a)}),e.noise=c}var d,e={};window.MaterialLib={defaultPath:"textures/",init:function(f){d=f,e.normal=b(),a(),c()},createNormal:b,getMaterial:function(a){return e[a]}}}(),function(){function a(){f=Main.gui,g=f.addFolder("shapeEditorFolder"),$(g.domElement).css("display","none")}function b(a){if(h){for(var b in h)h[b].remove();h=null}a&&(c(),h={name:g.add(p,"triggerChangeName").name("改變名稱"),renderingOrder:g.add(i,"_renderingOrder")},h.renderingOrder=h.renderingOrder.min(-10).max(10).step(1).name("圖層深度"),h.renderingOrder.onChange(function(){a.updateRenderingOrder()}),h.toLastStep=g.add(p,"requestToLastStep").name("刪除點 (Ctrl+Z)"),h.deleteAll=g.add(p,"clearEditingObject").name("刪除全部 (Delete)"),h.complete=g.add(p,"completeEdit").name("完成 (SPACEBAR)"),g.open())}function c(){d("編輯中形狀: "+i._name)}function d(a){f.resetFolderLabel(g.name,a)}var e,f,g,h,i,j=!1,k="按住 Ctrl 點擊畫面新增 Shape",l=0,m={},n=[],o=!1,p=window.ShapeEditor={objectDefaultRenderingOrder:100,objectRenderingGroupId:1,editorRenderingGroupId:3,container:null,nodeSample:null,focusNodeSample:null,getEditorObjectDic:function(){return m},setEditorRenderingGroupId:function(a){p.editorRenderingGroupId=a,p.nodeSample&&(p.nodeSample.renderingGroupId=a),p.focusNodeSample&&(p.focusNodeSample.renderingGroupId=a)},init:function(b,c){e=b,this.container=new BABYLON.Mesh("shape container",e),this.container.isPickable=!1,this.nodeSample=Tools.createNodeSample(e,BABYLON.Color3.Blue()),this.focusNodeSample=Tools.createNodeSample(e,BABYLON.Color3.Red()),this.nodeSample.parent=this.container,this.nodeSample.renderingGroupId=this.editorRenderingGroupId,this.focusNodeSample.parent=this.container,this.focusNodeSample.renderingGroupId=this.editorRenderingGroupId,c||(a(),d(k),KeyboardControl.add("ShapeEditor complete",KeyCodeDic.space,{onKeyUp:function(){o&&j&&i&&i.getNumPoints()>2&&p.completeEdit()}}).add("ShapeEditor toLastStep","Z".charCodeAt(0),{onKeyDown:function(){o&&KeyboardControl.funcKeysDown.ctrl&&i&&p.requestToLastStep()}}).add("ShapeEditor delete",KeyCodeDic.delete,{onKeyDown:function(){o&&p.clearEditingObject()}}))},getDicByName:function(){var a={};for(var b in m){var c=m[b];a[c._name]=c}return a},enable:function(){o||(o=!0,$(g.domElement).css("display","block"))},disable:function(){o&&(o=!1,$(g.domElement).css("display","none"),j&&(i.getNumPoints()>2?this.completeEdit():(i.clear(),p._editModeOff(!0))))},editAtPoint:function(a,c){j||(i||(n.length?i=n.pop():(l++,i=new ShapeObject(l,e)),i._mesh&&(i._mesh.isPickable=!1),m[i._serial]=i,b(i)),this._editModeOn()),i.setEnabled(!0),i.addPoint(a,c)},edit:function(a){if(m[a]){if(i&&i==m[a])return;i&&(i._mesh&&(i._mesh.isPickable=!0),i.setEnabled(!1),i._points.length<3&&(i.clear(),n.push(i),delete m[i._serial])),i=m[a],i.setEnabled(!0),i._mesh&&(i._mesh.isPickable=!1),b(i),this._editModeOn(),p.update()}},_editModeOn:function(){j||(j=!0,g.open(),p.update())},_editModeOff:function(a){j&&(j=!1,i&&(i._mesh&&(i._mesh.isPickable=!0),i.setEnabled(!1),i._points.length<3&&(n.push(i),delete m[i._serial]),i=null),b(),d(k),p.update())},triggerChangeName:function(){if(i){var a=prompt("請輸入新的名稱",i._name);if(null!==a&&""!==a){var b=!1;for(var d in m){var e=m[d];if(e._name===a){alert("這個名稱已經被使用了"),b=!0;break}}b||(i._name=a,c())}}},update:function(){if(j&&i){var a=i.getNumPoints();h.toLastStep&&(h.toLastStep._active=a>0,$(h.toLastStep.__li).css("display",h.toLastStep._active?"block":"none")),h.complete&&(h.complete._active=a>2,$(h.complete.__li).css("display",h.complete._active?"block":"none")),h.deleteAll&&(h.deleteAll._active=a>0,$(h.deleteAll.__li).css("display",h.deleteAll._active?"block":"none"))}else h&&($(h.toLastStep.__li).css("display","none"),$(h.complete.__li).css("display","none"),$(h.deleteAll.__li).css("display","none"))},requestToLastStep:function(){h.toLastStep&&h.toLastStep._active&&i.toLastStep()},completeEdit:function(){p._editModeOff()},clearEditingObject:function(){i&&h.deleteAll&&h.deleteAll._active&&confirm("確定要刪除這個形狀嗎？")&&(i.clear(),p._editModeOff(!0))},clearAll:function(){var a,b;for(a in m)b=m[a],b.dispose();m={},n=[],p.completeEdit()},getExportData:function(){var a,b,c=[];for(a in m)b=m[a].getExportData(),b&&c.push(b.data);return{dataArray:c}},applyImportData:function(a){p.clearAll(),a||(a=[]),l=0;var b,c,d;for(b=0;b<a.length;b++){d=a[b];var f,g,h,i=d.serial,j=d.vertices,k=d.uvs,n=j.length/3,o=m[i]=new ShapeObject(i,e,d.renderingOrder,d.name);for(c=0;c<n;c++)h=3*c,f=new BABYLON.Vector3(j[h],j[h+1],j[h+2]),h=2*c,g=new BABYLON.Vector2(k[h],k[h+1]),o.addPoint(f,g,!0);o.updateLine(),o.updateMesh(),o._mesh.isPickable=!0,l=Math.max(l,i)}l++}}}(),function(){function a(a,b,c,d){this._serial=a,this._name=d||"#"+this._serial,this._scene=b,this._renderingOrder=void 0===c?0:c,this._points=[],this._uvs=[],this._nodes=[],this._focusNode=ShapeEditor.focusNodeSample.createInstance("nodeInstance"),this._focusNode.setEnabled(!1)}window.ShapeObject=a,a.prototype={_scene:null,_serial:0,_name:null,_points:null,_uvs:null,_meshVertices:null,_meshUVs:null,_nodes:null,_lineMesh:null,_focusNode:null,_renderingOrder:0,updateRenderingOrder:function(){this._mesh&&(this._mesh.renderingGroupId=ShapeEditor.objectRenderingGroupId,this._mesh.alphaIndex=this._renderingOrder+ShapeEditor.objectDefaultRenderingOrder)},_isEnabled:!1,_mesh:null,toString:function(){return"ShapeObject #"+this._serial},getNumPoints:function(){return this._nodes.length},addPoint:function(a,b,c){if(this._nodes.length){var d=this._nodes[this._nodes.length-1];d.setEnabled(this._isEnabled)}var e=ShapeEditor.nodeSample.createInstance("nodeInstance");this._focusNode.position.x=e.position.x=a.x,this._focusNode.position.y=e.position.y=a.y,this._focusNode.position.z=e.position.z=a.z,e.parent=ShapeEditor.container,e.setEnabled(!1),e.isPickable=!1,this._points.push(a),this._uvs.push(b),this._nodes.push(e),this._focusNode.setEnabled(this._isEnabled),c||(this.updateLine(),this.updateMesh(),ShapeEditor.update())},toLastStep:function(){var a;this._points.length&&(this._points.pop(),this._uvs.pop(),a=this._nodes.pop(),a.dispose()),this._nodes.length?(a=this._nodes[this._nodes.length-1],this._focusNode.position.x=a.position.x,this._focusNode.position.y=a.position.y,this._focusNode.position.z=a.position.z,a.setEnabled(!1),ShapeEditor.update()):(this._focusNode.setEnabled(!1),ShapeEditor._editModeOff(!0)),this.updateLine(),this.updateMesh()},setEnabled:function(a){a!==this._isEnabled&&(this._isEnabled=a,this._updateHintNodes())},_updateHintNodes:function(){var a,b;if(this._isEnabled){if(this._nodes.length)for(a=0;a<this._nodes.length-1;a++)b=this._nodes[a],b.setEnabled(!0),this._focusNode.setEnabled(!0),this._lineMesh&&this._lineMesh.setEnabled(!0)}else{for(a=0;a<this._nodes.length;a++)b=this._nodes[a],b.setEnabled(!1),this._focusNode.setEnabled(!0);this._focusNode.setEnabled(!1),this._lineMesh&&this._lineMesh.setEnabled(!1)}},updateLine:function(){if(this._lineMesh&&(this._lineMesh.dispose(),this._lineMesh=null),this._nodes.length>=2){var a=this._lineMesh=BABYLON.MeshBuilder.CreateLines("shape line",{points:this._points,updateAble:!1},this._scene);a.renderingGroupId=ShapeEditor.editorRenderingGroupId,a.parent=ShapeEditor.container,a.setEnabled(this._isEnabled)}},updateMesh:function(){if(this.clearMesh(),this._points.length>=3){var a,b,c,d,e=1,f=0,g=1,h=0,i=[],j=[],k=[],l=[],m=10,n=.9999,o=[];for(a=0;a<this._points.length;a++)b=this._points[a],d=this._uvs[a],i.push(b.x*n,b.y*n,b.z*n),k.push(d.x,d.y),l.push(d.x*m*2,d.y*m),o.push(new BABYLON.Vector2(d.x,d.y)),e=Math.min(e,d.x),f=Math.max(f,d.x),g=Math.min(g,d.y),h=Math.max(h,d.y);if(this._meshVertices=i.concat([]),this._meshUVs=k.concat([]),Math.abs(f-e)>.8)for(a in o)d=o[a],d.x<.5&&(d.x+=1);var p=[o],q=new PNLTRI.Triangulator,r=q.triangulate_polygon(p);for(a=0;a<r.length;a++)c=r[a],j.push(c[0],c[1],c[2]);var s=new BABYLON.VertexData;s.positions=i,s.indices=j,s.uvs=k,s.uvs2=l;var t=new BABYLON.Mesh("shape",this._scene);t.position=BABYLON.Vector3.Zero(),t.material=MaterialLib.getMaterial("flashShape"),t.visibility=.99999,s.applyToMesh(t,!0),t._editSerial=this._serial,t.isPickable=!1,t.parent=ShapeEditor.container,this._mesh=t,this.updateRenderingOrder()}},clearMesh:function(){this._mesh&&(this._mesh.dispose(),this._mesh=null)},clear:function(){this._points=[],this._uvs=[],this._meshUVs=null,this._meshVertices=null;var a,b;for(a=0;a<this._nodes.length;a++)b=this._nodes[a],b.dispose();this._nodes=[],this._focusNode.setEnabled(!1),this._lineMesh&&(this._lineMesh.dispose(),this._lineMesh=null),this.clearMesh()},dispose:function(){this.clear()},getExportData:function(){return this._points.length<3?null:{data:{serial:this._serial,name:this._name,vertices:this._meshVertices,uvs:this._meshUVs,renderingOrder:this._renderingOrder}}}}}(),function(){function a(){h=Main.gui,i=h.addFolder("billboardEditorFolder"),f(m),$(i.domElement).css("display","none")}function b(){q=$("#billboard-image-input"),r=$("#billboard-light-image-input"),Tools.setupImageInput(q[0],function(a){k&&k.changeImage(a,!0,c)}),Tools.setupImageInput(r[0],function(a){k&&k.changeLightImage(a,!0,c)})}function c(){if(j){for(var a in j)j[a].remove();j=null}if(k){e(),j={name:i.add(t,"triggerChangeName").name("改變名稱"),offsetX:i.add(k,"_offsetX"),offsetY:i.add(k,"_offsetY"),radius:i.add(k,"_radius"),scale:i.add(k,"_scale"),renderingOrder:i.add(k,"_renderingOrder")};var b={"對準鏡頭 Y 軸":0,"對準鏡頭 中心":1};j.offsetX=j.offsetX.min(-2).max(3).step(.01).name("水平中心"),j.offsetX.onChange(function(){k._updateGeom.call(k)}),j.offsetY=j.offsetY.min(-2).max(3).step(.01).name("垂直中心"),j.offsetY.onChange(function(){k._updateGeom.call(k)}),j.radius=j.radius.min(0).max(n).step(.01).name("3D 深度"),j.radius.onChange(function(){k.updatePosition(),t.updateEditingObjectLabel()}),j.renderingOrder=j.renderingOrder.min(-10).max(10).step(1).name("圖層深度"),j.renderingOrder.onChange(function(){k.updateRenderingOrder()}),j.scale=j.scale.min(0).max(1).step(.001).name("縮放尺寸"),j.scale.onChange(function(){k._updateGeom.call(k)}),j.billboardMode=i.add(k,"_billboardMode",b).name("對準方式").onChange(function(){k.updateBillboardMode()}),j.changeImageButton=i.add(t,"triggerChangeImage").name("改變圖片"),j.emissiveColor=i.addColor(k,"_emissiveColor").name("自體發光顏色").onChange(function(){var a=k._emissiveColor;"string"==typeof a&&(k._emissiveColor=Tools.hexToRgb(a)),k.updateEmissiveColor.call(k)}),k._lightImageSrc?(j.changeLightImageButton=i.add(t,"triggerChangeLightImage").name("改變高光圖片"),j.deleteLightImageButton=i.add(t,"triggerDeleteLightImage").name("移除高光圖片")):j.changeLightImageButton=i.add(t,"triggerChangeLightImage").name("設定高光圖片");var c=LightEditor.getLightNames();c.unshift(null),j.changeLinkedLight=i.add(k,"_linkedLight",c).name("透明度關聯 Light").onChange(function(){k.updateVisibility.call(k)}),j.deleteButton=i.add(t,"deleteEditingObject").name("刪除 (Delete)"),j.completeButton=i.add(t,"completeEdit").name("完成 (SPACEBAR)"),i.open()}}function d(a){s&&(o++,p[o]=new BillboardObject(o,g,a,n),t.edit(o))}function e(){var a=k._targetPosition,b=parseInt(a.x),c=parseInt(a.y),d=parseInt(a.z);f("Billboard: "+k._name+" at ("+b+", "+c+", "+d+")")}function f(a){h.resetFolderLabel(i.name,a)}var g,h,i,j,k,l=!1,m="按住 Ctrl 點擊畫面新增 Billboard",n=200,o=0,p={},q=null,r=null,s=!1,t=window.BillboardEditor={objectDefaultRenderingOrder:100,objectRenderingGroupId:1,editorRenderingGroupId:3,container:null,nodeSample:null,focusNodeSample:null,sceneSize:200,getEditorObjectDic:function(){return p},setEditorRenderingGroupId:function(a){t.editorRenderingGroupId=a,t.nodeSample&&(t.nodeSample.renderingGroupId=a),t.focusNodeSample&&(t.focusNodeSample.renderingGroupId=a)},init:function(c,d,e){g=c,n=d,BillboardObject.sceneSize=n,this.container=new BABYLON.Mesh("shape container",g),this.container.isPickable=!1,this.nodeSample=Tools.createNodeSample(g,BABYLON.Color3.Blue()),this.focusNodeSample=Tools.createNodeSample(g,BABYLON.Color3.Red(),2),this.nodeSample.parent=this.container,this.nodeSample.renderingGroupId=this.editorRenderingGroupId,this.focusNodeSample.parent=this.container,this.focusNodeSample.renderingGroupId=this.editorRenderingGroupId,e||(b(),a(),KeyboardControl.add("BillboardEditor complete",KeyCodeDic.space,{onKeyUp:function(){l&&k&&t.completeEdit()}}).add("BillboardEditor delete",KeyCodeDic.delete,{onKeyDown:function(){s&&t.deleteEditingObject()}}))},setAllUnPickable:function(){for(var a in p)p[a]._mesh.isPickable=!1},getDicByName:function(){var a={};for(var b in p){var c=p[b];a[c._name]=c}return a},enable:function(){s||(s=!0,$(i.domElement).css("display","block"))},disable:function(){s&&(s=!1,$(i.domElement).css("display","none"),l&&k&&t.completeEdit())},createEmptyObject:d,edit:function(a){k&&k._serial==a||(p[a]&&this._changeEditTarget(p[a]),this._editModeOn())},moveTargetTo:function(a,b){k&&(k.updatePosition(a),t.updateEditingObjectLabel())},_changeEditTarget:function(a){k!=a&&(k&&k.setEnabled(!1),k=a,k.setEnabled(!0),c())},_editModeOn:function(){l||(l=!0)},_editModeOff:function(){l&&(l=!1,f(m))},triggerChangeName:function(){if(k){var a=prompt("請輸入新的名稱",k._name);if(null!==a&&""!==a){var b=!1;for(var c in p){var d=p[c];if(d._name===a){alert("這個名稱已經被使用了"),b=!0;break}}b||(k._name=a,e())}}},triggerChangeImage:function(){q[0].value=null,q[0].click()},triggerChangeLightImage:function(){r[0].value=null,r[0].click()},triggerDeleteLightImage:function(){k&&k.removeLightImage(),c()},changeLinkedLight:function(){if(k){var a=prompt("請輸入 Light 物件的名稱");null!==a&&""!==a?k._linkedLight=a:k._linkedLight=null,this.updateAllVisibility(),c()}},updateAllVisibility:function(){for(var a in p)p[a].updateVisibility()},deleteEditingObject:function(){k&&confirm("確定要刪除這個 Billboard 嗎？")&&(delete p[k._serial],k.dispose(),k=null,t.completeEdit())},completeEdit:function(){k&&(k.setEnabled(!1),k=null),c(),t._editModeOff()},updateEditingObjectLabel:e,clearAll:function(){var a,b;for(a in p)b=p[a],b.dispose();p={},t.completeEdit()},getExportData:function(){var a,b,c=[],d=[],e=[];for(a in p){var f=p[a];f._imageSrc&&(b=f.getExportData(),c.push(b.data),d.push(b.image),b.lightImage&&e.push(b.lightImage))}return{dataArray:c,imageArray:d,lightImageArray:e}},applyImportData:function(a,b,c,d){function e(){j++,c&&c.call(null,j,i),j>=i&&d&&d.call()}t.clearAll(),a||(a=[]),o=0;var f,h,i=a.length,j=0;for(f=0;f<a.length;f++){h=a[f];var k=p[h.serial]=BillboardObject.CreateFromData(g,b,h,e);o=Math.max(o,k._serial)}o++}}}(),function(){function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=this;"string"==typeof p&&(p=Tools.hexToRgb(p)),this._scene=c,this._serial=b,this._name=n||"#"+this._serial,this._emissiveColor=p||{r:128,g:128,b:128},this._linkedLight=o||null,this._scale=f||1,void 0===i&&(i=.5),void 0===j&&(j=.5),this._offsetX=i,this._offsetY=j,this._renderingOrder=void 0===k?0:k,e=e||a.sceneSize;var t=s._mesh=new BABYLON.MeshBuilder.CreatePlane("billboard",{width:16,height:16,updatable:!0},c);t.parent=BillboardEditor.container,t.visibility=.3,s.updateRenderingOrder(),t._editSerial=this._serial;var u=s._material=new BABYLON.StandardMaterial("material1",c);u.specularColor=BABYLON.Color3.Black(),u.backFaceCulling=!1,t.material=u,this._centerNode=BillboardEditor.nodeSample.createInstance("centerNode"),this._targetNode=BillboardEditor.focusNodeSample.createInstance("billboardTargetNode"),this._centerNode.isPickable=!1,this._targetNode._editSerial=this._serial,s.updatePosition(d,e),s.updateEmissiveColor(),this._targetNode.actionManager=new BABYLON.ActionManager(c),this._targetNode.actionManager.registerAction(new BABYLON.Action(BABYLON.ActionManager.OnPointerOverTrigger)),g&&s.changeImage(g,h,q),l&&s.changeLightImage(l,m,r)}var b=.2;window.BillboardObject=a,a.CreateFromData=function(b,c,d,e){function f(){r--,r<=0&&e&&e.call()}var g,h,i,j,k,l="string"==typeof c,m=d.serial,n=d.imageDataHead,o=!l;o?(g=DataManager.BILLBOARD_FOLDER_PATH+d.image,h=n+c[g]):h=c+d.image,d.lightImage&&(o?(i=DataManager.BILLBOARD_FOLDER_PATH+d.lightImage,j=d.lightImageDataHead,k=j+c[i]):k=c+d.lightImage);var p,q,r=0;return e&&(h&&(r++,p=f),k&&(r++,q=f),0===r&&e.call()),new a(m,b,new BABYLON.Vector3(d.targetX,d.targetY,d.targetZ),d.radius,d.scale,h,o,d.offsetX,d.offsetY,d.renderingOrder,k,o,d.name,d.linkedLight,d.emissiveColor,p,q)},a.sceneSize=200,a.prototype={_scene:null,_serial:0,_name:null,_mesh:null,_imageSrc:null,_imageIsDataUrl:!1,_texture:null,_lightImageSrc:null,_lightImageIsDataUrl:!1,_lightTexture:null,_material:null,_scale:1,_imageWidth:0,_imageHeight:0,_linkedLight:null,_emissiveLight:.5,_renderingOrder:0,updateRenderingOrder:function(){this._mesh.renderingGroupId=BillboardEditor.objectRenderingGroupId,this._mesh.alphaIndex=this._renderingOrder+BillboardEditor.objectDefaultRenderingOrder},_offsetX:.5,_offsetY:.5,_billboardMode:0,_isEnabled:!1,_targetNode:null,_centerNode:null,_lineMesh:null,_radius:0,_targetVector:null,_targetPosition:null,_centerPosition:null,_emissiveColor:{r:128,g:128,b:128},_isDisposed:!1,setEnabled:function(a){a!==this._isEnabled&&(this._isEnabled=a,this._updateEnabled())},_updateEnabled:function(){this._isEnabled?(this._mesh.showBoundingBox=!0,this._mesh.isPickable=!1,this._lineMesh.setEnabled(!0),this._targetNode.setEnabled(!0),this._centerNode.setEnabled(!0),this._targetNode.isPickable=!0):(this._mesh.showBoundingBox=!1,this._mesh.isPickable=!0,this._lineMesh.setEnabled(!1),this._targetNode.setEnabled(!1),this._centerNode.setEnabled(!1),this._targetNode.isPickable=!1)},changeLightImage:function(a,b,c){function d(){e._isDisposed||(e._lightTexture=f,e._material.specularTexture=f,c&&c.call())}var e=this;this._lightTexture&&(this._lightTexture.dispose(),this._lightTexture=null),this._lightImageSrc=a,this._lightImageIsDataUrl=Boolean(b);var f;f=b?new BABYLON.Texture("data:billboard-light-"+e._serial+"-"+(new Date).getTime(),e._scene,!1,!0,null,d,null,a,!0):new BABYLON.Texture(a,e._scene,!1,!0,null,d)},removeLightImage:function(){this._lightImageSrc=null,this._lightTexture&&(this._material.specularTexture=null,this._lightTexture.dispose(),this._lightTexture=null)},changeImage:function(a,b,c){function d(){if(!e._isDisposed){var a=f.getBaseSize();e._imageWidth=a.width,e._imageHeight=a.height,e._material.opacityTexture=f,e._material.diffuseTexture=f,e._updateGeom(),e.updateVisibility(),c&&c.call()}}var e=this;e._mesh.visibility=.3,this._texture&&(this._texture.dispose(),this._texture=null),this._imageSrc=a,this._imageIsDataUrl=Boolean(b);var f;f=b?e._texture=new BABYLON.Texture("data:billboard-"+e._serial+"-"+(new Date).getTime(),e._scene,!1,!0,null,d,null,a,!0):e._texture=new BABYLON.Texture(a,e._scene,!1,!0,null,d)},updateEmissiveColor:function(){var a=this._emissiveColor;this._material&&(this._material.emissiveColor=new BABYLON.Color3(a.r/255,a.g/255,a.b/255))},updateVisibility:function(){var a=1;if(this._linkedLight){var b=LightEditor.find(this._linkedLight);b&&(a=b._intensity)}a>=1&&(a=.99999),this._mesh&&(this._mesh.visibility=a)},updatePosition:function(b,c){c=c||this._radius,b=b||this._targetVector,this._targetVector=b,this._radius=c;var d=b.normalize();this._targetPosition=d.scale(a.sceneSize),this._centerPosition=d.scale(this._radius),this._mesh.position.x=this._centerNode.position.x=this._centerPosition.x,this._mesh.position.y=this._centerNode.position.y=this._centerPosition.y,this._mesh.position.z=this._centerNode.position.z=this._centerPosition.z,this._targetNode.position.x=this._targetPosition.x,this._targetNode.position.y=this._targetPosition.y,this._targetNode.position.z=this._targetPosition.z,this.updateLine(),this._updateEnabled(),this.updateBillboardMode()},updateBillboardMode:function(){0==this._billboardMode?this._mesh.billboardMode=BABYLON.Mesh.BILLBOARDMODE_Y:1==this._billboardMode&&(this._mesh.billboardMode=BABYLON.Mesh.BILLBOARDMODE_ALL)},updateLine:function(){this._lineMesh&&(this._lineMesh.dispose(),this._lineMesh=null);var a=[BABYLON.Vector3.Zero(),this._targetPosition],b=this._lineMesh=BABYLON.MeshBuilder.CreateDashedLines("shape line",{points:a,updateAble:!1},this._scene);b.renderingGroupId=BillboardEditor.editorRenderingGroupId,b.parent=BillboardEditor.container,b.isPickable=!1,b.alpha=.46},_updateGeom:function(){var a=this,c=a._mesh.getVerticesData(BABYLON.VertexBuffer.PositionKind),d=a._imageWidth*a._scale*b,e=a._imageHeight*a._scale*b,f=-d*a._offsetX,g=d*(1-a._offsetX),h=-e*a._offsetY,i=e*(1-a._offsetY);c[0]=f,c[1]=h,c[3]=g,c[4]=h,c[6]=g,c[7]=i,c[9]=f,c[10]=i,a._mesh.updateVerticesData(BABYLON.VertexBuffer.PositionKind,c,!0)},dispose:function(){this._centerNode&&this._centerNode.dispose(),this._targetNode&&this._targetNode.dispose(),this._mesh&&this._mesh.dispose(),this._lineMesh&&this._lineMesh.dispose(),this._texture&&this._texture.dispose(),this._material&&this._material.dispose(),this._isDisposed=!0},getExportData:function(){var a="billboard."+this._serial+".png",b=ImageObject.HandleImageSrc(this._imageSrc,this._imageIsDataUrl);"string"==typeof this._emissiveColor&&(this._emissiveColor=Tools.hexToRgb(this._emissiveColor));var c={data:{serial:this._serial,name:this._name,linkedLight:this._linkedLight,emissiveColor:this._emissiveColor,offsetX:this._offsetX,offsetY:this._offsetY,radius:this._radius,scale:this._scale,targetX:this._targetPosition.x,targetY:this._targetPosition.y,targetZ:this._targetPosition.z,image:a,imageDataHead:b.imageHead,renderingOrder:this._renderingOrder},image:new ImageObject(a,DataManager.BILLBOARD_FOLDER_PATH,b.imageSrc,this._imageIsDataUrl,b.imageHead)};return this._lightImageSrc&&(a="billboard.lightmap."+this._serial+".png",b=ImageObject.HandleImageSrc(this._lightImageSrc,this._lightImageIsDataUrl),c.data.lightImage=a,c.data.lightImageDataHead=b.imageHead,c.lightImage=new ImageObject(a,DataManager.BILLBOARD_FOLDER_PATH,b.imageSrc,this._lightImageIsDataUrl,b.imageHead)),c}}}(),function(){function a(){f=Main.gui,g=f.addFolder("lightEditorFolder"),c(m),$(g.domElement).css("display","none")}function b(){if(h){for(var a in h)h[a].remove();h=null}if(e){c("Light: "+e._name),h={name:g.add(n,"triggerChangeName").name("改變名稱"),x:g.add(e,"_x"),y:g.add(e,"_y"),z:g.add(e,"_z"),intensity:g.add(e,"_intensity"),range:g.add(e,"_range")};var b=200;h.x=h.x.min(-b).max(b).step(1).name("X"),h.x.onChange(function(){e.update.call(e)}),h.y=h.y.min(-b).max(b).step(1).name("Y"),h.y.onChange(function(){e.update.call(e)}),h.z=h.z.min(-b).max(b).step(1).name("Z"),h.z.onChange(function(){e.update.call(e)}),h.intensity=h.intensity.min(0).max(1).step(.01).name("亮度"),h.intensity.onChange(function(){e.update.call(e),BillboardEditor.updateAllVisibility()}),h.specularColor=g.addColor(e,"_specularColor").name("顏色").onChange(function(){var a=e._specularColor;"string"==typeof a&&(e._specularColor=Tools.hexToRgb(a)),e.updateSpecularColor.call(e)}),h.range=h.range.min(10).max(1e3).step(1).name("範圍"),h.range.onChange(function(){e.update.call(e)}),h.deleteButton=g.add(n,"deleteEditingObject").name("刪除 (Delete)"),h.completeButton=g.add(n,"completeEdit").name("完成 (SPACEBAR)"),g.open()}}function c(a){f.resetFolderLabel(g.name,a)}var d,e,f,g,h,i=0,j=!1,k=!1,l={},m="按住 Ctrl 點擊畫面新增 Light",n=window.LightEditor={lightNodeSample:null,container:null,nodeContainer:null,nodeEdit:!1,getEditorObjectDic:function(){return l},getDicByName:function(){var a={};for(var b in l){var c=l[b];a[c._name]=c}return a},init:function(b,c){d=b,this.container=new BABYLON.Mesh("light container",d),this.container.isPickable=!1,this.nodeContainer=new BABYLON.Mesh("light node container",d),this.nodeContainer.setEnabled(!1),this.lightNodeSample=Tools.createNodeSample(b,new BABYLON.Color3.Yellow,5,null,"sphere"),this.lightNodeSample.renderingGroupId=3,this.nodeEdit=c,c||(a(),KeyboardControl.add("LightEditor complete",KeyCodeDic.space,{onKeyUp:function(){k&&e&&n.completeEdit()}}).add("LightEditor delete",KeyCodeDic.delete,{onKeyDown:function(){j&&n.deleteEditingObject()}}))},enable:function(){j||(j=!0,$(g.domElement).css("display","block"))},disable:function(){j&&(j=!1,$(g.domElement).css("display","none"),k&&e&&n.completeEdit())},edit:function(a){e&&e._serial==a||(l[a]&&this._changeEditTarget(l[a]),this._editModeOn())},getLightNames:function(){var a,b=[];for(a in l)b.push(l[a]._name);return b},find:function(a){for(var b in l)if(l[b]._name==a)return l[b];return null},createLight:function(a,b){i++,l[i]=new LightObject(d,i,a.x,a.y,a.z),b&&n.edit(i)},_changeEditTarget:function(a){e!=a&&(e&&e.setEnabled(!1),e=a,e.setEnabled(!0),b())},_editModeOn:function(){k||(k=!0)},_editModeOff:function(){k&&(k=!1,c(m))},deleteEditingObject:function(){e&&confirm("確定要刪除這個 Light 嗎？")&&(delete l[e._serial],e.dispose(),e=null,n.completeEdit())},completeEdit:function(){e&&(e.setEnabled(!1),e=null),b(),n._editModeOff()},triggerChangeName:function(){if(e){var a=prompt("請輸入新的名稱",e._name);if(null!==a&&""!==a){var b=!1;for(var d in l){var f=l[d];if(f._name===a){alert("這個名稱已經被使用了"),b=!0;break}}b||(e._name=a,c("Light: "+e._name))}}},clearAll:function(){var a,b;for(a in l)b=l[a],b.dispose();l={},n.completeEdit()},getExportData:function(){var a,b,c=[];for(a in l)b=l[a].getExportData(),b&&c.push(b.data);return{dataArray:c}},applyImportData:function(a){n.clearAll(),a||(a=[]),i=0;var b,c;for(b=0;b<a.length;b++){c=a[b];var e=l[c.serial]=LightObject.CreateFromData(d,c);i=Math.max(i,parseInt(e._serial))}i++}}}(),function(){function a(a,b,c,d,e,f,g,h,i){if(this._scene=a,this._serial=b,this._name=h||"#"+this._serial,"string"==typeof i&&(i=Tools.hexToRgb(i)),i&&(this._specularColor=i),this._x=c,this._y=d,this._z=e,this._range=f||200,this._intensity=g||1,!LightEditor.nodeEdit){var j=this._nodeMesh=LightEditor.lightNodeSample.clone();j.isPickable=!0,j.parent=LightEditor.nodeContainer,j._editSerial=this._serial,j.setEnabled(!0),j.name="lightNode"}var k=this._light=new BABYLON.PointLight("pointlight",BABYLON.Vector3.Zero(),a);k.range=this._range,this.updateSpecularColor(),this.update()}window.LightObject=a,a.CreateFromData=function(b,c){return new a(b,c.serial,c.x,c.y,c.z,c.range,c.intensity,c.name,c.specularColor)},a.prototype={_scene:null,_serial:null,_name:null,_enabled:!1,_x:0,_y:0,_z:0,_range:0,_intensity:1,_specularColor:{r:255,g:255,b:255},_nodeMesh:null,_light:null,update:function(){this._nodeMesh?(this._nodeMesh.position.x=this._light.position.x=this._x,this._nodeMesh.position.y=this._light.position.y=this._y,this._nodeMesh.position.z=this._light.position.z=this._z):(this._light.position.x=this._x,this._light.position.y=this._y,this._light.position.z=this._z),this._light.range=this._range,this._light.intensity=this._intensity},setEnabled:function(a){this._enabled=a},updateSpecularColor:function(){var a=this._specularColor;this._light&&(this._light.specular=this._light.diffuse=new BABYLON.Color3(a.r/255,a.g/255,a.b/255))},dispose:function(){this._nodeMesh&&this._nodeMesh.dispose(),this._light&&this._light.dispose()},getExportData:function(){return"string"==typeof this._specularColor&&(this._specularColor=Tools.hexToRgb(this._specularColor)),{data:{name:this._name,serial:this._serial,x:this._x,y:this._y,z:this._z,specularColor:this._specularColor,range:this._range,intensity:this._intensity}}}}}(),function(){window.Tools={setupImageInput:function(a,b,c){function d(a){if(a.files&&a.files[0]){var d=new FileReader;d.onload=function(){c?e(d.result):(Loading.hide(),b&&b.call(null,d.result))},d.readAsDataURL(a.files[0])}}function e(a){var c=document.createElement("img");c.onload=function(){Loading.hide(),b&&b.call(null,c)},c.src=a}$(a).on("change",function(){Loading.progress("empty").show(),d(a)})},createNodeSample:function(a,b,c,d,e){b=b||BABYLON.Color3.Blue(),c=c||1;var f,g;return f="sphere"==e?new BABYLON.Mesh.CreateSphere("wire sphere",4,c,a):BABYLON.Mesh.CreateBox(d||"nodeSample",c,a),g=new BABYLON.StandardMaterial("boxmat",a),f.isPickable=!1,g.emissiveColor=b,f.material=g,f.setEnabled(!1),f},hexToRgb:function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null},generateSkyboxTexture:function(){function a(a,b,c,e,f){var g,h=b.createImageData(d,d),i=a[f],j=h.data,k=0;for(g=0;g<j.length;g+=4)j[g]=i[k],j[g+1]=i[k+1],j[g+2]=i[k+2],j[g+3]=255,k+=3;b.putImageData(h,c*d,e*d)}var b=document.createElement("canvas"),c=b.getContext("2d"),d=200;b.width=6*d,b.height=3*d,b.className="test-canvas",$(b).css("width",b.width).css("height",b.height);var e=document.createElement("img");e.src="images/01.jpg",e.onload=function(){c.drawImage(e,0,0,e.width,e.height,0,0,b.width,b.height);var f,g=c.getImageData(0,0,b.width,b.height),h=g.data,i=new Float32Array(g.width*g.height*3),j=0;for(f=0;f<h.length;f+=4)i[j]=h[f],i[j+1]=h[f+1],i[j+2]=h[f+2],j+=3;var k=BABYLON.Internals.PanoramaToCubeMapTools.ConvertPanoramaToCubemap(i,b.width,b.height,d),l=document.createElement("canvas"),m=l.getContext("2d");l.width=4*d,l.height=3*d,l.className="test-canvas",document.body.appendChild(l),$(l).css("width",l.width).css("height",l.height),a(k,m,0,1,"left"),a(k,m,1,1,"front"),a(k,m,2,1,"right"),a(k,m,3,1,"back"),a(k,m,1,0,"up"),a(k,m,1,2,"down")}}}}();var saveAs=saveAs||function(a){"use strict";if(!("undefined"==typeof a||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e="download"in d,f=function(a){var b=new MouseEvent("click");a.dispatchEvent(b)},g=/constructor/i.test(a.HTMLElement),h=/CriOS\/[\d]+/.test(navigator.userAgent),i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=4e4,l=function(a){var b=function(){"string"==typeof a?c().revokeObjectURL(a):a.remove()};setTimeout(b,k)},m=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(a){i(a)}}},n=function(a){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob([String.fromCharCode(65279),a],{type:a.type}):a},o=function(b,i,k){k||(b=n(b));var o,p=this,q=b.type,r=q===j,s=function(){m(p,"writestart progress write writeend".split(" "))},t=function(){if((h||r&&g)&&a.FileReader){var d=new FileReader;return d.onloadend=function(){var b=h?d.result:d.result.replace(/^data:[^;]*;/,"data:attachment/file;"),c=a.open(b,"_blank");c||(a.location.href=b),b=void 0,p.readyState=p.DONE,s()},d.readAsDataURL(b),void(p.readyState=p.INIT)}if(o||(o=c().createObjectURL(b)),r)a.location.href=o;else{
var e=a.open(o,"_blank");e||(a.location.href=o)}p.readyState=p.DONE,s(),l(o)};return p.readyState=p.INIT,e?(o=c().createObjectURL(b),void setTimeout(function(){d.href=o,d.download=i,f(d),s(),l(o),p.readyState=p.DONE})):void t()},p=o.prototype,q=function(a,b,c){return new o(a,b||a.name||"download",c)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(a,b,c){return b=b||a.name||"download",c||(a=n(a)),navigator.msSaveOrOpenBlob(a,b)}:(p.abort=function(){},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,q)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define([],function(){return saveAs});var PNLTRI={REVISION:"2.1.1"};PNLTRI.Math={random:Math.random,array_shuffle:function(a){for(var b=a.length-1;b>0;b--){var c=Math.floor(PNLTRI.Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a},compare_pts_yx:function(a,b){var c=a.y-b.y;if(c<PNLTRI.Math.EPSILON_N)return-1;if(c>PNLTRI.Math.EPSILON_P)return 1;var d=a.x-b.x;return d<PNLTRI.Math.EPSILON_N?-1:d>PNLTRI.Math.EPSILON_P?1:0},ptsCrossProd:function(a,b,c){return(b.x-a.x)*(c.y-a.y)-(b.y-a.y)*(c.x-a.x)}},PNLTRI.Math.EPSILON_P=Math.pow(2,-43),PNLTRI.Math.EPSILON_N=-PNLTRI.Math.EPSILON_P,PNLTRI.PolygonData=function(a){if(this.vertices=[],this.segments=[],this.diagonals=[],this.idNextPolyChain=0,this.PolyLeftArr=[],this.monoSubPolyChains=[],this.triangles=[],a)for(var b=0,c=a.length;b<c;b++)this.addPolygonChain(a[b])},PNLTRI.PolygonData.prototype={constructor:PNLTRI.PolygonData,nbVertices:function(){return this.vertices.length},getSegments:function(){return this.segments},getFirstSegment:function(){return this.segments[0]},getMonoSubPolys:function(){return this.monoSubPolyChains},getTriangles:function(){return this.triangles.concat()},nbPolyChains:function(){return this.idNextPolyChain},get_PolyLeftArr:function(){return this.PolyLeftArr.concat()},set_PolyLeft_wrong:function(a){this.PolyLeftArr[a]=!1},isClockWise:function(a){var b=a,c=0;do c+=(b.vFrom.x-b.vTo.x)*(b.vFrom.y+b.vTo.y),b=b.snext;while(b!=a);return c<0},appendVertexEntry:function(a,b){var c={id:this.vertices.length,x:a,y:b};return this.vertices.push(c),c},createSegmentEntry:function(a,b){return{chainId:this.idNextPolyChain,vFrom:a,vTo:b,upward:1==PNLTRI.Math.compare_pts_yx(b,a),sprev:null,snext:null,rootFrom:null,rootTo:null,is_inserted:!1,trLeft:null,trRight:null,mprev:null,mnext:null,marked:!1}},appendSegmentEntry:function(a){return this.segments.push(a),a},appendDiagonalsEntry:function(a){return this.diagonals.push(a),a},addVertexChain:function(a){function b(a,b){return Math.abs(a.x-b.x)<PNLTRI.Math.EPSILON_P&&Math.abs(a.y-b.y)<PNLTRI.Math.EPSILON_P}function c(a,b,c){if(Math.abs(PNLTRI.Math.ptsCrossProd(b,a,c))>PNLTRI.Math.EPSILON_P)return!1;var d,e,f;return Math.abs(a.y-b.y)<PNLTRI.Math.EPSILON_P?(e=b.x,a.x<c.x?(d=a.x,f=c.x):(d=c.x,f=a.x)):(e=b.y,a.y<c.y?(d=a.y,f=c.y):(d=c.y,f=a.y)),d-e<PNLTRI.Math.EPSILON_P&&e-f<PNLTRI.Math.EPSILON_P}for(var d,e,f,g=[],h=0;h<a.length;h++)d=this.appendVertexEntry(a[h].x,a[h].y),e=!0,f=g.length-1,f>=0&&(b(d,g[f])?e=!1:f>0&&c(g[f-1],g[f],d)&&g.pop()),e&&g.push(d);return f=g.length-1,f>0&&b(g[f],g[0])&&(g.pop(),f--),f>1&&(c(g[f-1],g[f],g[0])&&(g.pop(),f--),f>1&&c(g[f],g[0],g[1])&&g.shift()),g},addPolygonChain:function(a){var b=this.addVertexChain(a);if(b.length<3)return console.log("Polygon has < 3 vertices!",b),0;for(var c,d,e,f=this.segments.length,g=0;g<b.length-1;g++)c=this.createSegmentEntry(b[g],b[g+1]),e?(c.sprev=e,e.snext=c):d=c,e=c,this.appendSegmentEntry(c);return c=this.createSegmentEntry(b[b.length-1],b[0]),c.sprev=e,e.snext=c,this.appendSegmentEntry(c),d.sprev=c,c.snext=d,this.PolyLeftArr[this.idNextPolyChain++]=!0,this.segments.length-f},create_mono_chains:function(){for(var a,b,c,d,e=0,f=this.segments.length;e<f;e++)a=this.segments[e],this.PolyLeftArr[a.chainId]?(b=a.vTo,a.mprev=a.sprev,a.mnext=a.snext):(b=a.vFrom,a=a.snext,a.mprev=a.snext,a.mnext=a.sprev),(d=a.vFrom.lastInDiag)&&(d.mnext=a,a.mprev=d,a.vFrom.lastInDiag=null),(c=b.firstOutDiag)&&(c.mprev=a,a.mnext=c,b.firstOutDiag=null)},unique_monotone_chains_max:function(){function a(a){var b,c,d,e=a;for(c=d=a.vFrom,a.marked=!0,a=a.mnext;b=a.vFrom;){if(a.marked){if(b==c)break;return console.log("ERR unique_monotone: segment in two chains",c,a),null}a.marked=!0,1==PNLTRI.Math.compare_pts_yx(b,d)&&(d=b,e=a),a=a.mnext}return e}var b,c;this.monoSubPolyChains=[];for(var d=0,e=this.segments.length;d<e;d++)b=this.segments[d],b.marked||(c=a(b),c&&this.monoSubPolyChains.push(c));return this.monoSubPolyChains},clearTriangles:function(){this.triangles=[]},addTriangle:function(a,b,c){this.triangles.push([a.id,b.id,c.id])}},PNLTRI.EarClipTriangulator=function(a){this.polyData=a},PNLTRI.EarClipTriangulator.prototype={constructor:PNLTRI.EarClipTriangulator,triangulate_polygon_no_holes:function(){function a(a){var b=a.mprev.vFrom.x,c=a.mprev.vFrom.y,d=a.vFrom.x,e=a.vFrom.y,f=a.mnext.vFrom.x,g=a.mnext.vFrom.y,h=f-d,i=g-e,j=b-f,k=c-g,l=d-b,m=e-c;if(PNLTRI.Math.EPSILON_P>l*i-h*m)return!1;for(var n=a.mprev.mprev,o=a.mnext;o!=n;){o=o.mnext;var p=o.vFrom.x,q=o.vFrom.y,r=p-b,s=q-c;if(0!==r||0!==s){var t=p-d,u=q-e;if(0!==t||0!==u){var v=p-f,w=q-g;if((0!==v||0!==w)&&h*u-i*t>=PNLTRI.Math.EPSILON_N&&l*s-m*r>=PNLTRI.Math.EPSILON_N&&j*w-k*v>=PNLTRI.Math.EPSILON_N)return!1}}}return!0}var b=this.polyData,c=b.getFirstSegment(),d=c;if(b.isClockWise(c)){do d.mprev=d.snext,d.mnext=d.sprev,d=d.sprev;while(d!=c);b.set_PolyLeft_wrong(0)}else do d.mprev=d.sprev,d.mnext=d.snext,d=d.snext;while(d!=c);for(var e=c,f=e;e.mnext!=e.mprev;)if(a(e))this.polyData.addTriangle(e.mprev.vFrom,e.vFrom,e.mnext.vFrom),e.mprev.mnext=e.mnext,e.mnext.mprev=e.mprev,e=e.mnext,f=e;else if(e=e.mnext,e==f)return!1;return!0}},PNLTRI.Trapezoid=function(a,b,c,d){this.vHigh=a?a:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},this.vLow=b?b:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY},this.lseg=c,this.rseg=d,this.depth=-1,this.monoDone=!1},PNLTRI.Trapezoid.prototype={constructor:PNLTRI.Trapezoid,clone:function(){var a=new PNLTRI.Trapezoid(this.vHigh,this.vLow,this.lseg,this.rseg);return a.uL=this.uL,a.uR=this.uR,a.dL=this.dL,a.dR=this.dR,a.sink=this.sink,a},splitOffLower:function(a){var b=this.clone();return this.vLow=b.vHigh=a,this.dL=b,b.uL=this,this.dR=b.uR=null,b.dL&&(b.dL.uL=b),b.dR&&(b.dR.uR=b),b}},PNLTRI.QsNode=function(a){this.trap=a,a.sink=this},PNLTRI.QsNode.prototype={constructor:PNLTRI.QsNode},PNLTRI.QueryStructure=function(a){var b=new PNLTRI.Trapezoid(null,null,null,null);if(this.trapArray=[],this.appendTrapEntry(b),this.root=new PNLTRI.QsNode(b),a)for(var c=a.getSegments(),d=0;d<c.length;d++)c[d].rootFrom=c[d].rootTo=this.root,c[d].is_inserted=!1},PNLTRI.QueryStructure.prototype={constructor:PNLTRI.QueryStructure,getRoot:function(){return this.root},appendTrapEntry:function(a){a.trapID=this.trapArray.length,this.trapArray.push(a)},cloneTrap:function(a){var b=a.clone();return this.appendTrapEntry(b),b},splitNodeAtPoint:function(a,b,c){var d=a.trap;if(d.vHigh==b)return a;if(d.vLow==b)return a;var e=d.splitOffLower(b);return this.appendTrapEntry(e),a.yval=b,a.trap=null,a.right=new PNLTRI.QsNode(d),a.left=new PNLTRI.QsNode(e),c?d.sink:e.sink},fpEqual:function(a,b){return Math.abs(a-b)<PNLTRI.Math.EPSILON_P},is_left_of:function(a,b,c){var d,e=a.vFrom.x-b.x,f=a.vTo.x-b.x,g=this.fpEqual(a.vFrom.y,b.y);if(this.fpEqual(a.vTo.y,b.y)){if(g)return 0;d=f}else{if(!g)return a.upward?PNLTRI.Math.ptsCrossProd(a.vFrom,a.vTo,b):PNLTRI.Math.ptsCrossProd(a.vTo,a.vFrom,b);d=e}return Math.abs(d)<PNLTRI.Math.EPSILON_P?0:d},segNodes:function(a){this.ptNode(a,!0),this.ptNode(a,!1)},ptNode:function(a,b){var c,d,e;b?(c=a.vFrom,d=a.vTo,e=a.rootFrom):(c=a.vTo,d=a.vFrom,e=a.rootTo);for(var f,g;e;)if(e.yval)e=PNLTRI.Math.compare_pts_yx(c==e.yval?d:c,e.yval)==-1?e.left:e.right;else{if(!e.seg)return e.trap||console.log("ptNode: unknown type",e),b?a.rootFrom=e:a.rootTo=e,e;if(c==e.seg.vFrom||c==e.seg.vTo){if(this.fpEqual(c.y,d.y)){this.fpEqual(e.seg.vFrom.y,e.seg.vTo.y)?c==e.seg.vFrom?(g=a.upward?d.x>=e.seg.vTo.x:d.x<e.seg.vTo.x,e=(g?a.sprev.upward:e.seg.snext.upward)?e.right:e.left):(g=a.upward?d.x<e.seg.vFrom.x:d.x>=e.seg.vFrom.x,e=(g?a.snext.upward:e.seg.sprev.upward)?e.left:e.right):e=d.x<c.x?e.left:e.right;continue}f=this.is_left_of(e.seg,d,!1),0===f&&(c==e.seg.vFrom?(g=a.upward?d.y>=e.seg.vTo.y:d.y<e.seg.vTo.y,f=g?this.is_left_of(e.seg,a.sprev.vFrom,!1):-this.is_left_of(e.seg,e.seg.snext.vTo,!1)):(g=a.upward?d.y<e.seg.vFrom.y:d.y>=e.seg.vFrom.y,f=g?this.is_left_of(e.seg,a.snext.vTo,!1):-this.is_left_of(e.seg,e.seg.sprev.vFrom,!1)))}else if(f=this.is_left_of(e.seg,c,!0),0===f&&(f=this.is_left_of(e.seg,d,!1),0===f)){var h=b?a.sprev.vFrom:a.snext.vTo;f=this.is_left_of(e.seg,h,!1)}if(f>0)e=e.left;else{if(!(f<0))return e;e=e.right}}},add_segment:function(a){function b(){var a=u.uL||u.uR;a.dL&&a.dR?u==a.dL?(p.uL=null,a.dL=o):(o.uR=null,a.dR=p):(p.uL=null,p.uR=a,a.dR=p)}function c(){u.usave?(u.uleft?(p.uL=u.uR,p.uR=u.usave,p.uL.dL=p,p.uR.dR=p):(o.uR=u.uL,o.uL=u.usave,o.uL.dL=o,o.uR.dR=o),o.usave=p.usave=null):u.vHigh==n.vHigh?(p.uR.dR=p,o.uR=p.uL=null):p==u?(p.uL=p.uR,p.uR=null,p.uL.dL=p):(o.uR=o.uL,o.uL=null)}function d(a){u.vLow==t.vLow?(i?u.dL?(a.uL=o,o.dL=a,p.dR=null):(a.uR=p,o.dL=null,p.dR=a):(a.uL=o,a.uR=p,o.dL=p.dR=a),o.dR=p.dL=null):(a.uL&&a.uR&&(a.uL==u?(a.usave=a.uR,a.uleft=!0):(a.usave=a.uL,a.uleft=!1)),a.uL=o,a.uR=p,o.dR=p.dL=a,o.dL=p.dR=null)}function e(){var b;if(u.vLow==t.vLow&&i)u.dL.uL=o,u.dR.uR=p,o.dL=u.dL,p.dR=u.dR,o.dR=p.dL=null,b=null;else{u.dL.uL=o,u.dR.uR=p;var c,d=f.is_left_of(a,u.vLow,!0);if(d>0)c=!0;else if(d<0)c=!1;else{var e=u.dL.rseg,g=e.upward,h=g?e.vFrom:e.vTo;d=f.is_left_of(a,h,!1),d>0?c=!0:d<0?c=!1:(e=g?e.snext:e.sprev,h=g?e.vTo:e.vFrom,d=f.is_left_of(a,h,!1),c=d>0)}c?(b=u.dR,u.dR.uL=o,o.dL=u.dL,p.dR=null):(b=u.dL,u.dL.uR=p,p.dR=u.dR,o.dL=null),o.dR=p.dL=b}return b}var f=this;this.segNodes(a);var g,h,i,j,k,l;if(a.upward?(g=a.vFrom,j=a.vTo,h=a.rootFrom,k=a.rootTo,i=a.sprev.is_inserted,l=a.snext.is_inserted):(g=a.vTo,j=a.vFrom,h=a.rootTo,k=a.rootFrom,i=a.snext.is_inserted,l=a.sprev.is_inserted),!l){var m=this.splitNodeAtPoint(k,j,!1);k==h&&(h=m),k=m}var n=k.trap;if(!n.uL&&!n.uR)return void console.log("ERR add_segment: missing trFirst.uX: ",n);if(n.vHigh!=j)return void console.log("ERR add_segment: trFirstHigh != segHigh: ",n);i||(h=this.splitNodeAtPoint(h,g,!0));for(var o,p,q,r,s,t=h.trap,u=n,v=this.trapArray.length+2;u;){if(--v<0)return void console.log("ERR add_segment: infinite loop",u,a,this);if(!u.dL&&!u.dR)return void console.log("ERR add_segment: missing successors",u,a,this);var w=u.sink;w.seg=a,w.trap=null,r&&r.rseg==u.rseg?(o=u,p=r,p.vLow=u.vLow,w.left=new PNLTRI.QsNode(o),w.right=r.sink):q&&q.lseg==u.lseg?(p=u,o=q,o.vLow=u.vLow,w.left=q.sink,w.right=new PNLTRI.QsNode(p)):(o=u,p=this.cloneTrap(u),w.left=new PNLTRI.QsNode(o),w.right=new PNLTRI.QsNode(p)),u.uL&&u.uR?c():b(),u.dL&&u.dR?s=e():(s=u.dL?u.dL:u.dR,d(s)),o.rseg&&(o.rseg.trLeft=p),p.lseg&&(p.lseg.trRight=o),o.rseg=p.lseg=a,a.trLeft=o,a.trRight=p,u.vLow!=t.vLow?(q=o,r=p,u=s):u=null}a.is_inserted=!0},assignDepths:function(a){var b,c,d=[this.trapArray[0]],e=[],f=0;do{for(var g=f%2==1;b=d.pop();)b.depth==-1&&(b.depth=f,b.uL&&d.push(b.uL),b.uR&&d.push(b.uR),b.dL&&d.push(b.dL),b.dR&&d.push(b.dR),(c=b.lseg)&&c.trLeft.depth==-1&&e.push(c.trLeft),(c=b.rseg)&&(c.trRight.depth==-1&&e.push(c.trRight),c.upward!=g&&a.set_PolyLeft_wrong(c.chainId)));d=e,e=[],f++}while(d.length>0)},create_visibility_map:function(a){var b,c,d=0,e=1,f=2,g=3,h=4,i=5,j=6,k=7,l=a.nbVertices(),m=new Array(l);for(b=0;b<l;b++)m[b]=new Array(k+1);var n=new Array(l);for(b=0,c=this.trapArray.length;b<c;b++){var o=this.trapArray[b],p=o.uL?o.uR?i:k:o.uR?h:j,q=o.dL?o.dR?e:d:o.dR?g:f;if(o.depth%2==1){if(p==i||q==e||p==k&&q==g||p==h&&q==d){var r=a.appendDiagonalsEntry({vFrom:o.vLow,vTo:o.vHigh,mprev:null,mnext:null,marked:!1}),s=a.appendDiagonalsEntry({vFrom:o.vHigh,vTo:o.vLow,revDiag:r,mprev:null,mnext:null,marked:!1});r.revDiag=s,m[o.vLow.id][q]=r,m[o.vHigh.id][p]=s}}else null!==o.vHigh.id&&(n[o.vHigh.id]=p),null!==o.vLow.id&&(n[o.vLow.id]=q)}var t,u,v,w,x;for(b=0;b<l;b++)if(u=m[b],v=n[b],null!=v){c=v,x=null;do c++>k&&(c=d),(t=u[c])&&(x?(t.mprev=x,x.mnext=t):(w=t.vFrom,w.firstOutDiag=t),x=t.revDiag);while(c!=v);x&&(w.lastInDiag=x)}}},PNLTRI.Trapezoider=function(a){this.polyData=a,this.queryStructure=new PNLTRI.QueryStructure(this.polyData)},PNLTRI.Trapezoider.prototype={constructor:PNLTRI.Trapezoider,optimise_randomlist:function(a){var b=0,c=this.polyData.nbPolyChains();if(1!=c)for(var d=new Array(c),e=a.concat(),f=0;f<e.length;f++){var g=e[f].chainId;d[g]?a[c++]=e[f]:(a[b++]=e[f],d[g]=!0)}},trapezoide_polygon:function(){var a=this.polyData.getSegments().concat();PNLTRI.Math.array_shuffle(a),this.optimise_randomlist(a);for(var b,c=a.length,d=this.queryStructure,e=0,f=c;e<c;){f=Math.log(f)/Math.LN2;for(var g=f>1?Math.floor(c/f):c;e<g;e++)d.add_segment(a[e]);for(b=e;b<c;b++)this.queryStructure.segNodes(a[b])}for(d.assignDepths(this.polyData),b=0;b<c;b++)a[b].trLeft=a[b].trRight=null},create_visibility_map:function(){return this.queryStructure.create_visibility_map(this.polyData)}},PNLTRI.MonoSplitter=function(a){this.polyData=a,this.trapezoider=null},PNLTRI.MonoSplitter.prototype={constructor:PNLTRI.MonoSplitter,monotonate_trapezoids:function(){this.trapezoider=new PNLTRI.Trapezoider(this.polyData),this.trapezoider.trapezoide_polygon(),this.trapezoider.create_visibility_map(),this.polyData.create_mono_chains(),this.polyData.unique_monotone_chains_max()}},PNLTRI.MonoTriangulator=function(a){this.polyData=a},PNLTRI.MonoTriangulator.prototype={constructor:PNLTRI.MonoTriangulator,triangulate_all_polygons:function(){var a=this.polyData.getMonoSubPolys();this.polyData.clearTriangles();for(var b=0;b<a.length;b++){var c=a[b],d=c.mprev,e=c.mnext;e.mnext==d?this.polyData.addTriangle(c.vFrom,e.vFrom,d.vFrom):this.triangulate_monotone_polygon(c)}},triangulate_monotone_polygon:function(a){function b(){for(console.log("ERR uni-y-monotone: only concave angles left",f);g>1;)g--,c.polyData.addTriangle(f[g-1],f[g],f[g+1])}var c=this,d=a.mnext,e=a.vFrom,f=[d.vFrom],g=0;d=d.mnext;var h=d.vFrom;if(h!=e){for(;h!=e||g>1;)if(g>0){var i=PNLTRI.Math.ptsCrossProd(f[g],h,f[g-1]);Math.abs(i)<=PNLTRI.Math.EPSILON_P&&(h!=e&&PNLTRI.Math.compare_pts_yx(f[g],h)!=PNLTRI.Math.compare_pts_yx(f[g],f[g-1])||(i=1)),i>0?(this.polyData.addTriangle(f[g-1],f[g],h),g--):(f[++g]=h,h==e?b():(d=d.mnext,h=d.vFrom))}else f[++g]=h,d=d.mnext,h=d.vFrom;this.polyData.addTriangle(f[g-1],f[g],h)}}},PNLTRI.Triangulator=function(){this.lastPolyData=null},PNLTRI.Triangulator.prototype={constructor:PNLTRI.Triangulator,clear_lastData:function(){this.lastPolyData=null},get_PolyLeftArr:function(){return this.lastPolyData?this.lastPolyData.get_PolyLeftArr():null},triangulate_polygon:function(a,b){function c(){return!b&&1==e.nbPolyChains()}if(this.clear_lastData(),!a||0===a.length)return[];var d,e=new PNLTRI.PolygonData(a),f=c();if(f&&(d=new PNLTRI.EarClipTriangulator(e),f=d.triangulate_polygon_no_holes()),!f){var g=new PNLTRI.MonoSplitter(e);g.monotonate_trapezoids(),d=new PNLTRI.MonoTriangulator(e),d.triangulate_all_polygons()}return this.lastPolyData=e,e.getTriangles()}},function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.JSZip=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=a("./utils"),e=a("./support"),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c.encode=function(a){for(var b,c,e,g,h,i,j,k=[],l=0,m=a.length,n=m,o="string"!==d.getTypeOf(a);l<a.length;)n=m-l,o?(b=a[l++],c=l<m?a[l++]:0,e=l<m?a[l++]:0):(b=a.charCodeAt(l++),c=l<m?a.charCodeAt(l++):0,e=l<m?a.charCodeAt(l++):0),g=b>>2,h=(3&b)<<4|c>>4,i=n>1?(15&c)<<2|e>>6:64,j=n>2?63&e:64,k.push(f.charAt(g)+f.charAt(h)+f.charAt(i)+f.charAt(j));return k.join("")},c.decode=function(a){var b,c,d,g,h,i,j,k=0,l=0,m="data:";if(a.substr(m.length)===m)throw new Error("Invalid base64 input, it looks like a data url.");a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");var n=3*a.length/4;if(a.charAt(a.length-1)===f.charAt(64)&&n--,a.charAt(a.length-2)===f.charAt(64)&&n--,n%1!==0)throw new Error("Invalid base64 input, bad content length.");var o;for(o=e.uint8array?new Uint8Array(0|n):new Array(0|n);k<a.length;)g=f.indexOf(a.charAt(k++)),h=f.indexOf(a.charAt(k++)),i=f.indexOf(a.charAt(k++)),j=f.indexOf(a.charAt(k++)),b=g<<2|h>>4,c=(15&h)<<4|i>>2,d=(3&i)<<6|j,o[l++]=b,64!==i&&(o[l++]=c),64!==j&&(o[l++]=d);return o}},{"./support":27,"./utils":29}],2:[function(a,b,c){"use strict";function d(a,b,c,d,e){this.compressedSize=a,this.uncompressedSize=b,this.crc32=c,this.compression=d,this.compressedContent=e}var e=a("./external"),f=a("./stream/DataWorker"),g=a("./stream/DataLengthProbe"),h=a("./stream/Crc32Probe"),g=a("./stream/DataLengthProbe");d.prototype={getContentWorker:function(){var a=new f(e.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new g("data_length")),b=this;return a.on("end",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),a},getCompressedWorker:function(){return new f(e.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(a,b,c){return a.pipe(new h).pipe(new g("uncompressedSize")).pipe(b.compressWorker(c)).pipe(new g("compressedSize")).withStreamInfo("compression",b)},b.exports=d},{"./external":6,"./stream/Crc32Probe":22,"./stream/DataLengthProbe":23,"./stream/DataWorker":24}],3:[function(a,b,c){"use strict";var d=a("./stream/GenericWorker");c.STORE={magic:"\0\0",compressWorker:function(a){return new d("STORE compression")},uncompressWorker:function(){return new d("STORE decompression")}},c.DEFLATE=a("./flate")},{"./flate":7,"./stream/GenericWorker":25}],4:[function(a,b,c){"use strict";function d(){for(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function e(a,b,c,d){var e=h,f=d+c;a^=-1;for(var g=d;g<f;g++)a=a>>>8^e[255&(a^b[g])];return a^-1}function f(a,b,c,d){var e=h,f=d+c;a^=-1;for(var g=d;g<f;g++)a=a>>>8^e[255&(a^b.charCodeAt(g))];return a^-1}var g=a("./utils"),h=d();b.exports=function(a,b){if("undefined"==typeof a||!a.length)return 0;var c="string"!==g.getTypeOf(a);return c?e(0|b,a,a.length,0):f(0|b,a,a.length,0)}},{"./utils":29}],5:[function(a,b,c){"use strict";c.base64=!1,c.binary=!1,c.dir=!1,c.createFolders=!0,c.date=null,c.compression=null,c.compressionOptions=null,c.comment=null,c.unixPermissions=null,c.dosPermissions=null},{}],6:[function(a,b,c){(function(c){"use strict";var d=c.Promise||a("lie");b.exports={Promise:d}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{lie:56}],7:[function(a,b,c){"use strict";function d(a,b){h.call(this,"FlateWorker/"+a),this._pako=new f[a]({raw:!0,level:b.level||-1}),this.meta={};var c=this;this._pako.onData=function(a){c.push({data:a,meta:c.meta})}}var e="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,f=a("pako"),g=a("./utils"),h=a("./stream/GenericWorker"),i=e?"uint8array":"array";c.magic="\b\0",g.inherits(d,h),d.prototype.processChunk=function(a){this.meta=a.meta,this._pako.push(g.transformTo(i,a.data),!1)},d.prototype.flush=function(){h.prototype.flush.call(this),this._pako.push([],!0)},d.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},c.compressWorker=function(a){return new d("Deflate",a)},c.uncompressWorker=function(){return new d("Inflate",{})}},{"./stream/GenericWorker":25,"./utils":29,pako:57}],8:[function(a,b,c){"use strict";function d(a,b,c,d){f.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=b,this.zipPlatform=c,this.encodeFileName=d,this.streamFiles=a,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}var e=a("../utils"),f=a("../stream/GenericWorker"),g=a("../utf8"),h=a("../crc32"),i=a("../signature"),j=function(a,b){var c,d="";for(c=0;c<b;c++)d+=String.fromCharCode(255&a),a>>>=8;return d},k=function(a,b){var c=a;return a||(c=b?16893:33204),(65535&c)<<16},l=function(a,b){return 63&(a||0)},m=function(a,b,c,d,f,m){var n,o,p=a.file,q=a.compression,r=m!==g.utf8encode,s=e.transformTo("string",m(p.name)),t=e.transformTo("string",g.utf8encode(p.name)),u=p.comment,v=e.transformTo("string",m(u)),w=e.transformTo("string",g.utf8encode(u)),x=t.length!==p.name.length,y=w.length!==u.length,z="",A="",B="",C=p.dir,D=p.date,E={crc32:0,compressedSize:0,uncompressedSize:0};b&&!c||(E.crc32=a.crc32,E.compressedSize=a.compressedSize,E.uncompressedSize=a.uncompressedSize);var F=0;b&&(F|=8),r||!x&&!y||(F|=2048);var G=0,H=0;C&&(G|=16),"UNIX"===f?(H=798,G|=k(p.unixPermissions,C)):(H=20,G|=l(p.dosPermissions,C)),n=D.getUTCHours(),n<<=6,n|=D.getUTCMinutes(),n<<=5,n|=D.getUTCSeconds()/2,o=D.getUTCFullYear()-1980,o<<=4,o|=D.getUTCMonth()+1,o<<=5,o|=D.getUTCDate(),x&&(A=j(1,1)+j(h(s),4)+t,z+="up"+j(A.length,2)+A),y&&(B=j(1,1)+j(h(v),4)+w,z+="uc"+j(B.length,2)+B);var I="";I+="\n\0",I+=j(F,2),I+=q.magic,I+=j(n,2),I+=j(o,2),I+=j(E.crc32,4),I+=j(E.compressedSize,4),I+=j(E.uncompressedSize,4),I+=j(s.length,2),I+=j(z.length,2);var J=i.LOCAL_FILE_HEADER+I+s+z,K=i.CENTRAL_FILE_HEADER+j(H,2)+I+j(v.length,2)+"\0\0\0\0"+j(G,4)+j(d,4)+s+z+v;return{fileRecord:J,dirRecord:K}},n=function(a,b,c,d,f){var g="",h=e.transformTo("string",f(d));return g=i.CENTRAL_DIRECTORY_END+"\0\0\0\0"+j(a,2)+j(a,2)+j(b,4)+j(c,4)+j(h.length,2)+h},o=function(a){var b="";return b=i.DATA_DESCRIPTOR+j(a.crc32,4)+j(a.compressedSize,4)+j(a.uncompressedSize,4)};e.inherits(d,f),d.prototype.push=function(a){var b=a.meta.percent||0,c=this.entriesCount,d=this._sources.length;this.accumulate?this.contentBuffer.push(a):(this.bytesWritten+=a.data.length,f.prototype.push.call(this,{data:a.data,meta:{currentFile:this.currentFile,percent:c?(b+100*(c-d-1))/c:100}}))},d.prototype.openedSource=function(a){if(this.currentSourceOffset=this.bytesWritten,this.currentFile=a.file.name,this.streamFiles&&!a.file.dir){var b=m(a,this.streamFiles,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:b.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(a){this.accumulate=!1;var b=m(a,this.streamFiles,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(b.dirRecord),this.streamFiles&&!a.file.dir)this.push({data:o(a),meta:{percent:100}});else for(this.push({data:b.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var a=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var c=this.bytesWritten-a,d=n(this.dirRecords.length,c,a,this.zipComment,this.encodeFileName);this.push({data:d,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(a){this._sources.push(a);var b=this;return a.on("data",function(a){b.processChunk(a)}),a.on("end",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()}),a.on("error",function(a){b.error(a)}),this},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(a){var b=this._sources;if(!f.prototype.error.call(this,a))return!1;for(var c=0;c<b.length;c++)try{b[c].error(a)}catch(a){}return!0},d.prototype.lock=function(){f.prototype.lock.call(this);for(var a=this._sources,b=0;b<a.length;b++)a[b].lock()},b.exports=d},{"../crc32":4,"../signature":20,"../stream/GenericWorker":25,"../utf8":28,"../utils":29}],9:[function(a,b,c){"use strict";var d=a("../compressions"),e=a("./ZipFileWorker"),f=function(a,b){var c=a||b,e=d[c];if(!e)throw new Error(c+" is not a valid compression method !");return e};c.generateWorker=function(a,b,c){var d=new e(b.streamFiles,c,b.platform,b.encodeFileName),g=0;try{a.forEach(function(a,c){g++;var e=f(c.options.compression,b.compression),h=c.options.compressionOptions||b.compressionOptions||{},i=c.dir,j=c.date;c._compressWorker(e,h).withStreamInfo("file",{name:a,dir:i,date:j,comment:c.comment||"",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(d)}),d.entriesCount=g}catch(a){d.error(a)}return d}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(a,b,c){"use strict";function d(){if(!(this instanceof d))return new d;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var a=new d;for(var b in this)"function"!=typeof this[b]&&(a[b]=this[b]);return a}}d.prototype=a("./object"),d.prototype.loadAsync=a("./load"),d.support=a("./support"),d.defaults=a("./defaults"),d.version="3.1.1",d.loadAsync=function(a,b){return(new d).loadAsync(a,b)},d.external=a("./external"),b.exports=d},{"./defaults":5,"./external":6,"./load":11,"./object":13,"./support":27}],11:[function(a,b,c){"use strict";function d(a){return new f.Promise(function(b,c){var d=a.decompressed.getContentWorker().pipe(new i);d.on("error",function(a){c(a)}).on("end",function(){d.streamInfo.crc32!==a.decompressed.crc32?c(new Error("Corrupted zip : CRC32 mismatch")):b()}).resume()})}var e=a("./utils"),f=a("./external"),g=a("./utf8"),e=a("./utils"),h=a("./zipEntries"),i=a("./stream/Crc32Probe"),j=a("./nodejsUtils");b.exports=function(a,b){var c=this;return b=e.extend(b||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:g.utf8decode}),j.isNode&&j.isStream(a)?f.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):e.prepareContent("the loaded zip file",a,!0,b.optimizedBinaryString,b.base64).then(function(a){var c=new h(b);return c.load(a),c}).then(function(a){var c=[f.Promise.resolve(a)],e=a.files;if(b.checkCRC32)for(var g=0;g<e.length;g++)c.push(d(e[g]));return f.Promise.all(c)}).then(function(a){for(var d=a.shift(),e=d.files,f=0;f<e.length;f++){var g=e[f];c.file(g.fileNameStr,g.decompressed,{binary:!0,optimizedBinaryString:!0,date:g.date,dir:g.dir,comment:g.fileCommentStr.length?g.fileCommentStr:null,unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions,createFolders:b.createFolders})}return d.zipComment.length&&(c.comment=d.zipComment),c})}},{"./external":6,"./nodejsUtils":12,"./stream/Crc32Probe":22,"./utf8":28,"./utils":29,"./zipEntries":30}],12:[function(a,b,c){(function(a){"use strict";b.exports={isNode:"undefined"!=typeof a,newBuffer:function(b,c){return new a(b,c)},isBuffer:function(b){return a.isBuffer(b)},isStream:function(a){return a&&"function"==typeof a.on&&"function"==typeof a.pause&&"function"==typeof a.resume}}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],13:[function(a,b,c){"use strict";function d(a){return"[object RegExp]"===Object.prototype.toString.call(a)}var e=a("./utf8"),f=a("./utils"),g=a("./stream/GenericWorker"),h=a("./stream/StreamHelper"),i=a("./defaults"),j=a("./compressedObject"),k=a("./zipObject"),l=a("./generate"),m=a("./nodejsUtils"),n=a("./nodejs/NodejsStreamInputAdapter"),o=function(a,b,c){var d,e=f.getTypeOf(b);c=f.extend(c||{},i),c.date=c.date||new Date,null!==c.compression&&(c.compression=c.compression.toUpperCase()),"string"==typeof c.unixPermissions&&(c.unixPermissions=parseInt(c.unixPermissions,8)),c.unixPermissions&&16384&c.unixPermissions&&(c.dir=!0),c.dosPermissions&&16&c.dosPermissions&&(c.dir=!0),c.dir&&(a=q(a)),c.createFolders&&(d=p(a))&&r.call(this,d,!0);var h="string"===e&&c.binary===!1&&c.base64===!1;c.binary=!h;var l=b instanceof j&&0===b.uncompressedSize;(l||c.dir||!b||0===b.length)&&(c.base64=!1,c.binary=!0,b="",c.compression="STORE",e="string");var o=null;o=b instanceof j||b instanceof g?b:m.isNode&&m.isStream(b)?new n(a,b):f.prepareContent(a,b,c.binary,c.optimizedBinaryString,c.base64);var s=new k(a,o,c);this.files[a]=s},p=function(a){"/"===a.slice(-1)&&(a=a.substring(0,a.length-1));var b=a.lastIndexOf("/");return b>0?a.substring(0,b):""},q=function(a){return"/"!==a.slice(-1)&&(a+="/"),a},r=function(a,b){return b="undefined"!=typeof b?b:i.createFolders,a=q(a),this.files[a]||o.call(this,a,null,{dir:!0,createFolders:b}),this.files[a]},s={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(a){var b,c,d;for(b in this.files)this.files.hasOwnProperty(b)&&(d=this.files[b],c=b.slice(this.root.length,b.length),c&&b.slice(0,this.root.length)===this.root&&a(c,d))},filter:function(a){var b=[];return this.forEach(function(c,d){a(c,d)&&b.push(d)}),b},file:function(a,b,c){if(1===arguments.length){if(d(a)){var e=a;return this.filter(function(a,b){return!b.dir&&e.test(a)})}var f=this.files[this.root+a];return f&&!f.dir?f:null}return a=this.root+a,o.call(this,a,b,c),this},folder:function(a){if(!a)return this;if(d(a))return this.filter(function(b,c){return c.dir&&a.test(b)});var b=this.root+a,c=r.call(this,b),e=this.clone();return e.root=c.name,e},remove:function(a){a=this.root+a;var b=this.files[a];if(b||("/"!==a.slice(-1)&&(a+="/"),b=this.files[a]),b&&!b.dir)delete this.files[a];else for(var c=this.filter(function(b,c){return c.name.slice(0,a.length)===a}),d=0;d<c.length;d++)delete this.files[c[d].name];return this},generate:function(a){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(a){var b,c={};try{if(c=f.extend(a||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:e.utf8encode}),c.type=c.type.toLowerCase(),c.compression=c.compression.toUpperCase(),"binarystring"===c.type&&(c.type="string"),!c.type)throw new Error("No output type specified.");f.checkSupport(c.type),"darwin"!==a.platform&&"freebsd"!==a.platform&&"linux"!==a.platform&&"sunos"!==a.platform||(a.platform="UNIX"),"win32"===a.platform&&(a.platform="DOS");var d=c.comment||this.comment||"";b=l.generateWorker(this,c,d)}catch(a){b=new g("error"),b.error(a)}return new h(b,c.type||"string",c.mimeType)},generateAsync:function(a,b){return this.generateInternalStream(a).accumulate(b)},generateNodeStream:function(a,b){return a=a||{},a.type||(a.type="nodebuffer"),this.generateInternalStream(a).toNodejsStream(b)}};b.exports=s},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":33,"./nodejsUtils":12,"./stream/GenericWorker":25,"./stream/StreamHelper":26,"./utf8":28,"./utils":29,"./zipObject":32}],14:[function(a,b,c){"use strict";function d(a){e.call(this,a);
for(var b=0;b<this.data.length;b++)a[b]=255&a[b]}var e=a("./DataReader"),f=a("../utils");f.inherits(d,e),d.prototype.byteAt=function(a){return this.data[this.zero+a]},d.prototype.lastIndexOfSignature=function(a){for(var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.length-4;f>=0;--f)if(this.data[f]===b&&this.data[f+1]===c&&this.data[f+2]===d&&this.data[f+3]===e)return f-this.zero;return-1},d.prototype.readAndCheckSignature=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.readData(4);return b===f[0]&&c===f[1]&&d===f[2]&&e===f[3]},d.prototype.readData=function(a){if(this.checkOffset(a),0===a)return[];var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":29,"./DataReader":15}],15:[function(a,b,c){"use strict";function d(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}var e=a("../utils");d.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(a){},readInt:function(a){var b,c=0;for(this.checkOffset(a),b=this.index+a-1;b>=this.index;b--)c=(c<<8)+this.byteAt(b);return this.index+=a,c},readString:function(a){return e.transformTo("string",this.readData(a))},readData:function(a){},lastIndexOfSignature:function(a){},readAndCheckSignature:function(a){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},b.exports=d},{"../utils":29}],16:[function(a,b,c){"use strict";function d(a){e.call(this,a)}var e=a("./Uint8ArrayReader"),f=a("../utils");f.inherits(d,e),d.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":29,"./Uint8ArrayReader":18}],17:[function(a,b,c){"use strict";function d(a){e.call(this,a)}var e=a("./DataReader"),f=a("../utils");f.inherits(d,e),d.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},d.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},d.prototype.readAndCheckSignature=function(a){var b=this.readData(4);return a===b},d.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":29,"./DataReader":15}],18:[function(a,b,c){"use strict";function d(a){e.call(this,a)}var e=a("./ArrayReader"),f=a("../utils");f.inherits(d,e),d.prototype.readData=function(a){if(this.checkOffset(a),0===a)return new Uint8Array(0);var b=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":29,"./ArrayReader":14}],19:[function(a,b,c){"use strict";var d=a("../utils"),e=a("../support"),f=a("./ArrayReader"),g=a("./StringReader"),h=a("./NodeBufferReader"),i=a("./Uint8ArrayReader");b.exports=function(a){var b=d.getTypeOf(a);return d.checkSupport(b),"string"!==b||e.uint8array?"nodebuffer"===b?new h(a):e.uint8array?new i(d.transformTo("uint8array",a)):new f(d.transformTo("array",a)):new g(a)}},{"../support":27,"../utils":29,"./ArrayReader":14,"./NodeBufferReader":16,"./StringReader":17,"./Uint8ArrayReader":18}],20:[function(a,b,c){"use strict";c.LOCAL_FILE_HEADER="PK",c.CENTRAL_FILE_HEADER="PK",c.CENTRAL_DIRECTORY_END="PK",c.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",c.ZIP64_CENTRAL_DIRECTORY_END="PK",c.DATA_DESCRIPTOR="PK\b"},{}],21:[function(a,b,c){"use strict";function d(a){e.call(this,"ConvertWorker to "+a),this.destType=a}var e=a("./GenericWorker"),f=a("../utils");f.inherits(d,e),d.prototype.processChunk=function(a){this.push({data:f.transformTo(this.destType,a.data),meta:a.meta})},b.exports=d},{"../utils":29,"./GenericWorker":25}],22:[function(a,b,c){"use strict";function d(){e.call(this,"Crc32Probe")}var e=a("./GenericWorker"),f=a("../crc32"),g=a("../utils");g.inherits(d,e),d.prototype.processChunk=function(a){this.streamInfo.crc32=f(a.data,this.streamInfo.crc32||0),this.push(a)},b.exports=d},{"../crc32":4,"../utils":29,"./GenericWorker":25}],23:[function(a,b,c){"use strict";function d(a){f.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}var e=a("../utils"),f=a("./GenericWorker");e.inherits(d,f),d.prototype.processChunk=function(a){if(a){var b=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=b+a.data.length}f.prototype.processChunk.call(this,a)},b.exports=d},{"../utils":29,"./GenericWorker":25}],24:[function(a,b,c){"use strict";function d(a){f.call(this,"DataWorker");var b=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(a){b.dataIsReady=!0,b.data=a,b.max=a&&a.length||0,b.type=e.getTypeOf(a),b.isPaused||b._tickAndRepeat()},function(a){b.error(a)})}var e=a("../utils"),f=a("./GenericWorker"),g=16384;e.inherits(d,f),d.prototype.cleanUp=function(){f.prototype.cleanUp.call(this),this.data=null},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,e.delay(this._tickAndRepeat,[],this)),!0)},d.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(e.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=g,b=null,c=Math.min(this.max,this.index+a);if(this.index>=this.max)return this.end();switch(this.type){case"string":b=this.data.substring(this.index,c);break;case"uint8array":b=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":b=this.data.slice(this.index,c)}return this.index=c,this.push({data:b,meta:{percent:this.max?this.index/this.max*100:0}})},b.exports=d},{"../utils":29,"./GenericWorker":25}],25:[function(a,b,c){"use strict";function d(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}d.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,b){return this._listeners[a].push(b),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,b){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].call(this,b)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var b=this;return a.on("data",function(a){b.processChunk(a)}),a.on("end",function(){b.end()}),a.on("error",function(a){b.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var a=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,b){return this.extraStreamInfo[a]=b,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},b.exports=d},{}],26:[function(a,b,c){(function(c){"use strict";function d(a,b,c){switch(a){case"blob":return h.newBlob(h.transformTo("arraybuffer",b),c);case"base64":return k.encode(b);default:return h.transformTo(a,b)}}function e(a,b){var d,e=0,f=null,g=0;for(d=0;d<b.length;d++)g+=b[d].length;switch(a){case"string":return b.join("");case"array":return Array.prototype.concat.apply([],b);case"uint8array":for(f=new Uint8Array(g),d=0;d<b.length;d++)f.set(b[d],e),e+=b[d].length;return f;case"nodebuffer":return c.concat(b);default:throw new Error("concat : unsupported type '"+a+"'")}}function f(a,b){return new m.Promise(function(c,f){var g=[],h=a._internalType,i=a._outputType,j=a._mimeType;a.on("data",function(a,c){g.push(a),b&&b(c)}).on("error",function(a){g=[],f(a)}).on("end",function(){try{var a=d(i,e(h,g),j);c(a)}catch(a){f(a)}g=[]}).resume()})}function g(a,b,c){var d=b;switch(b){case"blob":case"arraybuffer":d="uint8array";break;case"base64":d="string"}try{this._internalType=d,this._outputType=b,this._mimeType=c,h.checkSupport(d),this._worker=a.pipe(new i(d)),a.lock()}catch(a){this._worker=new j("error"),this._worker.error(a)}}var h=a("../utils"),i=a("./ConvertWorker"),j=a("./GenericWorker"),k=a("../base64"),l=a("../nodejs/NodejsStreamOutputAdapter"),m=a("../external");g.prototype={accumulate:function(a){return f(this,a)},on:function(a,b){var c=this;return"data"===a?this._worker.on(a,function(a){b.call(c,a.data,a.meta)}):this._worker.on(a,function(){h.delay(b,arguments,c)}),this},resume:function(){return h.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(a){if(h.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new l(this,{objectMode:"nodebuffer"!==this._outputType},a)}},b.exports=g}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":33,"../utils":29,"./ConvertWorker":21,"./GenericWorker":25}],27:[function(a,b,c){(function(b){"use strict";if(c.base64=!0,c.array=!0,c.string=!0,c.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,c.nodebuffer="undefined"!=typeof b,c.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)c.blob=!1;else{var d=new ArrayBuffer(0);try{c.blob=0===new Blob([d],{type:"application/zip"}).size}catch(a){try{var e=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,f=new e;f.append(d),c.blob=0===f.getBlob("application/zip").size}catch(a){c.blob=!1}}}c.nodestream=!!a("./nodejs/NodejsStreamOutputAdapter").prototype}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{"./nodejs/NodejsStreamOutputAdapter":33}],28:[function(a,b,c){"use strict";function d(){i.call(this,"utf-8 decode"),this.leftOver=null}function e(){i.call(this,"utf-8 encode")}for(var f=a("./utils"),g=a("./support"),h=a("./nodejsUtils"),i=a("./stream/GenericWorker"),j=new Array(256),k=0;k<256;k++)j[k]=k>=252?6:k>=248?5:k>=240?4:k>=224?3:k>=192?2:1;j[254]=j[254]=1;var l=function(a){var b,c,d,e,f,h=a.length,i=0;for(e=0;e<h;e++)c=a.charCodeAt(e),55296===(64512&c)&&e+1<h&&(d=a.charCodeAt(e+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),e++)),i+=c<128?1:c<2048?2:c<65536?3:4;for(b=g.uint8array?new Uint8Array(i):new Array(i),f=0,e=0;f<i;e++)c=a.charCodeAt(e),55296===(64512&c)&&e+1<h&&(d=a.charCodeAt(e+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),e++)),c<128?b[f++]=c:c<2048?(b[f++]=192|c>>>6,b[f++]=128|63&c):c<65536?(b[f++]=224|c>>>12,b[f++]=128|c>>>6&63,b[f++]=128|63&c):(b[f++]=240|c>>>18,b[f++]=128|c>>>12&63,b[f++]=128|c>>>6&63,b[f++]=128|63&c);return b},m=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return c<0?b:0===c?b:c+j[a[c]]>b?c:b},n=function(a){var b,c,d,e,g=a.length,h=new Array(2*g);for(c=0,b=0;b<g;)if(d=a[b++],d<128)h[c++]=d;else if(e=j[d],e>4)h[c++]=65533,b+=e-1;else{for(d&=2===e?31:3===e?15:7;e>1&&b<g;)d=d<<6|63&a[b++],e--;e>1?h[c++]=65533:d<65536?h[c++]=d:(d-=65536,h[c++]=55296|d>>10&1023,h[c++]=56320|1023&d)}return h.length!==c&&(h.subarray?h=h.subarray(0,c):h.length=c),f.applyFromCharCode(h)};c.utf8encode=function(a){return g.nodebuffer?h.newBuffer(a,"utf-8"):l(a)},c.utf8decode=function(a){return g.nodebuffer?f.transformTo("nodebuffer",a).toString("utf-8"):(a=f.transformTo(g.uint8array?"uint8array":"array",a),n(a))},f.inherits(d,i),d.prototype.processChunk=function(a){var b=f.transformTo(g.uint8array?"uint8array":"array",a.data);if(this.leftOver&&this.leftOver.length){if(g.uint8array){var d=b;b=new Uint8Array(d.length+this.leftOver.length),b.set(this.leftOver,0),b.set(d,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var e=m(b),h=b;e!==b.length&&(g.uint8array?(h=b.subarray(0,e),this.leftOver=b.subarray(e,b.length)):(h=b.slice(0,e),this.leftOver=b.slice(e,b.length))),this.push({data:c.utf8decode(h),meta:a.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:c.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},c.Utf8DecodeWorker=d,f.inherits(e,i),e.prototype.processChunk=function(a){this.push({data:c.utf8encode(a.data),meta:a.meta})},c.Utf8EncodeWorker=e},{"./nodejsUtils":12,"./stream/GenericWorker":25,"./support":27,"./utils":29}],29:[function(a,b,c){"use strict";function d(a){var b=null;return b=i.uint8array?new Uint8Array(a.length):new Array(a.length),f(a,b)}function e(a){return a}function f(a,b){for(var c=0;c<a.length;++c)b[c]=255&a.charCodeAt(c);return b}function g(a){var b=65536,d=c.getTypeOf(a),e=!0;if("uint8array"===d?e=n.applyCanBeUsed.uint8array:"nodebuffer"===d&&(e=n.applyCanBeUsed.nodebuffer),e)for(;b>1;)try{return n.stringifyByChunk(a,d,b)}catch(a){b=Math.floor(b/2)}return n.stringifyByChar(a)}function h(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b}var i=a("./support"),j=a("./base64"),k=a("./nodejsUtils"),l=a("core-js/library/fn/set-immediate"),m=a("./external");c.newBlob=function(a,b){c.checkSupport("blob");try{return new Blob([a],{type:b})}catch(c){try{var d=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,e=new d;return e.append(a),e.getBlob(b)}catch(a){throw new Error("Bug : can't construct the Blob.")}}};var n={stringifyByChunk:function(a,b,c){var d=[],e=0,f=a.length;if(f<=c)return String.fromCharCode.apply(null,a);for(;e<f;)"array"===b||"nodebuffer"===b?d.push(String.fromCharCode.apply(null,a.slice(e,Math.min(e+c,f)))):d.push(String.fromCharCode.apply(null,a.subarray(e,Math.min(e+c,f)))),e+=c;return d.join("")},stringifyByChar:function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(a){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,k.newBuffer(1)).length}catch(a){return!1}}()}};c.applyFromCharCode=g;var o={};o.string={string:e,array:function(a){return f(a,new Array(a.length))},arraybuffer:function(a){return o.string.uint8array(a).buffer},uint8array:function(a){return f(a,new Uint8Array(a.length))},nodebuffer:function(a){return f(a,k.newBuffer(a.length))}},o.array={string:g,array:e,arraybuffer:function(a){return new Uint8Array(a).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBuffer(a)}},o.arraybuffer={string:function(a){return g(new Uint8Array(a))},array:function(a){return h(new Uint8Array(a),new Array(a.byteLength))},arraybuffer:e,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBuffer(new Uint8Array(a))}},o.uint8array={string:g,array:function(a){return h(a,new Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:e,nodebuffer:function(a){return k.newBuffer(a)}},o.nodebuffer={string:g,array:function(a){return h(a,new Array(a.length))},arraybuffer:function(a){return o.nodebuffer.uint8array(a).buffer},uint8array:function(a){return h(a,new Uint8Array(a.length))},nodebuffer:e},c.transformTo=function(a,b){if(b||(b=""),!a)return b;c.checkSupport(a);var d=c.getTypeOf(b),e=o[d][a](b);return e},c.getTypeOf=function(a){return"string"==typeof a?"string":"[object Array]"===Object.prototype.toString.call(a)?"array":i.nodebuffer&&k.isBuffer(a)?"nodebuffer":i.uint8array&&a instanceof Uint8Array?"uint8array":i.arraybuffer&&a instanceof ArrayBuffer?"arraybuffer":void 0},c.checkSupport=function(a){var b=i[a.toLowerCase()];if(!b)throw new Error(a+" is not supported by this platform")},c.MAX_VALUE_16BITS=65535,c.MAX_VALUE_32BITS=-1,c.pretty=function(a){var b,c,d="";for(c=0;c<(a||"").length;c++)b=a.charCodeAt(c),d+="\\x"+(b<16?"0":"")+b.toString(16).toUpperCase();return d},c.delay=function(a,b,c){l(function(){a.apply(c||null,b||[])})},c.inherits=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c},c.extend=function(){var a,b,c={};for(a=0;a<arguments.length;a++)for(b in arguments[a])arguments[a].hasOwnProperty(b)&&"undefined"==typeof c[b]&&(c[b]=arguments[a][b]);return c},c.prepareContent=function(a,b,e,f,g){var h=m.Promise.resolve(b).then(function(a){return i.blob&&a instanceof Blob&&"undefined"!=typeof FileReader?new m.Promise(function(b,c){var d=new FileReader;d.onload=function(a){b(a.target.result)},d.onerror=function(a){c(a.target.error)},d.readAsArrayBuffer(a)}):a});return h.then(function(b){var h=c.getTypeOf(b);return h?("arraybuffer"===h?b=c.transformTo("uint8array",b):"string"===h&&(g?b=j.decode(b):e&&f!==!0&&(b=d(b))),b):m.Promise.reject(new Error("The data of '"+a+"' is in an unsupported format !"))})}},{"./base64":1,"./external":6,"./nodejsUtils":12,"./support":27,"core-js/library/fn/set-immediate":34}],30:[function(a,b,c){"use strict";function d(a){this.files=[],this.loadOptions=a}var e=a("./reader/readerFor"),f=a("./utils"),g=a("./signature"),h=a("./zipEntry"),i=(a("./utf8"),a("./support"));d.prototype={checkSignature:function(a){if(!this.reader.readAndCheckSignature(a)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error("Corrupted zip or bug : unexpected signature ("+f.pretty(b)+", expected "+f.pretty(a)+")")}},isSignature:function(a,b){var c=this.reader.index;this.reader.setIndex(a);var d=this.reader.readString(4),e=d===b;return this.reader.setIndex(c),e},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var a=this.reader.readData(this.zipCommentLength),b=i.uint8array?"uint8array":"array",c=f.transformTo(b,a);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var a,b,c,d=this.zip64EndOfCentralSize-44,e=0;e<d;)a=this.reader.readInt(2),b=this.reader.readInt(4),c=this.reader.readData(b),this.zip64ExtensibleData[a]={id:a,length:b,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var a,b;for(a=0;a<this.files.length;a++)b=this.files[a],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(g.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var a;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(g.CENTRAL_FILE_HEADER);)a=new h({zip64:this.zip64},this.loadOptions),a.readCentralPart(this.reader),this.files.push(a);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var a=this.reader.lastIndexOfSignature(g.CENTRAL_DIRECTORY_END);if(a<0){var b=!this.isSignature(0,g.LOCAL_FILE_HEADER);throw b?new Error("Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip : can't find end of central directory")}this.reader.setIndex(a);var c=a;if(this.checkSignature(g.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===f.MAX_VALUE_16BITS||this.diskWithCentralDirStart===f.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===f.MAX_VALUE_16BITS||this.centralDirRecords===f.MAX_VALUE_16BITS||this.centralDirSize===f.MAX_VALUE_32BITS||this.centralDirOffset===f.MAX_VALUE_32BITS){if(this.zip64=!0,a=this.reader.lastIndexOfSignature(g.ZIP64_CENTRAL_DIRECTORY_LOCATOR),a<0)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(a),this.checkSignature(g.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,g.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(g.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(g.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var e=c-d;if(e>0)this.isSignature(c,g.CENTRAL_FILE_HEADER)||(this.reader.zero=e);else if(e<0)throw new Error("Corrupted zip: missing "+Math.abs(e)+" bytes.")},prepareReader:function(a){this.reader=e(a)},load:function(a){this.prepareReader(a),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},b.exports=d},{"./reader/readerFor":19,"./signature":20,"./support":27,"./utf8":28,"./utils":29,"./zipEntry":31}],31:[function(a,b,c){"use strict";function d(a,b){this.options=a,this.loadOptions=b}var e=a("./reader/readerFor"),f=a("./utils"),g=a("./compressedObject"),h=a("./crc32"),i=a("./utf8"),j=a("./compressions"),k=a("./support"),l=0,m=3,n=function(a){for(var b in j)if(j.hasOwnProperty(b)&&j[b].magic===a)return j[b];return null};d.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},readLocalPart:function(a){var b,c;if(a.skip(22),this.fileNameLength=a.readInt(2),c=a.readInt(2),this.fileName=a.readData(this.fileNameLength),a.skip(c),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(b=n(this.compressionMethod),null===b)throw new Error("Corrupted zip : compression "+f.pretty(this.compressionMethod)+" unknown (inner file : "+f.transformTo("string",this.fileName)+")");this.decompressed=new g(this.compressedSize,this.uncompressedSize,this.crc32,b,a.readData(this.compressedSize))},readCentralPart:function(a){this.versionMadeBy=a.readInt(2),a.skip(2),this.bitFlag=a.readInt(2),this.compressionMethod=a.readString(2),this.date=a.readDate(),this.crc32=a.readInt(4),this.compressedSize=a.readInt(4),this.uncompressedSize=a.readInt(4);var b=a.readInt(2);if(this.extraFieldsLength=a.readInt(2),this.fileCommentLength=a.readInt(2),this.diskNumberStart=a.readInt(2),this.internalFileAttributes=a.readInt(2),this.externalFileAttributes=a.readInt(4),this.localHeaderOffset=a.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");a.skip(b),this.readExtraFields(a),this.parseZIP64ExtraField(a),this.fileComment=a.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var a=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),a===l&&(this.dosPermissions=63&this.externalFileAttributes),a===m&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(a){if(this.extraFields[1]){var b=e(this.extraFields[1].value);this.uncompressedSize===f.MAX_VALUE_32BITS&&(this.uncompressedSize=b.readInt(8)),this.compressedSize===f.MAX_VALUE_32BITS&&(this.compressedSize=b.readInt(8)),this.localHeaderOffset===f.MAX_VALUE_32BITS&&(this.localHeaderOffset=b.readInt(8)),this.diskNumberStart===f.MAX_VALUE_32BITS&&(this.diskNumberStart=b.readInt(4))}},readExtraFields:function(a){var b,c,d,e=a.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});a.index<e;)b=a.readInt(2),c=a.readInt(2),d=a.readData(c),this.extraFields[b]={id:b,length:c,value:d}},handleUTF8:function(){var a=k.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=i.utf8decode(this.fileName),this.fileCommentStr=i.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(null!==b)this.fileNameStr=b;else{var c=f.transformTo(a,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(c)}var d=this.findExtraFieldUnicodeComment();if(null!==d)this.fileCommentStr=d;else{var e=f.transformTo(a,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(e)}}},findExtraFieldUnicodePath:function(){var a=this.extraFields[28789];if(a){var b=e(a.value);return 1!==b.readInt(1)?null:h(this.fileName)!==b.readInt(4)?null:i.utf8decode(b.readData(a.length-5))}return null},findExtraFieldUnicodeComment:function(){var a=this.extraFields[25461];if(a){var b=e(a.value);return 1!==b.readInt(1)?null:h(this.fileComment)!==b.readInt(4)?null:i.utf8decode(b.readData(a.length-5))}return null}},b.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":19,"./support":27,"./utf8":28,"./utils":29}],32:[function(a,b,c){"use strict";var d=a("./stream/StreamHelper"),e=a("./stream/DataWorker"),f=a("./utf8"),g=a("./compressedObject"),h=a("./stream/GenericWorker"),i=function(a,b,c){this.name=a,this.dir=c.dir,this.date=c.date,this.comment=c.comment,this.unixPermissions=c.unixPermissions,this.dosPermissions=c.dosPermissions,this._data=b,this._dataBinary=c.binary,this.options={compression:c.compression,compressionOptions:c.compressionOptions}};i.prototype={internalStream:function(a){var b=a.toLowerCase(),c="string"===b||"text"===b;"binarystring"!==b&&"text"!==b||(b="string");var e=this._decompressWorker(),g=!this._dataBinary;return g&&!c&&(e=e.pipe(new f.Utf8EncodeWorker)),!g&&c&&(e=e.pipe(new f.Utf8DecodeWorker)),new d(e,b,"")},async:function(a,b){return this.internalStream(a).accumulate(b)},nodeStream:function(a,b){return this.internalStream(a||"nodebuffer").toNodejsStream(b)},_compressWorker:function(a,b){if(this._data instanceof g&&this._data.compression.magic===a.magic)return this._data.getCompressedWorker();var c=this._decompressWorker();return this._dataBinary||(c=c.pipe(new f.Utf8EncodeWorker)),g.createWorkerFrom(c,a,b)},_decompressWorker:function(){return this._data instanceof g?this._data.getContentWorker():this._data instanceof h?this._data:new e(this._data)}};for(var j=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],k=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},l=0;l<j.length;l++)i.prototype[j[l]]=k;b.exports=i},{"./compressedObject":2,"./stream/DataWorker":24,"./stream/GenericWorker":25,"./stream/StreamHelper":26,"./utf8":28}],33:[function(a,b,c){},{}],34:[function(a,b,c){a("../modules/web.immediate"),b.exports=a("../modules/_core").setImmediate},{"../modules/_core":38,"../modules/web.immediate":54}],35:[function(a,b,c){b.exports=function(a){if("function"!=typeof a)throw TypeError(a+" is not a function!");return a}},{}],36:[function(a,b,c){var d=a("./_is-object");b.exports=function(a){if(!d(a))throw TypeError(a+" is not an object!");return a}},{"./_is-object":49}],37:[function(a,b,c){var d={}.toString;b.exports=function(a){return d.call(a).slice(8,-1)}},{}],38:[function(a,b,c){var d=b.exports={version:"2.3.0"};"number"==typeof __e&&(__e=d)},{}],39:[function(a,b,c){var d=a("./_a-function");b.exports=function(a,b,c){if(d(a),void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)}}return function(){return a.apply(b,arguments)}}},{"./_a-function":35}],40:[function(a,b,c){b.exports=!a("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":43}],41:[function(a,b,c){var d=a("./_is-object"),e=a("./_global").document,f=d(e)&&d(e.createElement);b.exports=function(a){return f?e.createElement(a):{}}},{"./_global":44,"./_is-object":49}],42:[function(a,b,c){var d=a("./_global"),e=a("./_core"),f=a("./_ctx"),g=a("./_hide"),h="prototype",i=function(a,b,c){var j,k,l,m=a&i.F,n=a&i.G,o=a&i.S,p=a&i.P,q=a&i.B,r=a&i.W,s=n?e:e[b]||(e[b]={}),t=s[h],u=n?d:o?d[b]:(d[b]||{})[h];n&&(c=b);for(j in c)k=!m&&u&&void 0!==u[j],k&&j in s||(l=k?u[j]:c[j],s[j]=n&&"function"!=typeof u[j]?c[j]:q&&k?f(l,d):r&&u[j]==l?function(a){var b=function(b,c,d){if(this instanceof a){switch(arguments.length){case 0:return new a;case 1:return new a(b);case 2:return new a(b,c)}return new a(b,c,d)}return a.apply(this,arguments)};return b[h]=a[h],b}(l):p&&"function"==typeof l?f(Function.call,l):l,p&&((s.virtual||(s.virtual={}))[j]=l,a&i.R&&t&&!t[j]&&g(t,j,l)))};i.F=1,i.G=2,i.S=4,i.P=8,i.B=16,i.W=32,i.U=64,i.R=128,b.exports=i},{"./_core":38,"./_ctx":39,"./_global":44,"./_hide":45}],43:[function(a,b,c){b.exports=function(a){try{return!!a()}catch(a){return!0}}},{}],44:[function(a,b,c){var d=b.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=d)},{}],45:[function(a,b,c){var d=a("./_object-dp"),e=a("./_property-desc");b.exports=a("./_descriptors")?function(a,b,c){return d.f(a,b,e(1,c))}:function(a,b,c){return a[b]=c,a}},{"./_descriptors":40,"./_object-dp":50,"./_property-desc":51}],46:[function(a,b,c){b.exports=a("./_global").document&&document.documentElement},{"./_global":44}],47:[function(a,b,c){b.exports=!a("./_descriptors")&&!a("./_fails")(function(){return 7!=Object.defineProperty(a("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":40,"./_dom-create":41,"./_fails":43}],48:[function(a,b,c){b.exports=function(a,b,c){var d=void 0===c;switch(b.length){case 0:return d?a():a.call(c);case 1:return d?a(b[0]):a.call(c,b[0]);case 2:return d?a(b[0],b[1]):a.call(c,b[0],b[1]);case 3:return d?a(b[0],b[1],b[2]):a.call(c,b[0],b[1],b[2]);case 4:return d?a(b[0],b[1],b[2],b[3]):a.call(c,b[0],b[1],b[2],b[3])}return a.apply(c,b)}},{}],49:[function(a,b,c){b.exports=function(a){return"object"==typeof a?null!==a:"function"==typeof a}},{}],50:[function(a,b,c){var d=a("./_an-object"),e=a("./_ie8-dom-define"),f=a("./_to-primitive"),g=Object.defineProperty;c.f=a("./_descriptors")?Object.defineProperty:function(a,b,c){if(d(a),b=f(b,!0),d(c),e)try{return g(a,b,c)}catch(a){}if("get"in c||"set"in c)throw TypeError("Accessors not supported!");return"value"in c&&(a[b]=c.value),a}},{"./_an-object":36,"./_descriptors":40,
"./_ie8-dom-define":47,"./_to-primitive":53}],51:[function(a,b,c){b.exports=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}}},{}],52:[function(a,b,c){var d,e,f,g=a("./_ctx"),h=a("./_invoke"),i=a("./_html"),j=a("./_dom-create"),k=a("./_global"),l=k.process,m=k.setImmediate,n=k.clearImmediate,o=k.MessageChannel,p=0,q={},r="onreadystatechange",s=function(){var a=+this;if(q.hasOwnProperty(a)){var b=q[a];delete q[a],b()}},t=function(a){s.call(a.data)};m&&n||(m=function(a){for(var b=[],c=1;arguments.length>c;)b.push(arguments[c++]);return q[++p]=function(){h("function"==typeof a?a:Function(a),b)},d(p),p},n=function(a){delete q[a]},"process"==a("./_cof")(l)?d=function(a){l.nextTick(g(s,a,1))}:o?(e=new o,f=e.port2,e.port1.onmessage=t,d=g(f.postMessage,f,1)):k.addEventListener&&"function"==typeof postMessage&&!k.importScripts?(d=function(a){k.postMessage(a+"","*")},k.addEventListener("message",t,!1)):d=r in j("script")?function(a){i.appendChild(j("script"))[r]=function(){i.removeChild(this),s.call(a)}}:function(a){setTimeout(g(s,a,1),0)}),b.exports={set:m,clear:n}},{"./_cof":37,"./_ctx":39,"./_dom-create":41,"./_global":44,"./_html":46,"./_invoke":48}],53:[function(a,b,c){var d=a("./_is-object");b.exports=function(a,b){if(!d(a))return a;var c,e;if(b&&"function"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;if("function"==typeof(c=a.valueOf)&&!d(e=c.call(a)))return e;if(!b&&"function"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":49}],54:[function(a,b,c){var d=a("./_export"),e=a("./_task");d(d.G+d.B,{setImmediate:e.set,clearImmediate:e.clear})},{"./_export":42,"./_task":52}],55:[function(a,b,c){(function(a){"use strict";function c(){k=!0;for(var a,b,c=l.length;c;){for(b=l,l=[],a=-1;++a<c;)b[a]();c=l.length}k=!1}function d(a){1!==l.push(a)||k||e()}var e,f=a.MutationObserver||a.WebKitMutationObserver;if(f){var g=0,h=new f(c),i=a.document.createTextNode("");h.observe(i,{characterData:!0}),e=function(){i.data=g=++g%2}}else if(a.setImmediate||"undefined"==typeof a.MessageChannel)e="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var b=a.document.createElement("script");b.onreadystatechange=function(){c(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},a.document.documentElement.appendChild(b)}:function(){setTimeout(c,0)};else{var j=new a.MessageChannel;j.port1.onmessage=c,e=function(){j.port2.postMessage(0)}}var k,l=[];b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],56:[function(a,b,c){"use strict";function d(){}function e(a){if("function"!=typeof a)throw new TypeError("resolver must be a function");this.state=s,this.queue=[],this.outcome=void 0,a!==d&&i(this,a)}function f(a,b,c){this.promise=a,"function"==typeof b&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),"function"==typeof c&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}function g(a,b,c){o(function(){var d;try{d=b(c)}catch(b){return p.reject(a,b)}d===a?p.reject(a,new TypeError("Cannot resolve promise with itself")):p.resolve(a,d)})}function h(a){var b=a&&a.then;if(a&&"object"==typeof a&&"function"==typeof b)return function(){b.apply(a,arguments)}}function i(a,b){function c(b){f||(f=!0,p.reject(a,b))}function d(b){f||(f=!0,p.resolve(a,b))}function e(){b(d,c)}var f=!1,g=j(e);"error"===g.status&&c(g.value)}function j(a,b){var c={};try{c.value=a(b),c.status="success"}catch(a){c.status="error",c.value=a}return c}function k(a){return a instanceof this?a:p.resolve(new this(d),a)}function l(a){var b=new this(d);return p.reject(b,a)}function m(a){function b(a,b){function d(a){g[b]=a,++h!==e||f||(f=!0,p.resolve(j,g))}c.resolve(a).then(d,function(a){f||(f=!0,p.reject(j,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=new Array(e),h=0,i=-1,j=new this(d);++i<e;)b(a[i],i);return j}function n(a){function b(a){c.resolve(a).then(function(a){f||(f=!0,p.resolve(h,a))},function(a){f||(f=!0,p.reject(h,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=-1,h=new this(d);++g<e;)b(a[g]);return h}var o=a("immediate"),p={},q=["REJECTED"],r=["FULFILLED"],s=["PENDING"];b.exports=e,e.prototype.catch=function(a){return this.then(null,a)},e.prototype.then=function(a,b){if("function"!=typeof a&&this.state===r||"function"!=typeof b&&this.state===q)return this;var c=new this.constructor(d);if(this.state!==s){var e=this.state===r?a:b;g(c,e,this.outcome)}else this.queue.push(new f(c,a,b));return c},f.prototype.callFulfilled=function(a){p.resolve(this.promise,a)},f.prototype.otherCallFulfilled=function(a){g(this.promise,this.onFulfilled,a)},f.prototype.callRejected=function(a){p.reject(this.promise,a)},f.prototype.otherCallRejected=function(a){g(this.promise,this.onRejected,a)},p.resolve=function(a,b){var c=j(h,b);if("error"===c.status)return p.reject(a,c.value);var d=c.value;if(d)i(a,d);else{a.state=r,a.outcome=b;for(var e=-1,f=a.queue.length;++e<f;)a.queue[e].callFulfilled(b)}return a},p.reject=function(a,b){a.state=q,a.outcome=b;for(var c=-1,d=a.queue.length;++c<d;)a.queue[c].callRejected(b);return a},e.resolve=k,e.reject=l,e.all=m,e.race=n},{immediate:55}],57:[function(a,b,c){"use strict";var d=a("./lib/utils/common").assign,e=a("./lib/deflate"),f=a("./lib/inflate"),g=a("./lib/zlib/constants"),h={};d(h,e,f,g),b.exports=h},{"./lib/deflate":58,"./lib/inflate":59,"./lib/utils/common":60,"./lib/zlib/constants":63}],58:[function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);this.options=i.assign({level:s,method:u,chunkSize:16384,windowBits:15,memLevel:8,strategy:t,to:""},a||{});var b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=h.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(c!==p)throw new Error(k[c]);if(b.header&&h.deflateSetHeader(this.strm,b.header),b.dictionary){var e;if(e="string"==typeof b.dictionary?j.string2buf(b.dictionary):"[object ArrayBuffer]"===m.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,c=h.deflateSetDictionary(this.strm,e),c!==p)throw new Error(k[c]);this._dict_set=!0}}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg;return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}function g(a,b){return b=b||{},b.gzip=!0,e(a,b)}var h=a("./zlib/deflate"),i=a("./utils/common"),j=a("./utils/strings"),k=a("./zlib/messages"),l=a("./zlib/zstream"),m=Object.prototype.toString,n=0,o=4,p=0,q=1,r=2,s=-1,t=0,u=8;d.prototype.push=function(a,b){var c,d,e=this.strm,f=this.options.chunkSize;if(this.ended)return!1;d=b===~~b?b:b===!0?o:n,"string"==typeof a?e.input=j.string2buf(a):"[object ArrayBuffer]"===m.call(a)?e.input=new Uint8Array(a):e.input=a,e.next_in=0,e.avail_in=e.input.length;do{if(0===e.avail_out&&(e.output=new i.Buf8(f),e.next_out=0,e.avail_out=f),c=h.deflate(e,d),c!==q&&c!==p)return this.onEnd(c),this.ended=!0,!1;0!==e.avail_out&&(0!==e.avail_in||d!==o&&d!==r)||("string"===this.options.to?this.onData(j.buf2binstring(i.shrinkBuf(e.output,e.next_out))):this.onData(i.shrinkBuf(e.output,e.next_out)))}while((e.avail_in>0||0===e.avail_out)&&c!==q);return d===o?(c=h.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===p):d!==r||(this.onEnd(p),e.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===p&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Deflate=d,c.deflate=e,c.deflateRaw=f,c.gzip=g},{"./utils/common":60,"./utils/strings":61,"./zlib/deflate":65,"./zlib/messages":70,"./zlib/zstream":72}],59:[function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);this.options=h.assign({chunkSize:16384,windowBits:0,to:""},a||{});var b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||a&&a.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=g.inflateInit2(this.strm,b.windowBits);if(c!==j.Z_OK)throw new Error(k[c]);this.header=new m,g.inflateGetHeader(this.strm,this.header)}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg;return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}var g=a("./zlib/inflate"),h=a("./utils/common"),i=a("./utils/strings"),j=a("./zlib/constants"),k=a("./zlib/messages"),l=a("./zlib/zstream"),m=a("./zlib/gzheader"),n=Object.prototype.toString;d.prototype.push=function(a,b){var c,d,e,f,k,l,m=this.strm,o=this.options.chunkSize,p=this.options.dictionary,q=!1;if(this.ended)return!1;d=b===~~b?b:b===!0?j.Z_FINISH:j.Z_NO_FLUSH,"string"==typeof a?m.input=i.binstring2buf(a):"[object ArrayBuffer]"===n.call(a)?m.input=new Uint8Array(a):m.input=a,m.next_in=0,m.avail_in=m.input.length;do{if(0===m.avail_out&&(m.output=new h.Buf8(o),m.next_out=0,m.avail_out=o),c=g.inflate(m,j.Z_NO_FLUSH),c===j.Z_NEED_DICT&&p&&(l="string"==typeof p?i.string2buf(p):"[object ArrayBuffer]"===n.call(p)?new Uint8Array(p):p,c=g.inflateSetDictionary(this.strm,l)),c===j.Z_BUF_ERROR&&q===!0&&(c=j.Z_OK,q=!1),c!==j.Z_STREAM_END&&c!==j.Z_OK)return this.onEnd(c),this.ended=!0,!1;m.next_out&&(0!==m.avail_out&&c!==j.Z_STREAM_END&&(0!==m.avail_in||d!==j.Z_FINISH&&d!==j.Z_SYNC_FLUSH)||("string"===this.options.to?(e=i.utf8border(m.output,m.next_out),f=m.next_out-e,k=i.buf2string(m.output,e),m.next_out=f,m.avail_out=o-f,f&&h.arraySet(m.output,m.output,e,f,0),this.onData(k)):this.onData(h.shrinkBuf(m.output,m.next_out)))),0===m.avail_in&&0===m.avail_out&&(q=!0)}while((m.avail_in>0||0===m.avail_out)&&c!==j.Z_STREAM_END);return c===j.Z_STREAM_END&&(d=j.Z_FINISH),d===j.Z_FINISH?(c=g.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===j.Z_OK):d!==j.Z_SYNC_FLUSH||(this.onEnd(j.Z_OK),m.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===j.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Inflate=d,c.inflate=e,c.inflateRaw=f,c.ungzip=e},{"./utils/common":60,"./utils/strings":61,"./zlib/constants":63,"./zlib/gzheader":66,"./zlib/inflate":68,"./zlib/messages":70,"./zlib/zstream":72}],60:[function(a,b,c){"use strict";var d="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;c.assign=function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if("object"!=typeof c)throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}}return a},c.shrinkBuf=function(a,b){return a.length===b?a:a.subarray?a.subarray(0,b):(a.length=b,a)};var e={arraySet:function(a,b,c,d,e){if(b.subarray&&a.subarray)return void a.set(b.subarray(c,c+d),e);for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){var b,c,d,e,f,g;for(d=0,b=0,c=a.length;b<c;b++)d+=a[b].length;for(g=new Uint8Array(d),e=0,b=0,c=a.length;b<c;b++)f=a[b],g.set(f,e),e+=f.length;return g}},f={arraySet:function(a,b,c,d,e){for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){return[].concat.apply([],a)}};c.setTyped=function(a){a?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,e)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,f))},c.setTyped(d)},{}],61:[function(a,b,c){"use strict";function d(a,b){if(b<65537&&(a.subarray&&g||!a.subarray&&f))return String.fromCharCode.apply(null,e.shrinkBuf(a,b));for(var c="",d=0;d<b;d++)c+=String.fromCharCode(a[d]);return c}var e=a("./common"),f=!0,g=!0;try{String.fromCharCode.apply(null,[0])}catch(a){f=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(a){g=!1}for(var h=new e.Buf8(256),i=0;i<256;i++)h[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;h[254]=h[254]=1,c.string2buf=function(a){var b,c,d,f,g,h=a.length,i=0;for(f=0;f<h;f++)c=a.charCodeAt(f),55296===(64512&c)&&f+1<h&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),i+=c<128?1:c<2048?2:c<65536?3:4;for(b=new e.Buf8(i),g=0,f=0;g<i;f++)c=a.charCodeAt(f),55296===(64512&c)&&f+1<h&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),c<128?b[g++]=c:c<2048?(b[g++]=192|c>>>6,b[g++]=128|63&c):c<65536?(b[g++]=224|c>>>12,b[g++]=128|c>>>6&63,b[g++]=128|63&c):(b[g++]=240|c>>>18,b[g++]=128|c>>>12&63,b[g++]=128|c>>>6&63,b[g++]=128|63&c);return b},c.buf2binstring=function(a){return d(a,a.length)},c.binstring2buf=function(a){for(var b=new e.Buf8(a.length),c=0,d=b.length;c<d;c++)b[c]=a.charCodeAt(c);return b},c.buf2string=function(a,b){var c,e,f,g,i=b||a.length,j=new Array(2*i);for(e=0,c=0;c<i;)if(f=a[c++],f<128)j[e++]=f;else if(g=h[f],g>4)j[e++]=65533,c+=g-1;else{for(f&=2===g?31:3===g?15:7;g>1&&c<i;)f=f<<6|63&a[c++],g--;g>1?j[e++]=65533:f<65536?j[e++]=f:(f-=65536,j[e++]=55296|f>>10&1023,j[e++]=56320|1023&f)}return d(j,e)},c.utf8border=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return c<0?b:0===c?b:c+h[a[c]]>b?c:b}},{"./common":60}],62:[function(a,b,c){"use strict";function d(a,b,c,d){for(var e=65535&a|0,f=a>>>16&65535|0,g=0;0!==c;){g=c>2e3?2e3:c,c-=g;do e=e+b[d++]|0,f=f+e|0;while(--g);e%=65521,f%=65521}return e|f<<16|0}b.exports=d},{}],63:[function(a,b,c){"use strict";b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],64:[function(a,b,c){"use strict";function d(){for(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function e(a,b,c,d){var e=f,g=d+c;a^=-1;for(var h=d;h<g;h++)a=a>>>8^e[255&(a^b[h])];return a^-1}var f=d();b.exports=e},{}],65:[function(a,b,c){"use strict";function d(a,b){return a.msg=I[b],b}function e(a){return(a<<1)-(a>4?9:0)}function f(a){for(var b=a.length;--b>=0;)a[b]=0}function g(a){var b=a.state,c=b.pending;c>a.avail_out&&(c=a.avail_out),0!==c&&(E.arraySet(a.output,b.pending_buf,b.pending_out,c,a.next_out),a.next_out+=c,b.pending_out+=c,a.total_out+=c,a.avail_out-=c,b.pending-=c,0===b.pending&&(b.pending_out=0))}function h(a,b){F._tr_flush_block(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,b),a.block_start=a.strstart,g(a.strm)}function i(a,b){a.pending_buf[a.pending++]=b}function j(a,b){a.pending_buf[a.pending++]=b>>>8&255,a.pending_buf[a.pending++]=255&b}function k(a,b,c,d){var e=a.avail_in;return e>d&&(e=d),0===e?0:(a.avail_in-=e,E.arraySet(b,a.input,a.next_in,e,c),1===a.state.wrap?a.adler=G(a.adler,b,e,c):2===a.state.wrap&&(a.adler=H(a.adler,b,e,c)),a.next_in+=e,a.total_in+=e,e)}function l(a,b){var c,d,e=a.max_chain_length,f=a.strstart,g=a.prev_length,h=a.nice_match,i=a.strstart>a.w_size-la?a.strstart-(a.w_size-la):0,j=a.window,k=a.w_mask,l=a.prev,m=a.strstart+ka,n=j[f+g-1],o=j[f+g];a.prev_length>=a.good_match&&(e>>=2),h>a.lookahead&&(h=a.lookahead);do if(c=b,j[c+g]===o&&j[c+g-1]===n&&j[c]===j[f]&&j[++c]===j[f+1]){f+=2,c++;do;while(j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&f<m);if(d=ka-(m-f),f=m-ka,d>g){if(a.match_start=b,g=d,d>=h)break;n=j[f+g-1],o=j[f+g]}}while((b=l[b&k])>i&&0!==--e);return g<=a.lookahead?g:a.lookahead}function m(a){var b,c,d,e,f,g=a.w_size;do{if(e=a.window_size-a.lookahead-a.strstart,a.strstart>=g+(g-la)){E.arraySet(a.window,a.window,g,g,0),a.match_start-=g,a.strstart-=g,a.block_start-=g,c=a.hash_size,b=c;do d=a.head[--b],a.head[b]=d>=g?d-g:0;while(--c);c=g,b=c;do d=a.prev[--b],a.prev[b]=d>=g?d-g:0;while(--c);e+=g}if(0===a.strm.avail_in)break;if(c=k(a.strm,a.window,a.strstart+a.lookahead,e),a.lookahead+=c,a.lookahead+a.insert>=ja)for(f=a.strstart-a.insert,a.ins_h=a.window[f],a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+ja-1])&a.hash_mask,a.prev[f&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=f,f++,a.insert--,!(a.lookahead+a.insert<ja)););}while(a.lookahead<la&&0!==a.strm.avail_in)}function n(a,b){var c=65535;for(c>a.pending_buf_size-5&&(c=a.pending_buf_size-5);;){if(a.lookahead<=1){if(m(a),0===a.lookahead&&b===J)return ua;if(0===a.lookahead)break}a.strstart+=a.lookahead,a.lookahead=0;var d=a.block_start+c;if((0===a.strstart||a.strstart>=d)&&(a.lookahead=a.strstart-d,a.strstart=d,h(a,!1),0===a.strm.avail_out))return ua;if(a.strstart-a.block_start>=a.w_size-la&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.strstart>a.block_start&&(h(a,!1),0===a.strm.avail_out)?ua:ua}function o(a,b){for(var c,d;;){if(a.lookahead<la){if(m(a),a.lookahead<la&&b===J)return ua;if(0===a.lookahead)break}if(c=0,a.lookahead>=ja&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==c&&a.strstart-c<=a.w_size-la&&(a.match_length=l(a,c)),a.match_length>=ja)if(d=F._tr_tally(a,a.strstart-a.match_start,a.match_length-ja),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=ja){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!==--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else d=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(d&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=a.strstart<ja-1?a.strstart:ja-1,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function p(a,b){for(var c,d,e;;){if(a.lookahead<la){if(m(a),a.lookahead<la&&b===J)return ua;if(0===a.lookahead)break}if(c=0,a.lookahead>=ja&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=ja-1,0!==c&&a.prev_length<a.max_lazy_match&&a.strstart-c<=a.w_size-la&&(a.match_length=l(a,c),a.match_length<=5&&(a.strategy===U||a.match_length===ja&&a.strstart-a.match_start>4096)&&(a.match_length=ja-1)),a.prev_length>=ja&&a.match_length<=a.prev_length){e=a.strstart+a.lookahead-ja,d=F._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-ja),a.lookahead-=a.prev_length-1,a.prev_length-=2;do++a.strstart<=e&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(0!==--a.prev_length);if(a.match_available=0,a.match_length=ja-1,a.strstart++,d&&(h(a,!1),0===a.strm.avail_out))return ua}else if(a.match_available){if(d=F._tr_tally(a,0,a.window[a.strstart-1]),d&&h(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return ua}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(d=F._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<ja-1?a.strstart:ja-1,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function q(a,b){for(var c,d,e,f,g=a.window;;){if(a.lookahead<=ka){if(m(a),a.lookahead<=ka&&b===J)return ua;if(0===a.lookahead)break}if(a.match_length=0,a.lookahead>=ja&&a.strstart>0&&(e=a.strstart-1,d=g[e],d===g[++e]&&d===g[++e]&&d===g[++e])){f=a.strstart+ka;do;while(d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&e<f);a.match_length=ka-(f-e),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=ja?(c=F._tr_tally(a,1,a.match_length-ja),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),c&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function r(a,b){for(var c;;){if(0===a.lookahead&&(m(a),0===a.lookahead)){if(b===J)return ua;break}if(a.match_length=0,c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,c&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function s(a,b,c,d,e){this.good_length=a,this.max_lazy=b,this.nice_length=c,this.max_chain=d,this.func=e}function t(a){a.window_size=2*a.w_size,f(a.head),a.max_lazy_match=D[a.level].max_lazy,a.good_match=D[a.level].good_length,a.nice_match=D[a.level].nice_length,a.max_chain_length=D[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=ja-1,a.match_available=0,a.ins_h=0}function u(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new E.Buf16(2*ha),this.dyn_dtree=new E.Buf16(2*(2*fa+1)),this.bl_tree=new E.Buf16(2*(2*ga+1)),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new E.Buf16(ia+1),this.heap=new E.Buf16(2*ea+1),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new E.Buf16(2*ea+1),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function v(a){var b;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=Z,b=a.state,b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?na:sa,a.adler=2===b.wrap?0:1,b.last_flush=J,F._tr_init(b),O):d(a,Q)}function w(a){var b=v(a);return b===O&&t(a.state),b}function x(a,b){return a&&a.state?2!==a.state.wrap?Q:(a.state.gzhead=b,O):Q}function y(a,b,c,e,f,g){if(!a)return Q;var h=1;if(b===T&&(b=6),e<0?(h=0,e=-e):e>15&&(h=2,e-=16),f<1||f>_||c!==$||e<8||e>15||b<0||b>9||g<0||g>X)return d(a,Q);8===e&&(e=9);var i=new u;return a.state=i,i.strm=a,i.wrap=h,i.gzhead=null,i.w_bits=e,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=f+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+ja-1)/ja),i.window=new E.Buf8(2*i.w_size),i.head=new E.Buf16(i.hash_size),i.prev=new E.Buf16(i.w_size),i.lit_bufsize=1<<f+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new E.Buf8(i.pending_buf_size),i.d_buf=1*i.lit_bufsize,i.l_buf=3*i.lit_bufsize,i.level=b,i.strategy=g,i.method=c,w(a)}function z(a,b){return y(a,b,$,aa,ba,Y)}function A(a,b){var c,h,k,l;if(!a||!a.state||b>N||b<0)return a?d(a,Q):Q;if(h=a.state,!a.output||!a.input&&0!==a.avail_in||h.status===ta&&b!==M)return d(a,0===a.avail_out?S:Q);if(h.strm=a,c=h.last_flush,h.last_flush=b,h.status===na)if(2===h.wrap)a.adler=0,i(h,31),i(h,139),i(h,8),h.gzhead?(i(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),i(h,255&h.gzhead.time),i(h,h.gzhead.time>>8&255),i(h,h.gzhead.time>>16&255),i(h,h.gzhead.time>>24&255),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,255&h.gzhead.os),h.gzhead.extra&&h.gzhead.extra.length&&(i(h,255&h.gzhead.extra.length),i(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(a.adler=H(a.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=oa):(i(h,0),i(h,0),i(h,0),i(h,0),i(h,0),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,ya),h.status=sa);else{var m=$+(h.w_bits-8<<4)<<8,n=-1;n=h.strategy>=V||h.level<2?0:h.level<6?1:6===h.level?2:3,m|=n<<6,0!==h.strstart&&(m|=ma),m+=31-m%31,h.status=sa,j(h,m),0!==h.strstart&&(j(h,a.adler>>>16),j(h,65535&a.adler)),a.adler=1}if(h.status===oa)if(h.gzhead.extra){for(k=h.pending;h.gzindex<(65535&h.gzhead.extra.length)&&(h.pending!==h.pending_buf_size||(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending!==h.pending_buf_size));)i(h,255&h.gzhead.extra[h.gzindex]),h.gzindex++;h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),h.gzindex===h.gzhead.extra.length&&(h.gzindex=0,h.status=pa)}else h.status=pa;if(h.status===pa)if(h.gzhead.name){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.name.length?255&h.gzhead.name.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.gzindex=0,h.status=qa)}else h.status=qa;if(h.status===qa)if(h.gzhead.comment){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.comment.length?255&h.gzhead.comment.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.status=ra)}else h.status=ra;if(h.status===ra&&(h.gzhead.hcrc?(h.pending+2>h.pending_buf_size&&g(a),h.pending+2<=h.pending_buf_size&&(i(h,255&a.adler),i(h,a.adler>>8&255),a.adler=0,h.status=sa)):h.status=sa),0!==h.pending){if(g(a),0===a.avail_out)return h.last_flush=-1,O}else if(0===a.avail_in&&e(b)<=e(c)&&b!==M)return d(a,S);if(h.status===ta&&0!==a.avail_in)return d(a,S);if(0!==a.avail_in||0!==h.lookahead||b!==J&&h.status!==ta){var o=h.strategy===V?r(h,b):h.strategy===W?q(h,b):D[h.level].func(h,b);if(o!==wa&&o!==xa||(h.status=ta),o===ua||o===wa)return 0===a.avail_out&&(h.last_flush=-1),O;if(o===va&&(b===K?F._tr_align(h):b!==N&&(F._tr_stored_block(h,0,0,!1),b===L&&(f(h.head),0===h.lookahead&&(h.strstart=0,h.block_start=0,h.insert=0))),g(a),0===a.avail_out))return h.last_flush=-1,O}return b!==M?O:h.wrap<=0?P:(2===h.wrap?(i(h,255&a.adler),i(h,a.adler>>8&255),i(h,a.adler>>16&255),i(h,a.adler>>24&255),i(h,255&a.total_in),i(h,a.total_in>>8&255),i(h,a.total_in>>16&255),i(h,a.total_in>>24&255)):(j(h,a.adler>>>16),j(h,65535&a.adler)),g(a),h.wrap>0&&(h.wrap=-h.wrap),0!==h.pending?O:P)}function B(a){var b;return a&&a.state?(b=a.state.status,b!==na&&b!==oa&&b!==pa&&b!==qa&&b!==ra&&b!==sa&&b!==ta?d(a,Q):(a.state=null,b===sa?d(a,R):O)):Q}function C(a,b){var c,d,e,g,h,i,j,k,l=b.length;if(!a||!a.state)return Q;if(c=a.state,g=c.wrap,2===g||1===g&&c.status!==na||c.lookahead)return Q;for(1===g&&(a.adler=G(a.adler,b,l,0)),c.wrap=0,l>=c.w_size&&(0===g&&(f(c.head),c.strstart=0,c.block_start=0,c.insert=0),k=new E.Buf8(c.w_size),E.arraySet(k,b,l-c.w_size,c.w_size,0),b=k,l=c.w_size),h=a.avail_in,i=a.next_in,j=a.input,a.avail_in=l,a.next_in=0,a.input=b,m(c);c.lookahead>=ja;){d=c.strstart,e=c.lookahead-(ja-1);do c.ins_h=(c.ins_h<<c.hash_shift^c.window[d+ja-1])&c.hash_mask,c.prev[d&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=d,d++;while(--e);c.strstart=d,c.lookahead=ja-1,m(c)}return c.strstart+=c.lookahead,c.block_start=c.strstart,c.insert=c.lookahead,c.lookahead=0,c.match_length=c.prev_length=ja-1,c.match_available=0,a.next_in=i,a.input=j,a.avail_in=h,c.wrap=g,O}var D,E=a("../utils/common"),F=a("./trees"),G=a("./adler32"),H=a("./crc32"),I=a("./messages"),J=0,K=1,L=3,M=4,N=5,O=0,P=1,Q=-2,R=-3,S=-5,T=-1,U=1,V=2,W=3,X=4,Y=0,Z=2,$=8,_=9,aa=15,ba=8,ca=29,da=256,ea=da+1+ca,fa=30,ga=19,ha=2*ea+1,ia=15,ja=3,ka=258,la=ka+ja+1,ma=32,na=42,oa=69,pa=73,qa=91,ra=103,sa=113,ta=666,ua=1,va=2,wa=3,xa=4,ya=3;D=[new s(0,0,0,0,n),new s(4,4,8,4,o),new s(4,5,16,8,o),new s(4,6,32,32,o),new s(4,4,16,16,p),new s(8,16,32,32,p),new s(8,16,128,128,p),new s(8,32,128,256,p),new s(32,128,258,1024,p),new s(32,258,258,4096,p)],c.deflateInit=z,c.deflateInit2=y,c.deflateReset=w,c.deflateResetKeep=v,c.deflateSetHeader=x,c.deflate=A,c.deflateEnd=B,c.deflateSetDictionary=C,c.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":60,"./adler32":62,"./crc32":64,"./messages":70,"./trees":71}],66:[function(a,b,c){"use strict";function d(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}b.exports=d},{}],67:[function(a,b,c){"use strict";var d=30,e=12;b.exports=function(a,b){var c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;c=a.state,f=a.next_in,B=a.input,g=f+(a.avail_in-5),h=a.next_out,C=a.output,i=h-(b-a.avail_out),j=h+(a.avail_out-257),k=c.dmax,l=c.wsize,m=c.whave,n=c.wnext,o=c.window,p=c.hold,q=c.bits,r=c.lencode,s=c.distcode,t=(1<<c.lenbits)-1,u=(1<<c.distbits)-1;a:do{q<15&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=r[p&t];b:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,0===w)C[h++]=65535&v;else{if(!(16&w)){if(0===(64&w)){v=r[(65535&v)+(p&(1<<w)-1)];continue b}if(32&w){c.mode=e;break a}a.msg="invalid literal/length code",c.mode=d;break a}x=65535&v,w&=15,w&&(q<w&&(p+=B[f++]<<q,q+=8),x+=p&(1<<w)-1,p>>>=w,q-=w),q<15&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=s[p&u];c:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,!(16&w)){if(0===(64&w)){v=s[(65535&v)+(p&(1<<w)-1)];continue c}a.msg="invalid distance code",c.mode=d;break a}if(y=65535&v,w&=15,q<w&&(p+=B[f++]<<q,q+=8,q<w&&(p+=B[f++]<<q,q+=8)),y+=p&(1<<w)-1,y>k){a.msg="invalid distance too far back",c.mode=d;break a}if(p>>>=w,q-=w,w=h-i,y>w){if(w=y-w,w>m&&c.sane){a.msg="invalid distance too far back",c.mode=d;break a}if(z=0,A=o,0===n){if(z+=l-w,w<x){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}else if(n<w){if(z+=l+n-w,w-=n,w<x){x-=w;do C[h++]=o[z++];while(--w);if(z=0,n<x){w=n,x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}}else if(z+=n-w,w<x){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}for(;x>2;)C[h++]=A[z++],C[h++]=A[z++],C[h++]=A[z++],x-=3;x&&(C[h++]=A[z++],x>1&&(C[h++]=A[z++]))}else{z=h-y;do C[h++]=C[z++],C[h++]=C[z++],C[h++]=C[z++],x-=3;while(x>2);x&&(C[h++]=C[z++],x>1&&(C[h++]=C[z++]))}break}}break}}while(f<g&&h<j);x=q>>3,f-=x,q-=x<<3,p&=(1<<q)-1,a.next_in=f,a.next_out=h,a.avail_in=f<g?5+(g-f):5-(f-g),a.avail_out=h<j?257+(j-h):257-(h-j),c.hold=p,c.bits=q}},{}],68:[function(a,b,c){"use strict";function d(a){return(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24)}function e(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(a){var b;return a&&a.state?(b=a.state,a.total_in=a.total_out=b.total=0,a.msg="",b.wrap&&(a.adler=1&b.wrap),b.mode=L,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new s.Buf32(pa),b.distcode=b.distdyn=new s.Buf32(qa),
b.sane=1,b.back=-1,D):G}function g(a){var b;return a&&a.state?(b=a.state,b.wsize=0,b.whave=0,b.wnext=0,f(a)):G}function h(a,b){var c,d;return a&&a.state?(d=a.state,b<0?(c=0,b=-b):(c=(b>>4)+1,b<48&&(b&=15)),b&&(b<8||b>15)?G:(null!==d.window&&d.wbits!==b&&(d.window=null),d.wrap=c,d.wbits=b,g(a))):G}function i(a,b){var c,d;return a?(d=new e,a.state=d,d.window=null,c=h(a,b),c!==D&&(a.state=null),c):G}function j(a){return i(a,sa)}function k(a){if(ta){var b;for(q=new s.Buf32(512),r=new s.Buf32(32),b=0;b<144;)a.lens[b++]=8;for(;b<256;)a.lens[b++]=9;for(;b<280;)a.lens[b++]=7;for(;b<288;)a.lens[b++]=8;for(w(y,a.lens,0,288,q,0,a.work,{bits:9}),b=0;b<32;)a.lens[b++]=5;w(z,a.lens,0,32,r,0,a.work,{bits:5}),ta=!1}a.lencode=q,a.lenbits=9,a.distcode=r,a.distbits=5}function l(a,b,c,d){var e,f=a.state;return null===f.window&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new s.Buf8(f.wsize)),d>=f.wsize?(s.arraySet(f.window,b,c-f.wsize,f.wsize,0),f.wnext=0,f.whave=f.wsize):(e=f.wsize-f.wnext,e>d&&(e=d),s.arraySet(f.window,b,c-d,e,f.wnext),d-=e,d?(s.arraySet(f.window,b,c-d,d,0),f.wnext=d,f.whave=f.wsize):(f.wnext+=e,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=e))),0}function m(a,b){var c,e,f,g,h,i,j,m,n,o,p,q,r,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa=0,Ba=new s.Buf8(4),Ca=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return G;c=a.state,c.mode===W&&(c.mode=X),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,o=i,p=j,xa=D;a:for(;;)switch(c.mode){case L:if(0===c.wrap){c.mode=X;break}for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(2&c.wrap&&35615===m){c.check=0,Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0),m=0,n=0,c.mode=M;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&m)<<8)+(m>>8))%31){a.msg="incorrect header check",c.mode=ma;break}if((15&m)!==K){a.msg="unknown compression method",c.mode=ma;break}if(m>>>=4,n-=4,wa=(15&m)+8,0===c.wbits)c.wbits=wa;else if(wa>c.wbits){a.msg="invalid window size",c.mode=ma;break}c.dmax=1<<wa,a.adler=c.check=1,c.mode=512&m?U:W,m=0,n=0;break;case M:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.flags=m,(255&c.flags)!==K){a.msg="unknown compression method",c.mode=ma;break}if(57344&c.flags){a.msg="unknown header flags set",c.mode=ma;break}c.head&&(c.head.text=m>>8&1),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=N;case N:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.time=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,Ba[2]=m>>>16&255,Ba[3]=m>>>24&255,c.check=u(c.check,Ba,4,0)),m=0,n=0,c.mode=O;case O:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.xflags=255&m,c.head.os=m>>8),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=P;case P:if(1024&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length=m,c.head&&(c.head.extra_len=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0}else c.head&&(c.head.extra=null);c.mode=Q;case Q:if(1024&c.flags&&(q=c.length,q>i&&(q=i),q&&(c.head&&(wa=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Array(c.head.extra_len)),s.arraySet(c.head.extra,e,g,q,wa)),512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,c.length-=q),c.length))break a;c.length=0,c.mode=R;case R:if(2048&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.name+=String.fromCharCode(wa));while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.name=null);c.length=0,c.mode=S;case S:if(4096&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.comment+=String.fromCharCode(wa));while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.comment=null);c.mode=T;case T:if(512&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(65535&c.check)){a.msg="header crc mismatch",c.mode=ma;break}m=0,n=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),a.adler=c.check=0,c.mode=W;break;case U:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}a.adler=c.check=d(m),m=0,n=0,c.mode=V;case V:if(0===c.havedict)return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,F;a.adler=c.check=1,c.mode=W;case W:if(b===B||b===C)break a;case X:if(c.last){m>>>=7&n,n-=7&n,c.mode=ja;break}for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}switch(c.last=1&m,m>>>=1,n-=1,3&m){case 0:c.mode=Y;break;case 1:if(k(c),c.mode=ca,b===C){m>>>=2,n-=2;break a}break;case 2:c.mode=_;break;case 3:a.msg="invalid block type",c.mode=ma}m>>>=2,n-=2;break;case Y:for(m>>>=7&n,n-=7&n;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if((65535&m)!==(m>>>16^65535)){a.msg="invalid stored block lengths",c.mode=ma;break}if(c.length=65535&m,m=0,n=0,c.mode=Z,b===C)break a;case Z:c.mode=$;case $:if(q=c.length){if(q>i&&(q=i),q>j&&(q=j),0===q)break a;s.arraySet(f,e,g,q,h),i-=q,g+=q,j-=q,h+=q,c.length-=q;break}c.mode=W;break;case _:for(;n<14;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.nlen=(31&m)+257,m>>>=5,n-=5,c.ndist=(31&m)+1,m>>>=5,n-=5,c.ncode=(15&m)+4,m>>>=4,n-=4,c.nlen>286||c.ndist>30){a.msg="too many length or distance symbols",c.mode=ma;break}c.have=0,c.mode=aa;case aa:for(;c.have<c.ncode;){for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.lens[Ca[c.have++]]=7&m,m>>>=3,n-=3}for(;c.have<19;)c.lens[Ca[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,ya={bits:c.lenbits},xa=w(x,c.lens,0,19,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid code lengths set",c.mode=ma;break}c.have=0,c.mode=ba;case ba:for(;c.have<c.nlen+c.ndist;){for(;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(sa<16)m>>>=qa,n-=qa,c.lens[c.have++]=sa;else{if(16===sa){for(za=qa+2;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m>>>=qa,n-=qa,0===c.have){a.msg="invalid bit length repeat",c.mode=ma;break}wa=c.lens[c.have-1],q=3+(3&m),m>>>=2,n-=2}else if(17===sa){for(za=qa+3;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=3+(7&m),m>>>=3,n-=3}else{for(za=qa+7;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=11+(127&m),m>>>=7,n-=7}if(c.have+q>c.nlen+c.ndist){a.msg="invalid bit length repeat",c.mode=ma;break}for(;q--;)c.lens[c.have++]=wa}}if(c.mode===ma)break;if(0===c.lens[256]){a.msg="invalid code -- missing end-of-block",c.mode=ma;break}if(c.lenbits=9,ya={bits:c.lenbits},xa=w(y,c.lens,0,c.nlen,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid literal/lengths set",c.mode=ma;break}if(c.distbits=6,c.distcode=c.distdyn,ya={bits:c.distbits},xa=w(z,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,ya),c.distbits=ya.bits,xa){a.msg="invalid distances set",c.mode=ma;break}if(c.mode=ca,b===C)break a;case ca:c.mode=da;case da:if(i>=6&&j>=258){a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,v(a,p),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,c.mode===W&&(c.back=-1);break}for(c.back=0;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(ra&&0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.lencode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,c.length=sa,0===ra){c.mode=ia;break}if(32&ra){c.back=-1,c.mode=W;break}if(64&ra){a.msg="invalid literal/length code",c.mode=ma;break}c.extra=15&ra,c.mode=ea;case ea:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=fa;case fa:for(;Aa=c.distcode[m&(1<<c.distbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.distcode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,64&ra){a.msg="invalid distance code",c.mode=ma;break}c.offset=sa,c.extra=15&ra,c.mode=ga;case ga:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.offset+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){a.msg="invalid distance too far back",c.mode=ma;break}c.mode=ha;case ha:if(0===j)break a;if(q=p-j,c.offset>q){if(q=c.offset-q,q>c.whave&&c.sane){a.msg="invalid distance too far back",c.mode=ma;break}q>c.wnext?(q-=c.wnext,r=c.wsize-q):r=c.wnext-q,q>c.length&&(q=c.length),pa=c.window}else pa=f,r=h-c.offset,q=c.length;q>j&&(q=j),j-=q,c.length-=q;do f[h++]=pa[r++];while(--q);0===c.length&&(c.mode=da);break;case ia:if(0===j)break a;f[h++]=c.length,j--,c.mode=da;break;case ja:if(c.wrap){for(;n<32;){if(0===i)break a;i--,m|=e[g++]<<n,n+=8}if(p-=j,a.total_out+=p,c.total+=p,p&&(a.adler=c.check=c.flags?u(c.check,f,p,h-p):t(c.check,f,p,h-p)),p=j,(c.flags?m:d(m))!==c.check){a.msg="incorrect data check",c.mode=ma;break}m=0,n=0}c.mode=ka;case ka:if(c.wrap&&c.flags){for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(4294967295&c.total)){a.msg="incorrect length check",c.mode=ma;break}m=0,n=0}c.mode=la;case la:xa=E;break a;case ma:xa=H;break a;case na:return I;case oa:default:return G}return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,(c.wsize||p!==a.avail_out&&c.mode<ma&&(c.mode<ja||b!==A))&&l(a,a.output,a.next_out,p-a.avail_out)?(c.mode=na,I):(o-=a.avail_in,p-=a.avail_out,a.total_in+=o,a.total_out+=p,c.total+=p,c.wrap&&p&&(a.adler=c.check=c.flags?u(c.check,f,p,a.next_out-p):t(c.check,f,p,a.next_out-p)),a.data_type=c.bits+(c.last?64:0)+(c.mode===W?128:0)+(c.mode===ca||c.mode===Z?256:0),(0===o&&0===p||b===A)&&xa===D&&(xa=J),xa)}function n(a){if(!a||!a.state)return G;var b=a.state;return b.window&&(b.window=null),a.state=null,D}function o(a,b){var c;return a&&a.state?(c=a.state,0===(2&c.wrap)?G:(c.head=b,b.done=!1,D)):G}function p(a,b){var c,d,e,f=b.length;return a&&a.state?(c=a.state,0!==c.wrap&&c.mode!==V?G:c.mode===V&&(d=1,d=t(d,b,f,0),d!==c.check)?H:(e=l(a,b,f,f))?(c.mode=na,I):(c.havedict=1,D)):G}var q,r,s=a("../utils/common"),t=a("./adler32"),u=a("./crc32"),v=a("./inffast"),w=a("./inftrees"),x=0,y=1,z=2,A=4,B=5,C=6,D=0,E=1,F=2,G=-2,H=-3,I=-4,J=-5,K=8,L=1,M=2,N=3,O=4,P=5,Q=6,R=7,S=8,T=9,U=10,V=11,W=12,X=13,Y=14,Z=15,$=16,_=17,aa=18,ba=19,ca=20,da=21,ea=22,fa=23,ga=24,ha=25,ia=26,ja=27,ka=28,la=29,ma=30,na=31,oa=32,pa=852,qa=592,ra=15,sa=ra,ta=!0;c.inflateReset=g,c.inflateReset2=h,c.inflateResetKeep=f,c.inflateInit=j,c.inflateInit2=i,c.inflate=m,c.inflateEnd=n,c.inflateGetHeader=o,c.inflateSetDictionary=p,c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":60,"./adler32":62,"./crc32":64,"./inffast":67,"./inftrees":69}],69:[function(a,b,c){"use strict";var d=a("../utils/common"),e=15,f=852,g=592,h=0,i=1,j=2,k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],m=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],n=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];b.exports=function(a,b,c,o,p,q,r,s){var t,u,v,w,x,y,z,A,B,C=s.bits,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=null,O=0,P=new d.Buf16(e+1),Q=new d.Buf16(e+1),R=null,S=0;for(D=0;D<=e;D++)P[D]=0;for(E=0;E<o;E++)P[b[c+E]]++;for(H=C,G=e;G>=1&&0===P[G];G--);if(H>G&&(H=G),0===G)return p[q++]=20971520,p[q++]=20971520,s.bits=1,0;for(F=1;F<G&&0===P[F];F++);for(H<F&&(H=F),K=1,D=1;D<=e;D++)if(K<<=1,K-=P[D],K<0)return-1;if(K>0&&(a===h||1!==G))return-1;for(Q[1]=0,D=1;D<e;D++)Q[D+1]=Q[D]+P[D];for(E=0;E<o;E++)0!==b[c+E]&&(r[Q[b[c+E]]++]=E);if(a===h?(N=R=r,y=19):a===i?(N=k,O-=257,R=l,S-=257,y=256):(N=m,R=n,y=-1),M=0,E=0,D=F,x=q,I=H,J=0,v=-1,L=1<<H,w=L-1,a===i&&L>f||a===j&&L>g)return 1;for(var T=0;;){T++,z=D-J,r[E]<y?(A=0,B=r[E]):r[E]>y?(A=R[S+r[E]],B=N[O+r[E]]):(A=96,B=0),t=1<<D-J,u=1<<I,F=u;do u-=t,p[x+(M>>J)+u]=z<<24|A<<16|B|0;while(0!==u);for(t=1<<D-1;M&t;)t>>=1;if(0!==t?(M&=t-1,M+=t):M=0,E++,0===--P[D]){if(D===G)break;D=b[c+r[E]]}if(D>H&&(M&w)!==v){for(0===J&&(J=H),x+=F,I=D-J,K=1<<I;I+J<G&&(K-=P[I+J],!(K<=0));)I++,K<<=1;if(L+=1<<I,a===i&&L>f||a===j&&L>g)return 1;v=M&w,p[v]=H<<24|I<<16|x-q|0}}return 0!==M&&(p[x+M]=D-J<<24|64<<16|0),s.bits=H,0}},{"../utils/common":60}],70:[function(a,b,c){"use strict";b.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],71:[function(a,b,c){"use strict";function d(a){for(var b=a.length;--b>=0;)a[b]=0}function e(a,b,c,d,e){this.static_tree=a,this.extra_bits=b,this.extra_base=c,this.elems=d,this.max_length=e,this.has_stree=a&&a.length}function f(a,b){this.dyn_tree=a,this.max_code=0,this.stat_desc=b}function g(a){return a<256?ia[a]:ia[256+(a>>>7)]}function h(a,b){a.pending_buf[a.pending++]=255&b,a.pending_buf[a.pending++]=b>>>8&255}function i(a,b,c){a.bi_valid>X-c?(a.bi_buf|=b<<a.bi_valid&65535,h(a,a.bi_buf),a.bi_buf=b>>X-a.bi_valid,a.bi_valid+=c-X):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)}function j(a,b,c){i(a,c[2*b],c[2*b+1])}function k(a,b){var c=0;do c|=1&a,a>>>=1,c<<=1;while(--b>0);return c>>>1}function l(a){16===a.bi_valid?(h(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)}function m(a,b){var c,d,e,f,g,h,i=b.dyn_tree,j=b.max_code,k=b.stat_desc.static_tree,l=b.stat_desc.has_stree,m=b.stat_desc.extra_bits,n=b.stat_desc.extra_base,o=b.stat_desc.max_length,p=0;for(f=0;f<=W;f++)a.bl_count[f]=0;for(i[2*a.heap[a.heap_max]+1]=0,c=a.heap_max+1;c<V;c++)d=a.heap[c],f=i[2*i[2*d+1]+1]+1,f>o&&(f=o,p++),i[2*d+1]=f,d>j||(a.bl_count[f]++,g=0,d>=n&&(g=m[d-n]),h=i[2*d],a.opt_len+=h*(f+g),l&&(a.static_len+=h*(k[2*d+1]+g)));if(0!==p){do{for(f=o-1;0===a.bl_count[f];)f--;a.bl_count[f]--,a.bl_count[f+1]+=2,a.bl_count[o]--,p-=2}while(p>0);for(f=o;0!==f;f--)for(d=a.bl_count[f];0!==d;)e=a.heap[--c],e>j||(i[2*e+1]!==f&&(a.opt_len+=(f-i[2*e+1])*i[2*e],i[2*e+1]=f),d--)}}function n(a,b,c){var d,e,f=new Array(W+1),g=0;for(d=1;d<=W;d++)f[d]=g=g+c[d-1]<<1;for(e=0;e<=b;e++){var h=a[2*e+1];0!==h&&(a[2*e]=k(f[h]++,h))}}function o(){var a,b,c,d,f,g=new Array(W+1);for(c=0,d=0;d<Q-1;d++)for(ka[d]=c,a=0;a<1<<ba[d];a++)ja[c++]=d;for(ja[c-1]=d,f=0,d=0;d<16;d++)for(la[d]=f,a=0;a<1<<ca[d];a++)ia[f++]=d;for(f>>=7;d<T;d++)for(la[d]=f<<7,a=0;a<1<<ca[d]-7;a++)ia[256+f++]=d;for(b=0;b<=W;b++)g[b]=0;for(a=0;a<=143;)ga[2*a+1]=8,a++,g[8]++;for(;a<=255;)ga[2*a+1]=9,a++,g[9]++;for(;a<=279;)ga[2*a+1]=7,a++,g[7]++;for(;a<=287;)ga[2*a+1]=8,a++,g[8]++;for(n(ga,S+1,g),a=0;a<T;a++)ha[2*a+1]=5,ha[2*a]=k(a,5);ma=new e(ga,ba,R+1,S,W),na=new e(ha,ca,0,T,W),oa=new e(new Array(0),da,0,U,Y)}function p(a){var b;for(b=0;b<S;b++)a.dyn_ltree[2*b]=0;for(b=0;b<T;b++)a.dyn_dtree[2*b]=0;for(b=0;b<U;b++)a.bl_tree[2*b]=0;a.dyn_ltree[2*Z]=1,a.opt_len=a.static_len=0,a.last_lit=a.matches=0}function q(a){a.bi_valid>8?h(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0}function r(a,b,c,d){q(a),d&&(h(a,c),h(a,~c)),G.arraySet(a.pending_buf,a.window,b,c,a.pending),a.pending+=c}function s(a,b,c,d){var e=2*b,f=2*c;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]}function t(a,b,c){for(var d=a.heap[c],e=c<<1;e<=a.heap_len&&(e<a.heap_len&&s(b,a.heap[e+1],a.heap[e],a.depth)&&e++,!s(b,d,a.heap[e],a.depth));)a.heap[c]=a.heap[e],c=e,e<<=1;a.heap[c]=d}function u(a,b,c){var d,e,f,h,k=0;if(0!==a.last_lit)do d=a.pending_buf[a.d_buf+2*k]<<8|a.pending_buf[a.d_buf+2*k+1],e=a.pending_buf[a.l_buf+k],k++,0===d?j(a,e,b):(f=ja[e],j(a,f+R+1,b),h=ba[f],0!==h&&(e-=ka[f],i(a,e,h)),d--,f=g(d),j(a,f,c),h=ca[f],0!==h&&(d-=la[f],i(a,d,h)));while(k<a.last_lit);j(a,Z,b)}function v(a,b){var c,d,e,f=b.dyn_tree,g=b.stat_desc.static_tree,h=b.stat_desc.has_stree,i=b.stat_desc.elems,j=-1;for(a.heap_len=0,a.heap_max=V,c=0;c<i;c++)0!==f[2*c]?(a.heap[++a.heap_len]=j=c,a.depth[c]=0):f[2*c+1]=0;for(;a.heap_len<2;)e=a.heap[++a.heap_len]=j<2?++j:0,f[2*e]=1,a.depth[e]=0,a.opt_len--,h&&(a.static_len-=g[2*e+1]);for(b.max_code=j,c=a.heap_len>>1;c>=1;c--)t(a,f,c);e=i;do c=a.heap[1],a.heap[1]=a.heap[a.heap_len--],t(a,f,1),d=a.heap[1],a.heap[--a.heap_max]=c,a.heap[--a.heap_max]=d,f[2*e]=f[2*c]+f[2*d],a.depth[e]=(a.depth[c]>=a.depth[d]?a.depth[c]:a.depth[d])+1,f[2*c+1]=f[2*d+1]=e,a.heap[1]=e++,t(a,f,1);while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1],m(a,b),n(f,j,a.bl_count)}function w(a,b,c){var d,e,f=-1,g=b[1],h=0,i=7,j=4;for(0===g&&(i=138,j=3),b[2*(c+1)+1]=65535,d=0;d<=c;d++)e=g,g=b[2*(d+1)+1],++h<i&&e===g||(h<j?a.bl_tree[2*e]+=h:0!==e?(e!==f&&a.bl_tree[2*e]++,a.bl_tree[2*$]++):h<=10?a.bl_tree[2*_]++:a.bl_tree[2*aa]++,h=0,f=e,0===g?(i=138,j=3):e===g?(i=6,j=3):(i=7,j=4))}function x(a,b,c){var d,e,f=-1,g=b[1],h=0,k=7,l=4;for(0===g&&(k=138,l=3),d=0;d<=c;d++)if(e=g,g=b[2*(d+1)+1],!(++h<k&&e===g)){if(h<l){do j(a,e,a.bl_tree);while(0!==--h)}else 0!==e?(e!==f&&(j(a,e,a.bl_tree),h--),j(a,$,a.bl_tree),i(a,h-3,2)):h<=10?(j(a,_,a.bl_tree),i(a,h-3,3)):(j(a,aa,a.bl_tree),i(a,h-11,7));h=0,f=e,0===g?(k=138,l=3):e===g?(k=6,l=3):(k=7,l=4)}}function y(a){var b;for(w(a,a.dyn_ltree,a.l_desc.max_code),w(a,a.dyn_dtree,a.d_desc.max_code),v(a,a.bl_desc),b=U-1;b>=3&&0===a.bl_tree[2*ea[b]+1];b--);return a.opt_len+=3*(b+1)+5+5+4,b}function z(a,b,c,d){var e;for(i(a,b-257,5),i(a,c-1,5),i(a,d-4,4),e=0;e<d;e++)i(a,a.bl_tree[2*ea[e]+1],3);x(a,a.dyn_ltree,b-1),x(a,a.dyn_dtree,c-1)}function A(a){var b,c=4093624447;for(b=0;b<=31;b++,c>>>=1)if(1&c&&0!==a.dyn_ltree[2*b])return I;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return J;for(b=32;b<R;b++)if(0!==a.dyn_ltree[2*b])return J;return I}function B(a){pa||(o(),pa=!0),a.l_desc=new f(a.dyn_ltree,ma),a.d_desc=new f(a.dyn_dtree,na),a.bl_desc=new f(a.bl_tree,oa),a.bi_buf=0,a.bi_valid=0,p(a)}function C(a,b,c,d){i(a,(L<<1)+(d?1:0),3),r(a,b,c,!0)}function D(a){i(a,M<<1,3),j(a,Z,ga),l(a)}function E(a,b,c,d){var e,f,g=0;a.level>0?(a.strm.data_type===K&&(a.strm.data_type=A(a)),v(a,a.l_desc),v(a,a.d_desc),g=y(a),e=a.opt_len+3+7>>>3,f=a.static_len+3+7>>>3,f<=e&&(e=f)):e=f=c+5,c+4<=e&&b!==-1?C(a,b,c,d):a.strategy===H||f===e?(i(a,(M<<1)+(d?1:0),3),u(a,ga,ha)):(i(a,(N<<1)+(d?1:0),3),z(a,a.l_desc.max_code+1,a.d_desc.max_code+1,g+1),u(a,a.dyn_ltree,a.dyn_dtree)),p(a),d&&q(a)}function F(a,b,c){return a.pending_buf[a.d_buf+2*a.last_lit]=b>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&b,a.pending_buf[a.l_buf+a.last_lit]=255&c,a.last_lit++,0===b?a.dyn_ltree[2*c]++:(a.matches++,b--,a.dyn_ltree[2*(ja[c]+R+1)]++,a.dyn_dtree[2*g(b)]++),a.last_lit===a.lit_bufsize-1}var G=a("../utils/common"),H=4,I=0,J=1,K=2,L=0,M=1,N=2,O=3,P=258,Q=29,R=256,S=R+1+Q,T=30,U=19,V=2*S+1,W=15,X=16,Y=7,Z=256,$=16,_=17,aa=18,ba=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ca=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],da=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ea=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],fa=512,ga=new Array(2*(S+2));d(ga);var ha=new Array(2*T);d(ha);var ia=new Array(fa);d(ia);var ja=new Array(P-O+1);d(ja);var ka=new Array(Q);d(ka);var la=new Array(T);d(la);var ma,na,oa,pa=!1;c._tr_init=B,c._tr_stored_block=C,c._tr_flush_block=E,c._tr_tally=F,c._tr_align=D},{"../utils/common":60}],72:[function(a,b,c){"use strict";function d(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}b.exports=d},{}]},{},[10])(10)}),!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.JSZipUtils=a():"undefined"!=typeof global?global.JSZipUtils=a():"undefined"!=typeof self&&(self.JSZipUtils=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";function c(){try{return new window.XMLHttpRequest}catch(a){}}function d(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}}var e={};e._getBinaryFromXHR=function(a){return a.response||a.responseText};var f=window.ActiveXObject?function(){return c()||d()}:c;e.getBinaryContent=function(a,b){try{var c=f();c.open("GET",a,!0),"responseType"in c&&(c.responseType="arraybuffer"),c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined"),c.onreadystatechange=function(){var d,f;if(4===c.readyState)if(200===c.status||0===c.status){d=null,f=null;try{d=e._getBinaryFromXHR(c)}catch(a){f=new Error(a)}b(f,d)}else b(new Error("Ajax error for "+a+" : "+this.status+" "+this.statusText),null)},c.send()}catch(a){b(new Error(a),null)}},b.exports=e},{}]},{},[1])(1)});